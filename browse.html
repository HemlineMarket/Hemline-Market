<!doctype html><html lang="en"><head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Hemline — Browse</title>
<link rel="stylesheet" href="/css/tokens.css">
<link rel="stylesheet" href="/css/components.css">
<link rel="stylesheet" href="/css/layout.css">
<style>
h1{font-size:var(--fs-700);margin-bottom:var(--space-4);}
.grid-browse{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:var(--space-5);}
</style>
</head><body>

<!-- Site navbar -->
<nav class="navbar">
  <div>
    <a href="/index.html"><strong>Hemline</strong></a>
  </div>
  <div>
    <a href="/browse.html">Browse</a>
    <a href="/seller.html">Seller</a>
    <a href="/orders.html">Orders</a>
    <a href="/checkout.html">Checkout</a>
  </div>
</nav>

<div class="container-lg">
  <h1>Browse Fabrics</h1>
  <div id="content" class="grid-browse">
    Loading…
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="/js/env.js"></script>
<script>
const { SUPABASE_URL, SUPABASE_ANON_KEY } = window.HEMLINE_ENV||{};
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
const el = document.getElementById("content");

function esc(s){return String(s||"").replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]))}

function fmtPrice(row){
  if (row.price!=null && Number.isFinite(Number(row.price))) return "$"+Number(row.price).toFixed(2);
  if (row.price_cents!=null && Number.isFinite(Number(row.price_cents))) return "$"+(Number(row.price_cents)/100).toFixed(2);
  return "—";
}

async function load(){
  const { data, error } = await supabase.from("listings")
    .select("id,title,price,price_cents,image_urls")
    .order("created_at",{ascending:false});
  if(error){ el.innerHTML = "Error: "+esc(error.message); return; }

  el.innerHTML = data.map(row=>{
    const img = Array.isArray(row.image_urls)&&row.image_urls.length ? esc(row.image_urls[0]) : "https://placehold.co/400x300/png?text=No+Image";
    return `
      <a class="card stack" href="/listing.html?id=${encodeURIComponent(row.id)}">
        <img src="${img}" alt="" style="width:100%;border-radius:var(--radius-md);">
        <h2>${esc(row.title||"Untitled")}</h2>
        <div class="price">${fmtPrice(row)}</div>
      </a>`;
  }).join("");
}
load();
</script>
</body></html>
