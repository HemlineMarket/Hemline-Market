<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Hemline Market</title>

<h1>Hemline Market</h1>

<div id="signedOut">
<input id="email" type="email" placeholder="Email" />
<button id="send">Send Magic Link</button>
<p id="msg"></p>
</div>

<div id="signedIn" style="display:none;">
<p id="who"></p>
<button id="signout">Sign out</button>
</div>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

const SUPABASE_URL = "https://clkizksbvxjkoatdajgd.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmZzZSIsInJlZiI6ImNsa2l6a3Nidn..."; // paste full key here

const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

const $ = (id) => document.getElementById(id);
const showIn = (email) => { $("signedOut").style.display="none"; $("signedIn").style.display="block"; $("who").textContent = `Signed in as ${email}`; };
const showOut = () => { $("signedIn").style.display="none"; $("signedOut").style.display="block"; $("msg").textContent=""; };

$("send").onclick = async () => {
const email = $("email").value.trim();
const { error } = await supabase.auth.signInWithOtp({
email,
options: { emailRedirectTo: window.location.href }
});
$("msg").textContent = error ? error.message : "Check your email for the link.";
};

(async () => {
const { data: { session } } = await supabase.auth.getSession();
if (session?.user?.email) showIn(session.user.email);
})();

$("signout").onclick = async () => {
await supabase.auth.signOut();
showOut();
};
</script>
