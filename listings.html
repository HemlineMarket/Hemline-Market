<!doctype html><html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Hemline — Listing</title>
<style>
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;margin:24px}
.wrap{max-width:900px;margin:auto}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
img{width:100%;border-radius:12px;border:1px solid #e5e7eb;object-fit:cover}
.badge{display:inline-block;font-size:11px;padding:2px 8px;border:1px solid #e2e8f0;border-radius:999px;background:#f1f5f9}
.muted{color:#64748b}
.price{font-weight:700;font-size:20px}
a{color:#0f172a}
@media (max-width:780px){.grid{grid-template-columns:1fr}}
</style>
</head><body>
<div class="wrap">
  <p><a href="/browse.html">← Back to Browse</a></p>
  <div id="content">Loading…</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="/js/env.js"></script>
<script>
const { SUPABASE_URL, SUPABASE_ANON_KEY } = window.HEMLINE_ENV||{};
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
const q = new URLSearchParams(location.search);
const id = q.get("id");
const el = document.getElementById("content");

function esc(s){return String(s||"").replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]))}
function fmtPrice(row){
  if (row.price!=null && Number.isFinite(Number(row.price))) return "$"+Number(row.price).toFixed(2);
  if (row.price_cents!=null && Number.isFinite(Number(row.price_cents))) return "$"+(Number(row.price_cents)/100).toFixed(2);
  return "—";
}

async function load(){
  if(!id){ el.innerHTML = "<div class='muted'>Missing listing id.</div>"; return; }
  const { data, error } = await supabase.from("listings")
    .select("id,title,description,price,price_cents,category,item_type,color,image_urls,created_at")
    .eq("id", id).single();
  if(error){ el.innerHTML = "Error: "+esc(error.message); return; }

  const imgs = Array.isArray(data.image_urls) && data.image_urls.length ? data.image_urls
              : ["https://placehold.co/800x600/png?text=No+Image"];
  const gallery = imgs.map(src=>`<img src="${esc(src)}" alt="">`).join("");

  el.innerHTML = `
    <div class="grid">
      <div>${gallery}</div>
      <div>
        <h1 style="margin:0 0 6px">${esc(data.title||"Untitled")}</h1>
        <div class="price">${fmtPrice(data)}</div>
        <p class="muted" style="margin:8px 0">
          ${data.category ? `<span class="badge">${esc(data.category)}</span>` : ""}
          ${data.item_type ? ` <span class="badge">${esc(data.item_type)}</span>` : ""}
          ${data.color ? ` <span class="badge">${esc(data.color)}</span>` : ""}
        </p>
        <p>${esc(data.description||"")}</p>
        <p class="muted">Created: ${new Date(data.created_at).toLocaleString()}</p>
      </div>
    </div>`;
}
load();
</script>
</body></html>
