<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Hemline â€” Listings</title>
<style>
  :root { --ink:#0f172a; --line:#e5e7eb; --bg:#fafafa; --accent:#111827; --badge:#0ea5e9; }
  body { font-family: system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif; margin:24px; background:var(--bg); color:var(--ink); }
  .wrap { max-width: 900px; margin:auto; }
  .grid { display:grid; grid-template-columns:1fr 1fr; gap:16px; }

  /* CARD */
  .listing-card {
    position:relative; border-radius:12px; overflow:hidden; background:#fff;
    border:1px solid var(--line); box-shadow:0 2px 6px rgba(0,0,0,.05);
    transition:transform .2s ease, box-shadow .2s ease;
    opacity:0; transform:translateY(8px);
  }
  .listing-card.show { opacity:1; transform:translateY(0); animation:fadeUp .38s ease both; }
  @keyframes fadeUp { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:translateY(0)} }
  @media (prefers-reduced-motion: reduce){ .listing-card,.listing-card.show{ transition:none; animation:none; opacity:1; transform:none; } }
  .listing-card:hover { transform:translateY(-4px) scale(1.02); box-shadow:0 6px 16px rgba(0,0,0,.15); }

  .imgwrap { position:relative; background:#f8fafc; overflow:hidden; }
  .listing-card img { width:100%; height:240px; object-fit:cover; display:block; }

  /* Hover quick peek */
  .overlay { position:absolute; inset:0; background:rgba(0,0,0,.45); color:#fff;
    display:flex; align-items:center; justify-content:center; font-weight:600; font-size:15px;
    opacity:0; transition:opacity .25s ease; }
  .imgwrap:hover .overlay { opacity:1; }

  /* Date badge (kept for future, but not printed under cards) */
  .badge { position:absolute; left:8px; top:8px; background:rgba(14,165,233,.95); color:#fff;
    padding:6px 10px; border-radius:999px; font-size:12px; font-weight:600;
    border:1px solid rgba(255,255,255,.5); box-shadow:0 2px 6px rgba(0,0,0,.08); }

  .info { padding:12px; display:flex; align-items:flex-end; justify-content:space-between; gap:12px; }
  .title { font-weight:600; line-height:1.2; margin:0; }
  .price { font-weight:800; letter-spacing:.2px; color:var(--accent); font-size:22px; line-height:1; white-space:nowrap; }
  .price .cur { opacity:.55; font-weight:600; margin-right:1px; }

  /* Hide any stray date text under cards */
  .info .date, .info time, .card-date, .meta-date { display:none !important; }

  /* Favorite heart */
  .fav { position:absolute; top:8px; right:8px; cursor:pointer; font-size:20px;
         color:#cbd5e1; transition:transform .2s ease, color .2s ease; user-select:none; }
  .fav.active { color:#e11d48; }
  .fav.pop { transform:scale(1.4); }

  /* Broken image classy placeholder */
  .ph { width:100%; height:240px; display:grid; place-items:center;
    background:linear-gradient(135deg,#f3f4f6 10%, #eef2f7 90%); color:#64748b; font-weight:600; }
  .ph .dot { width:52px; height:52px; border-radius:14px; border:1px solid #e5e7eb; display:grid; place-items:center;
    background:#fff; box-shadow:0 2px 6px rgba(0,0,0,.05); }

  /* Empty state */
  .empty { text-align:center; padding:60px 20px; color:#64748b; display:none; }
  .empty svg { width:80px; height:80px; margin-bottom:16px; opacity:.7; }
  .empty h2 { font-size:20px; margin:0 0 8px; color:var(--ink); }
  .empty p { margin:0 0 20px; }
  .btn { display:inline-block; padding:10px 18px; border-radius:999px;
    background:#0ea5e9; color:#fff; font-weight:600; text-decoration:none; }

  /* SKELETONS */
  .skeleton-grid { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
  .sk-card { border:1px solid var(--line); border-radius:12px; background:#fff; overflow:hidden; }
  .sk-img { height:240px; background:linear-gradient(90deg,#f3f4f6 25%,#eef1f5 37%,#f3f4f6 63%); }
  .sk-row { height:18px; margin:12px; border-radius:6px;
    background:linear-gradient(90deg,#f3f4f6 25%,#eef1f5 37%,#f3f4f6 63%); }
  .sk-row.w60 { width:60%; } .sk-row.w40 { width:40%; } .sk-row.w30 { width:30%; }
  @keyframes shimmer { 0%{background-position:-200px 0} 100%{background-position:200px 0} }
  .sk-img, .sk-row { background-size:400px 100%; animation:shimmer 1.2s infinite linear; }
  @media (prefers-reduced-motion: reduce){ .sk-img,.sk-row { animation:none; } }
</style>
</head>
<body>
  <div class="wrap">
    <h1 style="margin:0 0 12px">Recent Listings</h1>

    <!-- Skeletons while loading -->
    <div id="skeletons" class="skeleton-grid" aria-hidden="true"></div>

    <!-- Real listings -->
    <div id="listings" class="grid" style="display:none;"></div>

    <!-- Empty state -->
    <div id="empty" class="empty">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M3 7l9-4 9 4M4 10h16v10H4z"/>
      </svg>
      <h2>No fabrics match your filters</h2>
      <p>Try adjusting your search or clear filters to see more.</p>
      <a href="#" class="btn" onclick="clearFilters()">Clear filters</a>
    </div>
  </div>

<script>
  // Inline placeholder SVG (unused now that we swap to a block placeholder)
  const PLACEHOLDER_SVG = encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='160' height='120' viewBox='0 0 160 120'><rect width='160' height='120' fill='#f3f4f6'/></svg>`);
  const PLACEHOLDER_URL = `data:image/svg+xml,${PLACEHOLDER_SVG}`;

  function humanizeDate(iso){ if(!iso) return "New arrival"; const dt=new Date(iso); if(isNaN(dt)) return "New arrival";
    const now=new Date(); const d=Math.floor((now-dt)/(24*60*60*1000));
    if(d<=1) return "New arrival"; if(d<7) return d+" days ago"; return dt.toLocaleDateString(); }

  function imgWithFallback(src, alt=''){ const img=document.createElement('img'); img.loading='lazy'; img.decoding='async'; img.src=src; img.alt=alt;
    img.onerror=()=>{ if(img.dataset.failed) return; img.dataset.failed=1; const wrap=img.parentElement; const ph=document.createElement('div'); ph.className='ph'; ph.innerHTML='<div class="dot">ðŸ§µ</div>'; wrap.replaceChild(ph,img); };
    return img; }

  function clearFilters(){ location.reload(); }

  // Build skeletons (6 cards)
  function renderSkeletons(){
    const host = document.getElementById('skeletons');
    host.innerHTML = '';
    for (let i=0;i<6;i++){
      const card = document.createElement('div');
      card.className = 'sk-card';
      card.innerHTML = `
        <div class="sk-img"></div>
        <div class="sk-row w60"></div>
        <div class="sk-row w30" style="margin-top:-6px;"></div>
      `;
      host.appendChild(card);
    }
  }

  async function loadListings(){
    // 1) show skeletons
    renderSkeletons();
    document.getElementById('skeletons').style.display = 'grid';
    document.getElementById('listings').style.display = 'none';
    document.getElementById('empty').style.display = 'none';

    // 2) fetch data
    const { data } = await fetch('/listings.json').then(r=>r.json()).catch(()=>({data:[]}));

    // 3) hide skeletons, show content
    const container = document.getElementById('listings');
    const empty = document.getElementById('empty');
    document.getElementById('skeletons').style.display = 'none';
    container.innerHTML = '';

    if(!data || data.length===0){
      empty.style.display = 'block';
      container.style.display = 'none';
      return;
    }
    container.style.display = 'grid';
    empty.style.display = 'none';

    const reduceMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    (data||[]).forEach((item,idx)=>{
      const price=(typeof item.price_cents==='number')?(item.price_cents/100).toFixed(2):(item.price||'0.00');
      const when=humanizeDate(item.created_at||item.date);

      const card=document.createElement('div'); card.className='listing-card';

      const imgwrap=document.createElement('div'); imgwrap.className='imgwrap';
      imgwrap.appendChild(imgWithFallback(item.image_url,item.title||''));

      const badge=document.createElement('div'); badge.className='badge'; badge.textContent=when; imgwrap.appendChild(badge);

      const fav=document.createElement('div'); fav.className='fav'; fav.textContent='â™¥';
      fav.addEventListener('click',e=>{e.stopPropagation();fav.classList.toggle('active');fav.classList.add('pop');setTimeout(()=>fav.classList.remove('pop'),200);});
      imgwrap.appendChild(fav);

      const overlay=document.createElement('div'); overlay.className='overlay'; overlay.textContent=item.quickpeek||"View details";
      imgwrap.appendChild(overlay);

      const info=document.createElement('div'); info.className='info';
      info.innerHTML=`<h3 class="title">${item.title||''}</h3><div class="price"><span class="cur">$</span>${price}</div>`;

      card.appendChild(imgwrap); card.appendChild(info); container.appendChild(card);

      if(!reduceMotion) setTimeout(()=>card.classList.add('show'),60*idx); else card.classList.add('show');
    });
  }

  loadListings();
</script>
</body>
</html>
