<!doctype html><html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Hemline — Listings</title>
<style>
:root{--ink:#0f172a;--bg:#fafafa;--card:#fff;--line:#e5e7eb;--accent:#0ea5e9}
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;margin:24px;background:var(--bg);color:var(--ink)}
.wrap{max-width:1100px;margin:auto}
.top{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
.link{color:var(--accent);text-decoration:none;border:1px solid var(--line);padding:6px 10px;border-radius:10px;margin-left:8px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:16px}
.card{position:relative;background:var(--card);border:1px solid var(--line);border-radius:12px;overflow:hidden}
.img{width:100%;height:200px;object-fit:cover;background:#f1f5f9;display:block}
.overlay{position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.0),rgba(0,0,0,.55));opacity:0;transition:opacity .22s ease}
.card:hover .overlay{opacity:1}
.info{position:absolute;left:12px;right:12px;bottom:12px;color:#fff;display:flex;justify-content:space-between;align-items:end}
.title{font-weight:700;text-shadow:0 1px 2px rgba(0,0,0,.35)}
.price{font-weight:700}
.btn{background:var(--accent);color:#fff;border:none;border-radius:10px;padding:8px 12px;cursor:pointer}
.empty{border:2px dashed var(--line);border-radius:12px;padding:18px;text-align:center;color:#475569}
</style></head>
<body>
<div class="wrap">
  <div class="top">
    <h1 style="margin:0">Listings</h1>
    <div>
      <a class="link" href="orders.html">View Orders</a>
      <a class="link" href="cart.html">View Cart →</a>
    </div>
  </div>

  <div id="grid" class="grid"></div>
  <div id="empty" class="empty" hidden>No listings found.</div>

  <div class="empty" style="margin-top:16px">
    Need a quick test? <button id="addTest" class="btn" style="margin-left:8px">Add Test Item to Cart</button>
  </div>
</div>

<script>
/* Config (keys included so you don't edit) */
const SUPABASE_URL="https://clkizksbvxjkoatdajgd.supabase.co";
const SUPABASE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNsa2l6a3Nidnhqa29hdGRhamdkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjM4MDE1ODIsImV4cCI6MjAzOTM3NzU4Mn0.MEu0Ex0bTtVnNuB-tAek95UbwsKdbWipzJrN84aKhlg";
const PLACEHOLDER="https://via.placeholder.com/600x400?text=Fabric";
const CART_KEY="hem_cart";

/* Cart helpers */
const readCart=()=>{try{return JSON.parse(localStorage.getItem(CART_KEY)||"[]")}catch{return[]}};
const saveCart=a=>localStorage.setItem(CART_KEY,JSON.stringify(a||[]));
function addToCart(item){const c=readCart();const f=c.find(x=>x.id===item.id); if(f){f.qty=(+f.qty||1)+(+item.qty||1)}else{c.push(item)}; saveCart(c); window.location.href="cart.html";}

/* Render cards with fade overlay (no flip) */
async function loadListings(){
  const grid=document.getElementById("grid"), empty=document.getElementById("empty");
  grid.innerHTML=""; empty.hidden=true;
  try{
    const r=await fetch(`${SUPABASE_URL}/rest/v1/listings?select=id,title,price,image_url`,{headers:{apikey:SUPABASE_KEY,Authorization:`Bearer ${SUPABASE_KEY}`},cache:"no-store"});
    const rows = r.ok ? await r.json() : [];
    if(!rows.length){ empty.hidden=false; return; }
    rows.forEach(it=>{
      const src=(it.image_url && /^https?:/i.test(it.image_url)) ? it.image_url : PLACEHOLDER;
      const card=document.createElement("div"); card.className="card";
      card.innerHTML=`
        <img class="img" src="${src}" alt="">
        <div class="overlay"></div>
        <div class="info">
          <div>
            <div class="title">${it.title||"Fabric"}</div>
            <div class="price">$${Number(it.price||0).toFixed(2)}/yd</div>
          </div>
          <button class="btn" data-id="${it.id}">Add</button>
        </div>`;
      grid.appendChild(card);
    });
    grid.addEventListener("click",e=>{
      const b=e.target.closest("button[data-id]"); if(!b) return;
      const id=b.getAttribute("data-id");
      const it = rows.find(x=>String(x.id)===String(id));
      const img=(it.image_url && /^https?:/i.test(it.image_url)) ? it.image_url : PLACEHOLDER;
      addToCart({id:it.id,title:it.title,price:Number(it.price||0),qty:1,img});
    });
  }catch(_){ empty.hidden=false; }
}

/* Test button */
document.getElementById("addTest").onclick=()=>addToCart({
  id:"test-"+Date.now(),title:"Cotton Sateen — Navy",price:18.5,qty:1,img:PLACEHOLDER
});

loadListings();
</script>
</body></html>
