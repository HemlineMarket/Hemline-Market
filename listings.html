<!doctype html><html lang="en"><head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Hemline — Listing</title>
<link rel="stylesheet" href="/css/tokens.css">
<link rel="stylesheet" href="/css/main.css">
</head><body>

<!-- Navbar -->
<nav class="navbar">
  <div>
    <a href="/index.html"><strong>Hemline</strong></a>
  </div>
  <div>
    <a href="/browse.html">Browse</a>
    <a href="/seller.html">Seller</a>
    <a href="/orders.html">Orders</a>
    <a href="/checkout.html">Checkout</a>
  </div>
</nav>

<div class="container-md">
  <div id="content">Loading…</div>
</div>

<!-- Footer (cleaned: no inline styles) -->
<footer class="container-md mt-7">
  <div class="card cluster items-center justify-between gap-4">
    <p class="muted">© <span id="y"></span> Hemline Market</p>
    <div class="cluster">
      <a class="btn" href="/seller.html">Seller</a>
      <a class="btn" href="/orders.html">Orders</a>
      <a class="btn" href="/checkout.html">Checkout</a>
    </div>
  </div>
  <script>document.getElementById("y").textContent = new Date().getFullYear();</script>
</footer>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="/js/env.js"></script>
<script>
const { SUPABASE_URL, SUPABASE_ANON_KEY } = window.HEMLINE_ENV||{};
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
const q = new URLSearchParams(location.search);
const id = q.get("id");
const el = document.getElementById("content");

if(id){ /* edit link lives on browse page; left out here intentionally */ }

function esc(s){return String(s||"").replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]))}
function fmtPrice(row){
  if (row.price!=null && Number.isFinite(Number(row.price))) return "$"+Number(row.price).toFixed(2);
  if (row.price_cents!=null && Number.isFinite(Number(row.price_cents))) return "$"+(Number(row.price_cents)/100).toFixed(2);
  return "—";
}

async function load(){
  if(!id){ el.innerHTML = "<p class='muted'>Missing listing id.</p>"; return; }
  const { data, error } = await supabase.from("listings")
    .select("id,title,description,price,price_cents,category,item_type,color,image_urls,created_at")
    .eq("id", id).single();
  if(error){ el.innerHTML = "Error: "+esc(error.message); return; }

  const imgs = Array.isArray(data.image_urls) && data.image_urls.length ? data.image_urls
              : ["https://placehold.co/800x600/png?text=No+Image"];
  const gallery = imgs.map(src=>`<img src="${esc(src)}" alt="">`).join("");

  el.innerHTML = `
    <div class="card">
      <div class="grid-2">
        <div>${gallery}</div>
        <div class="stack">
          <h1>${esc(data.title||"Untitled")}</h1>
          <div class="price">${fmtPrice(data)}</div>
          <p class="cluster">
            ${data.category ? `<span class="badge">${esc(data.category)}</span>` : ""}
            ${data.item_type ? `<span class="badge">${esc(data.item_type)}</span>` : ""}
            ${data.color ? `<span class="badge">${esc(data.color)}</span>` : ""}
          </p>
          <p>${esc(data.description||"")}</p>
          <p class="muted">Created: ${new Date(data.created_at).toLocaleString()}</p>
        </div>
      </div>
    </div>`;
}
load();
</script>
</body></html>
