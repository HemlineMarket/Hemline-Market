<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Hemline Market — Catalog</title>

  <link rel="stylesheet" href="/css/styles.css"/>

  <style>
    :root{
      --hm-header-h: 72px;
      --hm-gap: 12px;
      --hm-radius: 14px;
      --hm-border: 1px solid rgba(0,0,0,0.08);
      --hm-shadow: 0 6px 16px rgba(0,0,0,0.08);
      --hm-muted: #6b7280;
      --hm-text: #0f172a;
      --hm-bg: #ffffff;
      --hm-chip: #f3f4f6;
      --hm-chip-text: #111827;
      --hm-accent: #111827;
      --hm-z-header: 70;
      --hm-z-overlay: 60;
      --hm-z-drawer: 61;
    }

    /* ===== Header ===== */
    .hm-header{ position: sticky; top: 0; z-index: var(--hm-z-header); height: var(--hm-header-h); background:#fff; border-bottom: var(--hm-border); }
    .hm-header-inner{ height:100%; display:grid; grid-template-columns: 1fr auto 1fr; align-items:center; gap:12px; padding:0 16px; max-width:1200px; margin:0 auto; }
    .hm-logo{ display:flex; align-items:center; gap:10px; text-decoration:none; color:inherit; font-weight:800; letter-spacing:.2px; }
    .hm-logo img{ height:36px; width:auto; display:block; }
    .hm-nav{ display:flex; gap:18px; align-items:center; justify-content:center; }
    .hm-nav a{ text-decoration:none; color:var(--hm-text); font-weight:600; padding:8px 10px; border-radius:10px; }
    .hm-search{ display:flex; align-items:center; justify-content:flex-end; gap:8px; }
    .hm-search input{ width:min(100%,360px); padding:10px 12px; border-radius:12px; border:var(--hm-border); font-size:14px; }
    @media (max-width:820px){ .hm-header-inner{ grid-template-columns: auto 1fr auto; } .hm-nav{ display:none; } .hm-search input{ width:56vw; } }

    /* ===== Layout ===== */
    .hm-layout{ display:grid; grid-template-columns: 300px 1fr; gap:20px; align-items:start; padding:20px; }
    @media (max-width:980px){ .hm-layout{ grid-template-columns:1fr; padding:12px; } }

    /* Mobile topbar */
    .hm-topbar{ display:none; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px; }
    .hm-topbar .hm-btn{ display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:10px 14px; border-radius:12px; border:var(--hm-border); font-weight:600; cursor:pointer; background:#fff; }
    .hm-topbar .hm-btn svg{ width:18px; height:18px; }
    @media (max-width:980px){ .hm-topbar{ display:flex; } }

    /* Active chips */
    #active-filter-chips{ display:flex; flex-wrap:wrap; gap:8px; margin:4px 0 16px 0; }
    .hm-chip{ display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; background:var(--hm-chip); color:var(--hm-chip-text); font-size:12px; line-height:1; border:var(--hm-border); }
    .hm-chip button{ border:0; background:transparent; cursor:pointer; font-size:14px; line-height:1; }

    /* Panel (desktop) */
    #filters-panel{ position:sticky; top:var(--hm-header-h); max-height:calc(100vh - var(--hm-header-h) - 16px); overflow:auto; background:var(--hm-bg); border:var(--hm-border); border-radius:var(--hm-radius); box-shadow:var(--hm-shadow); padding:12px; }

    /* Drawer (mobile) */
    @media (max-width:980px){
      #filters-panel{ position:fixed; top:0; left:0; height:100dvh; max-height:none; width:min(92vw,360px); transform:translateX(-105%); transition:transform .28s ease; border-radius:0 16px 16px 0; padding:14px; z-index:var(--hm-z-drawer); }
      #filters-panel.is-open{ transform:translateX(0); }
      #filters-panel .drawer-spacer{ height:8px; }
    }
    #filters-overlay{ position:fixed; inset:0; background:rgba(0,0,0,.45); opacity:0; pointer-events:none; transition:opacity .28s ease; z-index:var(--hm-z-overlay); }
    #filters-overlay.is-open{ opacity:1; pointer-events:auto; }
    .drawer-header{ display:none; align-items:center; justify-content:space-between; gap:8px; margin:-4px 0 8px 0; padding-bottom:8px; border-bottom:var(--hm-border); }
    .drawer-title{ font-weight:700; }
    .drawer-close{ border:0; background:#fff; cursor:pointer; width:36px; height:36px; border-radius:10px; border:var(--hm-border); display:inline-flex; align-items:center; justify-content:center; }
    .drawer-close svg{ width:18px; height:18px; }
    @media (max-width:980px){ .drawer-header{ display:flex; } }

    /* Sections */
    #filters-panel details{ border-bottom:var(--hm-border); padding:4px 0 8px 0; }
    #filters-panel details:last-of-type{ border-bottom:0; }
    #filters-panel summary{ list-style:none; cursor:pointer; user-select:none; display:flex; align-items:center; justify-content:space-between; padding:8px 4px; font-weight:600; color:var(--hm-text); }
    #filters-panel summary::-webkit-details-marker{ display:none; }
    #filters-panel .summary-caret{ transition:transform .25s ease; }
    #filters-panel details[open] .summary-caret{ transform:rotate(90deg); }
    .filter-body{ padding:6px 4px 10px 4px; display:grid; gap:8px; }
    .filter-grid-2{ display:grid; grid-template-columns:1fr 1fr; gap:8px; }
    @media (max-width:480px){ .filter-grid-2{ grid-template-columns:1fr; } }
    .hm-input,.hm-select{ width:100%; padding:10px 12px; border-radius:10px; border:var(--hm-border); font-size:14px; }
    .hm-checklist{ display:grid; gap:6px; }
    .hm-check{ display:flex; align-items:center; gap:10px; font-size:14px; color:var(--hm-text); }
    .hm-check input{ width:16px; height:16px; }

    /* CTA */
    .filters-cta{ position:sticky; bottom:0; background:linear-gradient(to top,#fff 75%,rgba(255,255,255,0)); padding-top:10px; margin-top:10px; }
    .filters-cta .cta-row{ display:flex; gap:10px; }
    .hm-btn-wide{ width:100%; }
    .hm-btn--primary{ background:var(--hm-accent); color:#fff; border-color:transparent; }
    .hm-btn--ghost{ background:#fff; color:var(--hm-text); border:var(--hm-border); }

    /* Results scaffold */
    .results-grid{ display:grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap:16px; }
    @media (max-width:1100px){ .results-grid{ grid-template-columns: repeat(2, minmax(0,1fr)); } }
    @media (max-width:640px){ .results-grid{ grid-template-columns:1fr; } }
    .result-card{ border:var(--hm-border); border-radius:12px; overflow:hidden; background:#fff; }
    .result-card img{ width:100%; height:220px; object-fit:cover; display:block; }
    .result-card .rc-body{ padding:10px 12px; }
    .result-card .rc-title{ font-weight:600; margin:0 0 6px 0; }
    .result-card .rc-price{ color:#111827; font-weight:700; }
  </style>
</head>
<body>

  <!-- ===== Header ===== -->
  <header class="hm-header" role="banner">
    <div class="hm-header-inner">
      <a class="hm-logo" href="/" aria-label="Hemline Market home">
        <img src="/logo.png" alt="Hemline Market logo" onerror="this.style.display='none'"><span>Hemline Market</span>
      </a>
      <nav class="hm-nav" aria-label="Primary">
        <a href="/">Home</a><a href="/catalog-v2">Catalog</a><a href="/atelier">Atelier</a><a href="/seller.html">Sell</a>
      </nav>
      <form class="hm-search" role="search" action="/search" method="get">
        <input name="q" type="search" placeholder="Search fabrics, trims, sellers…" aria-label="Search"/>
      </form>
    </div>
  </header>

  <main class="hm-layout">
    <!-- MOBILE TOPBAR -->
    <div class="hm-topbar">
      <button id="open-filters" class="hm-btn" type="button" aria-controls="filters-panel" aria-expanded="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 5h18v2H3V5zm4 6h10v2H7v-2zm3 6h4v2h-4v-2z"/></svg>
        Filters
      </button>
    </div>

    <!-- OVERLAY -->
    <div id="filters-overlay" aria-hidden="true"></div>

    <!-- ===== FILTERS ===== -->
    <aside id="filters-panel" aria-label="Filters" aria-modal="true">
      <div class="drawer-header">
        <div class="drawer-title">Filters</div>
        <button class="drawer-close" type="button" aria-label="Close filters">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M18.3 5.71 12 12l6.3 6.29-1.41 1.42L10.59 13.4 4.29 19.7 2.88 18.29 9.17 12 2.88 5.71 4.29 4.29l6.3 6.3 6.29-6.3z"/></svg>
        </button>
      </div>

      <!-- Category -->
      <details open>
        <summary>Category <span class="summary-caret">›</span></summary>
        <div class="filter-body hm-checklist">
          <label class="hm-check"><input type="checkbox" name="category" value="fabric"  data-group-label="Category">Fabric</label>
          <label class="hm-check"><input type="checkbox" name="category" value="trims"   data-group-label="Category">Trims</label>
          <label class="hm-check"><input type="checkbox" name="category" value="notions" data-group-label="Category">Notions</label>
          <label class="hm-check"><input type="checkbox" name="category" value="handmade"data-group-label="Category">Handmade</label>
        </div>
      </details>

      <!-- Fabric Type (woven/knit/leather/special) -->
      <details open>
        <summary>Fabric Type <span class="summary-caret">›</span></summary>
        <div class="filter-body hm-checklist">
          <label class="hm-check"><input type="checkbox" name="fabric_type" value="woven"   data-group-label="Fabric Type">Woven</label>
          <label class="hm-check"><input type="checkbox" name="fabric_type" value="knit"    data-group-label="Fabric Type">Knit</label>
          <label class="hm-check"><input type="checkbox" name="fabric_type" value="leather" data-group-label="Fabric Type">Leather</label>
          <label class="hm-check"><input type="checkbox" name="fabric_type" value="lace"    data-group-label="Fabric Type">Lace</label>
          <label class="hm-check"><input type="checkbox" name="fabric_type" value="mesh"    data-group-label="Fabric Type">Mesh/Tulle</label>
        </div>
      </details>

      <!-- Fiber Content -->
      <details>
        <summary>Fiber Content <span class="summary-caret">›</span></summary>
        <div class="filter-body hm-checklist">
          <label class="hm-check"><input type="checkbox" name="fiber" value="wool"   data-group-label="Fiber">Wool</label>
          <label class="hm-check"><input type="checkbox" name="fiber" value="silk"   data-group-label="Fiber">Silk</label>
          <label class="hm-check"><input type="checkbox" name="fiber" value="cotton" data-group-label="Fiber">Cotton</label>
          <label class="hm-check"><input type="checkbox" name="fiber" value="linen"  data-group-label="Fiber">Linen</label>
          <label class="hm-check"><input type="checkbox" name="fiber" value="cashmere" data-group-label="Fiber">Cashmere</label>
          <label class="hm-check"><input type="checkbox" name="fiber" value="viscose"  data-group-label="Fiber">Viscose/Rayon</label>
          <label class="hm-check"><input type="checkbox" name="fiber" value="polyamide" data-group-label="Fiber">Nylon/Polyamide</label>
          <label class="hm-check"><input type="checkbox" name="fiber" value="polyester" data-group-label="Fiber">Polyester</label>
          <label class="hm-check"><input type="checkbox" name="fiber" value="elastane"  data-group-label="Fiber">Elastane/Spandex</label>
          <label class="hm-check"><input type="checkbox" name="fiber" value="blend"    data-group-label="Fiber">Blend</label>
        </div>
      </details>

      <!-- Weave / Knit Structure -->
      <details>
        <summary>Weave / Knit <span class="summary-caret">›</span></summary>
        <div class="filter-body hm-checklist">
          <label class="hm-check"><input type="checkbox" name="weave" value="twill"    data-group-label="Weave/Knit">Twill</label>
          <label class="hm-check"><input type="checkbox" name="weave" value="crepe"    data-group-label="Weave/Knit">Crepe</label>
          <label class="hm-check"><input type="checkbox" name="weave" value="satin"    data-group-label="Weave/Knit">Satin</label>
          <label class="hm-check"><input type="checkbox" name="weave" value="boucle"   data-group-label="Weave/Knit">Bouclé</label>
          <label class="hm-check"><input type="checkbox" name="weave" value="gabardine"data-group-label="Weave/Knit">Gabardine</label>
          <label class="hm-check"><input type="checkbox" name="weave" value="jersey"   data-group-label="Weave/Knit">Jersey</label>
          <label class="hm-check"><input type="checkbox" name="weave" value="rib"      data-group-label="Weave/Knit">Rib Knit</label>
          <label class="hm-check"><input type="checkbox" name="weave" value="poplin"   data-group-label="Weave/Knit">Poplin</label>
          <label class="hm-check"><input type="checkbox" name="weave" value="chiffon"  data-group-label="Weave/Knit">Chiffon</label>
          <label class="hm-check"><input type="checkbox" name="weave" value="tulle"    data-group-label="Weave/Knit">Tulle</label>
        </div>
      </details>

      <!-- Weight (GSM) -->
      <details open>
        <summary>Weight (GSM) <span class="summary-caret">›</span></summary>
        <div class="filter-body">
          <div class="hm-checklist">
            <label class="hm-check"><input type="checkbox" name="weight" value="0-100"   data-group-label="Weight">0–100 (sheer/light)</label>
            <label class="hm-check"><input type="checkbox" name="weight" value="101-200" data-group-label="Weight">101–200 (light-mid)</label>
            <label class="hm-check"><input type="checkbox" name="weight" value="201-300" data-group-label="Weight">201–300 (mid)</label>
            <label class="hm-check"><input type="checkbox" name="weight" value="301-450" data-group-label="Weight">301–450 (mid-heavy)</label>
            <label class="hm-check"><input type="checkbox" name="weight" value="451+"    data-group-label="Weight">451+ (coat)</label>
          </div>
        </div>
      </details>

      <!-- Width (inches) -->
      <details>
        <summary>Width (in) <span class="summary-caret">›</span></summary>
        <div class="filter-body filter-grid-2">
          <input id="width-min" class="hm-input" type="number" inputmode="numeric" placeholder="Min" data-role="min" data-group="width" data-group-label="Width (in)">
          <input id="width-max" class="hm-input" type="number" inputmode="numeric" placeholder="Max" data-role="max" data-group="width" data-group-label="Width (in)">
        </div>
      </details>

      <!-- Stretch % -->
      <details>
        <summary>Stretch % <span class="summary-caret">›</span></summary>
        <div class="filter-body filter-grid-2">
          <input id="stretch-min" class="hm-input" type="number" inputmode="numeric" placeholder="Min" data-role="min" data-group="stretch" data-group-label="Stretch (%)">
          <input id="stretch-max" class="hm-input" type="number" inputmode="numeric" placeholder="Max" data-role="max" data-group="stretch" data-group-label="Stretch (%)">
        </div>
      </details>

      <!-- Yardage Available -->
      <details>
        <summary>Yardage Available <span class="summary-caret">›</span></summary>
        <div class="filter-body filter-grid-2">
          <input id="yardage-min" class="hm-input" type="number" inputmode="numeric" placeholder="Min" data-role="min" data-group="yardage" data-group-label="Yardage (yd)">
          <input id="yardage-max" class="hm-input" type="number" inputmode="numeric" placeholder="Max" data-role="max" data-group="yardage" data-group-label="Yardage (yd)">
        </div>
      </details>

      <!-- Color -->
      <details>
        <summary>Color <span class="summary-caret">›</span></summary>
        <div class="filter-body hm-checklist">
          <label class="hm-check"><input type="checkbox" name="color" value="black"  data-group-label="Color">Black</label>
          <label class="hm-check"><input type="checkbox" name="color" value="white"  data-group-label="Color">White</label>
          <label class="hm-check"><input type="checkbox" name="color" value="navy"   data-group-label="Color">Navy</label>
          <label class="hm-check"><input type="checkbox" name="color" value="camel"  data-group-label="Color">Camel</label>
          <label class="hm-check"><input type="checkbox" name="color" value="red"    data-group-label="Color">Red</label>
          <label class="hm-check"><input type="checkbox" name="color" value="green"  data-group-label="Color">Green</label>
          <label class="hm-check"><input type="checkbox" name="color" value="pink"   data-group-label="Color">Pink</label>
          <label class="hm-check"><input type="checkbox" name="color" value="brown"  data-group-label="Color">Brown</label>
          <label class="hm-check"><input type="checkbox" name="color" value="grey"   data-group-label="Color">Grey</label>
        </div>
      </details>

      <!-- Pattern -->
      <details>
        <summary>Pattern <span class="summary-caret">›</span></summary>
        <div class="filter-body hm-checklist">
          <label class="hm-check"><input type="checkbox" name="pattern" value="solid"   data-group-label="Pattern">Solid</label>
          <label class="hm-check"><input type="checkbox" name="pattern" value="stripe"  data-group-label="Pattern">Stripe</label>
          <label class="hm-check"><input type="checkbox" name="pattern" value="plaid"   data-group-label="Pattern">Plaid</label>
          <label class="hm-check"><input type="checkbox" name="pattern" value="floral"  data-group-label="Pattern">Floral</label>
          <label class="hm-check"><input type="checkbox" name="pattern" value="abstract"data-group-label="Pattern">Abstract</label>
          <label class="hm-check"><input type="checkbox" name="pattern" value="dots"    data-group-label="Pattern">Dots</label>
          <label class="hm-check"><input type="checkbox" name="pattern" value="herringbone" data-group-label="Pattern">Herringbone</label>
        </div>
      </details>

      <!-- Finish -->
      <details>
        <summary>Finish <span class="summary-caret">›</span></summary>
        <div class="filter-body hm-checklist">
          <label class="hm-check"><input type="checkbox" name="finish" value="matte"    data-group-label="Finish">Matte</label>
          <label class="hm-check"><input type="checkbox" name="finish" value="lustre"   data-group-label="Finish">Lustre</label>
          <label class="hm-check"><input type="checkbox" name="finish" value="sheen"    data-group-label="Finish">High Sheen</label>
          <label class="hm-check"><input type="checkbox" name="finish" value="metallic" data-group-label="Finish">Metallic</label>
          <label class="hm-check"><input type="checkbox" name="finish" value="brushed"  data-group-label="Finish">Brushed</label>
        </div>
      </details>

      <!-- Season / Use -->
      <details>
        <summary>Season / Use <span class="summary-caret">›</span></summary>
        <div class="filter-body hm-checklist">
          <label class="hm-check"><input type="checkbox" name="season" value="all"     data-group-label="Season">All-season</label>
          <label class="hm-check"><input type="checkbox" name="season" value="spring"  data-group-label="Season">Spring</label>
          <label class="hm-check"><input type="checkbox" name="season" value="summer"  data-group-label="Season">Summer</label>
          <label class="hm-check"><input type="checkbox" name="season" value="fall"    data-group-label="Season">Fall</label>
          <label class="hm-check"><input type="checkbox" name="season" value="winter"  data-group-label="Season">Winter</label>
          <label class="hm-check"><input type="checkbox" name="use"    value="suiting" data-group-label="Use">Suiting</label>
          <label class="hm-check"><input type="checkbox" name="use"    value="dress"   data-group-label="Use">Dress</label>
          <label class="hm-check"><input type="checkbox" name="use"    value="coat"    data-group-label="Use">Coat</label>
          <label class="hm-check"><input type="checkbox" name="use"    value="blouse"  data-group-label="Use">Blouse</label>
          <label class="hm-check"><input type="checkbox" name="use"    value="skirt"   data-group-label="Use">Skirt</label>
        </div>
      </details>

      <!-- Origin -->
      <details>
        <summary>Origin <span class="summary-caret">›</span></summary>
        <div class="filter-body hm-checklist">
          <label class="hm-check"><input type="checkbox" name="origin" value="italy"   data-group-label="Origin">Italy</label>
          <label class="hm-check"><input type="checkbox" name="origin" value="france"  data-group-label="Origin">France</label>
          <label class="hm-check"><input type="checkbox" name="origin" value="japan"   data-group-label="Origin">Japan</label>
          <label class="hm-check"><input type="checkbox" name="origin" value="uk"      data-group-label="Origin">UK</label>
          <label class="hm-check"><input type="checkbox" name="origin" value="usa"     data-group-label="Origin">USA</label>
          <label class="hm-check"><input type="checkbox" name="origin" value="other"   data-group-label="Origin">Other</label>
        </div>
      </details>

      <!-- Seller -->
      <details>
        <summary>Seller <span class="summary-caret">›</span></summary>
        <div class="filter-body">
          <select class="hm-select" name="seller" data-group-label="Seller">
            <option value="">Any seller</option>
            <option value="atelier">Atelier</option>
            <option value="indie">Independent</option>
            <option value="mill">Mill/Deadstock</option>
          </select>
        </div>
      </details>

      <!-- Shipping -->
      <details>
        <summary>Shipping <span class="summary-caret">›</span></summary>
        <div class="filter-body hm-checklist">
          <label class="hm-check"><input type="checkbox" name="shipping" value="flat" data-group-label="Shipping">Flat rate</label>
          <label class="hm-check"><input type="checkbox" name="shipping" value="free" data-group-label="Shipping">Free shipping</label>
          <label class="hm-check"><input type="checkbox" name="shipping" value="pickup" data-group-label="Shipping">Local pickup</label>
        </div>
      </details>

      <!-- Condition -->
      <details>
        <summary>Condition <span class="summary-caret">›</span></summary>
        <div class="filter-body hm-checklist">
          <label class="hm-check"><input type="checkbox" name="condition" value="new"       data-group-label="Condition">New</label>
          <label class="hm-check"><input type="checkbox" name="condition" value="deadstock" data-group-label="Condition">Deadstock</label>
          <label class="hm-check"><input type="checkbox" name="condition" value="reclaimed" data-group-label="Condition">Reclaimed</label>
        </div>
      </details>

      <!-- Price -->
      <details open>
        <summary>Price <span class="summary-caret">›</span></summary>
        <div class="filter-body filter-grid-2">
          <input id="price-min" class="hm-input" type="number" inputmode="numeric" placeholder="Min" data-role="min" data-group="price" data-group-label="Price">
          <input id="price-max" class="hm-input" type="number" inputmode="numeric" placeholder="Max" data-role="max" data-group="price" data-group-label="Price">
        </div>
      </details>

      <!-- Sort -->
      <details>
        <summary>Sort <span class="summary-caret">›</span></summary>
        <div class="filter-body">
          <select class="hm-select" name="sort" data-group-label="Sort">
            <option value="">Featured</option>
            <option value="price_asc">Price: Low → High</option>
            <option value="price_desc">Price: High → Low</option>
            <option value="newest">Newest</option>
            <option value="yardage_desc">Yardage: High → Low</option>
          </select>
        </div>
      </details>

      <!-- Drawer spacer + CTA -->
      <div class="drawer-spacer"></div>
      <div class="filters-cta">
        <div class="cta-row">
          <button type="button" class="hm-btn hm-btn--ghost hm-btn-wide" data-action="reset-filters">Reset</button>
          <button type="button" class="hm-btn hm-btn--primary hm-btn-wide" data-action="apply-filters">Apply</button>
        </div>
      </div>
    </aside>

    <!-- ===== RESULTS ===== -->
    <section id="category-results">
      <div id="active-filter-chips"></div>

      <div class="results-grid" id="results">
        <!-- Placeholder cards (we will replace images in next step) -->
        <article class="result-card">
          <img src="https://picsum.photos/seed/hem1/600/400" alt="Placeholder"/>
          <div class="rc-body"><p class="rc-title">Sample Wool Crepe</p><p class="rc-price">$45</p></div>
        </article>
        <article class="result-card">
          <img src="https://picsum.photos/seed/hem2/600/400" alt="Placeholder"/>
          <div class="rc-body"><p class="rc-title">Italian Silk Twill</p><p class="rc-price">$68</p></div>
        </article>
        <article class="result-card">
          <img src="https://picsum.photos/seed/hem3/600/400" alt="Placeholder"/>
          <div class="rc-body"><p class="rc-title">Cotton Sateen</p><p class="rc-price">$22</p></div>
        </article>
      </div>
    </section>
  </main>

  <script>
    (function(){
      const panel = document.getElementById('filters-panel');
      if(!panel) return;

      const chipsRow = document.getElementById('active-filter-chips');
      const openBtn  = document.getElementById('open-filters');
      const overlay  = document.getElementById('filters-overlay');
      const closeBtn = panel.querySelector('.drawer-close');

      const $$ = (sel, root=document)=> Array.from(root.querySelectorAll(sel));

      /* Drawer controls */
      const openDrawer = ()=>{ panel.classList.add('is-open'); overlay.classList.add('is-open'); openBtn?.setAttribute('aria-expanded','true'); panel.querySelector('summary, input, select, button')?.focus({preventScroll:true}); };
      const closeDrawer = ()=>{ panel.classList.remove('is-open'); overlay.classList.remove('is-open'); openBtn?.setAttribute('aria-expanded','false'); openBtn?.focus({preventScroll:true}); };
      openBtn?.addEventListener('click', openDrawer);
      overlay?.addEventListener('click', closeDrawer);
      closeBtn?.addEventListener('click', closeDrawer);
      document.addEventListener('keydown', e=>{ if(e.key==='Escape' && panel.classList.contains('is-open')) closeDrawer(); });

      /* Chip helpers */
      const formatLabel = (el)=>{
        const dl = el.getAttribute('data-label'); if (dl) return dl;
        const id = el.id; if (id){ const lbl = panel.querySelector(`label[for="${id}"]`); if (lbl) return lbl.textContent.trim(); }
        if (el.tagName === 'SELECT') return el.options[el.selectedIndex]?.text?.trim() || '';
        return (el.value || '').trim();
      };
      const keyFor = (el)=> el.getAttribute('name') || el.getAttribute('data-filter-key') || el.id || '';
      const addChip = (key, label, clearFn)=>{
        if(!chipsRow) return;
        chipsRow.querySelectorAll(`[data-chip-key="${key}"]`).forEach(n=>n.remove());
        if(!label) return;
        const chip = document.createElement('span');
        chip.className = 'hm-chip'; chip.dataset.chipKey = key;
        chip.innerHTML = `<span>${label}</span><button type="button" aria-label="Clear ${label}">✕</button>`;
        chip.querySelector('button').addEventListener('click', ()=>{ clearFn?.(); chip.remove(); panel.dispatchEvent(new CustomEvent('filters:change',{bubbles:true})); });
        chipsRow.appendChild(chip);
      };

      /* Wire inputs */
      const wireInput = (el)=>{
        const key = keyFor(el); if(!key) return;
        const update = ()=>{
          let label = '';
          if (el.type === 'checkbox') {
            const groupChecked = $$(`input[name="${el.name}"]`, panel).filter(i=>i.checked);
            label = groupChecked.length ? `${el.getAttribute('data-group-label') || el.name}: ${groupChecked.map(formatLabel).join(', ')}` : '';
            addChip(el.name, label, ()=> groupChecked.forEach(i=> i.checked=false));
          } else if (el.type === 'radio') {
            const checked = $$(`input[name="${el.name}"]`, panel).find(i=>i.checked);
            label = checked ? `${el.getAttribute('data-group-label') || el.name}: ${formatLabel(checked)}` : '';
            addChip(el.name, label, ()=>{ if (checked) checked.checked=false; });
          } else if (el.tagName === 'SELECT') {
            if (el.multiple) {
              const selected = $$('option:checked', el);
              label = selected.length ? `${el.getAttribute('data-group-label') || el.name}: ${selected.map(o=>o.text.trim()).join(', ')}` : '';
              addChip(key, label, ()=> $$('option:checked', el).forEach(o=>o.selected=false));
            } else {
              label = el.value ? `${el.getAttribute('data-group-label') || el.name}: ${formatLabel(el)}` : '';
              addChip(key, label, ()=>{ el.value=''; });
            }
          } else if (el.type === 'number' || el.type === 'text') {
            if (el.dataset.role && el.dataset.group) {
              const g = el.dataset.group;
              const from = panel.querySelector(`[data-group="${g}"][data-role="min"]`)?.value || '';
              const to   = panel.querySelector(`[data-group="${g}"][data-role="max"]`)?.value || '';
              const any  = from || to;
              addChip(g, any ? `${el.getAttribute('data-group-label') || g}: ${from || '—'} to ${to || '—'}` : '', ()=>{
                const a = panel.querySelector(`[data-group="${g}"][data-role="min"]`);
                const b = panel.querySelector(`[data-group="${g}"][data-role="max"]`);
                if(a) a.value=''; if(b) b.value='';
              });
            } else {
              label = el.value ? `${el.getAttribute('data-group-label') || key}: ${el.value}` : '';
              addChip(key, label, ()=>{ el.value=''; });
            }
          }
        };
        update();
        el.addEventListener('change', update);
        el.addEventListener('input', ()=>{ if (el.type==='number' || el.type==='text') update(); });
      };
      $$('.filter-body input, .filter-body select', panel).forEach(wireInput);

      /* Reset / Apply */
      const resetBtn = panel.querySelector('[data-action="reset-filters"]');
      const applyBtn = panel.querySelector('[data-action="apply-filters"]');
      resetBtn?.addEventListener('click', ()=>{
        $$('.filter-body input[type="checkbox"]', panel).forEach(i=> i.checked=false);
        $$('.filter-body input[type="radio"]', panel).forEach(i=> i.checked=false);
        $$('.filter-body input[type="text"], .filter-body input[type="number"]', panel).forEach(i=> i.value='');
        $$('.filter-body select', panel).forEach(s=>{ if(s.multiple){ $$('option:checked', s).forEach(o=>o.selected=false); } else { s.value=''; } });
        chipsRow?.replaceChildren();
        panel.dispatchEvent(new CustomEvent('filters:reset',{bubbles:true}));
        panel.dispatchEvent(new CustomEvent('filters:change',{bubbles:true}));
      });
      applyBtn?.addEventListener('click', ()=>{
        const query = {};
        const inputs = $$('.filter-body input, .filter-body select', panel);
        inputs.forEach(el=>{
          const key = keyFor(el); if(!key) return;
          if (el.type==='checkbox'){ if (!query[key]) query[key]=[]; if(el.checked) query[key].push(el.value); }
          else if (el.type==='radio'){ if (el.checked) query[key]=el.value; }
          else if (el.tagName==='SELECT'){
            if (el.multiple){ query[key]=$$('option:checked', el).map(o=>o.value); }
            else if (el.value){ query[key]=el.value; }
          } else if (el.type==='number' || el.type==='text'){
            if (el.dataset.role && el.dataset.group){ const g=el.dataset.group; query[g]=query[g]||{}; query[g][el.dataset.role]=el.value; }
            else if (el.value){ query[key]=el.value; }
          }
        });
        panel.dispatchEvent(new CustomEvent('filters:apply',{detail:{query}, bubbles:true}));
        if (panel.classList.contains('is-open')) closeDrawer();
        console.log('filters:apply', query);
      });
    })();
  </script>
</body>
</html>
