<script>
  const SUPABASE_URL = "https://clkizksbvxjkoatdajgd.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNsa2l6a3Nidnhqa29hdGRhamdkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2ODAyMDUsImV4cCI6MjA3MDI1NjIwNX0.m3wd6UAuqxa7BpcQof9mmzd8zdsmadwGDO0x7-nyBjI";
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  const form = document.querySelector("form");
  const status = document.getElementById("status");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const file = document.getElementById("file").files[0];
    if (!file) return;

    const filePath = `test/${Date.now()}-${file.name}`;
    const { data, error } = await supabase.storage
      .from("listing-images")
      .upload(filePath, file);

    if (error) {
      status.textContent = "❌ " + error.message;
    } else {
      // build a public URL
      const { data: publicUrl } = supabase.storage
        .from("listing-images")
        .getPublicUrl(filePath);

      status.innerHTML = `✅ Uploaded — <a href="${publicUrl.publicUrl}" target="_blank">${publicUrl.publicUrl}</a>`;
    }
  });
</script>
