<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hemline Market — Catalog</title>
  <script defer src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <link rel="icon" href="/favicon.ico">
  <style>
    body { font: 14px/1.4 system-ui, sans-serif; margin:0; color:#111; }
    .wrap { max-width: 900px; margin: 0 auto; padding: 20px; }
    .card { border:1px solid #ddd; border-radius:12px; padding:12px; margin:10px 0; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Catalog Debug</h1>
    <button id="apply">Run Query</button>
    <div id="results"></div>
    <pre id="log" style="background:#f9f9f9;padding:10px;border:1px solid #ddd;white-space:pre-wrap;"></pre>
  </div>

  <script>
    // === Supabase credentials (replace these two values with your real ones from Supabase dashboard) ===
    const SUPABASE_URL = "https://YOUR-PROJECT-REF.supabase.co";
    const SUPABASE_ANON_KEY = "YOUR-ANON-KEY";
    // =================================================================================================

    const logEl = document.getElementById('log');
    function log(msg) {
      console.log(msg);
      logEl.textContent += msg + "\n";
    }

    window.addEventListener("error", function(e) {
      document.body.innerHTML += "<div style='color:red;padding:20px;'>Global Error: " + e.message + "</div>";
    });
    window.addEventListener("unhandledrejection", function(e) {
      document.body.innerHTML += "<div style='color:red;padding:20px;'>Unhandled Promise: " + e.reason + "</div>";
    });

    try {
      const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      async function run() {
        document.getElementById('results').innerHTML = "Loading…";
        const { data, error } = await supabase.from('catalog').select('*').limit(5);
        if (error) {
          log("Supabase error: " + error.message);
          document.getElementById('results').innerHTML = "<p style='color:red;'>Supabase error: " + error.message + "</p>";
          return;
        }
        log("Got rows: " + JSON.stringify(data, null, 2));
        document.getElementById('results').innerHTML = data.map(
          d => "<div class='card'>" + (d.title || 'Fabric') + "</div>"
        ).join('');
      }

      document.getElementById('apply').addEventListener('click', run);
      run();
    } catch (err) {
      log("Runtime error: " + err.message);
      document.getElementById('results').innerHTML = "<p style='color:red;'>Runtime error: " + err.message + "</p>";
    }
  </script>
</body>
</html>
