<!doctype html><html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Hemline — Listings</title>
<style>:root{--ink:#0f172a;--bg:#fafafa;--card:#fff;--line:#e5e7eb;--accent:#0ea5e9}
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;margin:24px;background:var(--bg);color:var(--ink)}
.wrap{max-width:820px;margin:auto}
.btn{border:1px solid var(--line);background:#fff;border-radius:10px;padding:8px 12px;cursor:pointer}
.cta{background:var(--accent);color:#fff;border:none;border-radius:10px;padding:8px 12px;cursor:pointer}
.card{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:14px;margin:10px 0}
.meta{color:#475569}</style></head>
<body><div class="wrap">
  <div style="display:flex;gap:10px;justify-content:space-between;align-items:center">
    <h1 style="margin:0">Listings</h1>
    <div>
      <a class="btn" href="orders.html">View Orders</a>
      <a class="btn" href="cart.html">View Cart →</a>
    </div>
  </div>

  <div id="listings" class="card">No listings found.</div>

  <div class="card">
    <div style="display:flex;gap:10px;align-items:center;justify-content:space-between">
      <div>
        <strong>Add Test Item to Cart</strong>
        <div class="meta">Quick test without Supabase.</div>
      </div>
      <button id="addTest" class="cta">Add Test Item</button>
    </div>
  </div>
</div>

<script>
const KEY="hem_cart";
const PH="https://via.placeholder.com/300x200?text=Fabric";
const $=id=>document.getElementById(id);

// Optional: show listings from Supabase if available
(async function load(){
  const box=$("listings");
  try{
    const URL="https://clkizksbvxjkoatdajgd.supabase.co/rest/v1/listings?select=*";
    const KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNsa2l6a3Nidnhqa29hdGRhamdkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjM4MDE1ODIsImV4cCI6MjAzOTM3NzU4Mn0.MEu0Ex0bTtVnNuB-tAek95UbwsKdbWipzJrN84aKhlg";
    const r=await fetch(URL,{headers:{apikey:KEY,Authorization:`Bearer ${KEY}`},cache:"no-store"});
    if(!r.ok) return;
    const rows=await r.json();
    if(!rows.length) return;
    box.innerHTML="";
    rows.forEach(it=>{
      const div=document.createElement("div"); div.className="card";
      div.innerHTML=`<div style="display:flex;justify-content:space-between"><div><strong>${it.title||"Fabric"}</strong><div class="meta">$${Number(it.price||0).toFixed(2)}/yd</div></div><button class="btn" data-id="${it.id}">Add to Cart</button></div>`;
      box.appendChild(div);
    });
    box.addEventListener("click",e=>{
      const b=e.target.closest("button[data-id]"); if(!b) return;
      const id=b.getAttribute("data-id"); const row=rows.find(x=>String(x.id)===String(id));
      addToCart({id:row.id,title:row.title,price:Number(row.price||0),qty:1,img:row.image_url||PH});
    });
  }catch(_){/* ignore */ }
})();

function addToCart(item){
  const cart=JSON.parse(localStorage.getItem(KEY)||"[]");
  const found=cart.find(x=>x.id===item.id && x.title===item.title);
  if(found){ found.qty=(+found.qty||1)+(+item.qty||1); }
  else{ cart.push(item); }
  localStorage.setItem(KEY,JSON.stringify(cart));
  window.location.href="cart.html";
}

$("addTest").onclick=()=>addToCart({
  id:"test-"+Date.now(),
  title:"Cotton Sateen — Navy",
  price:18.5,
  qty:1,
  img:PH
});
</script>
</body></html>
