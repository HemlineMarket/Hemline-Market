<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Sign In — Hemline Market</title>
  <style>
    :root{--hm-border:#e5e7eb;--hm-accent:#991b1b;--ink:#111827;--muted:#6b7280}
    html,body{
      margin:0;max-width:100%;overflow-x:hidden;background:#fafafa;color:var(--ink);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      -webkit-font-smoothing:antialiased;
    }
    img,svg,canvas,video{max-width:100%;height:auto;display:block}
    .wrap{max-width:1200px;margin:0 auto;padding:0 12px}
    .hm-header{min-height:56px;background:#fff;border-bottom:1px solid var(--hm-border)}
    .hm-header .wrap{display:flex;align-items:center;justify-content:space-between}
    .hm-brand{font-size:24px;font-weight:800;color:var(--hm-accent);text-decoration:none}
    .right{display:flex;align-items:center;gap:14px}
    .hamburger{
      display:inline-grid;place-items:center;width:40px;height:40px;
      border:1px solid var(--hm-border);border-radius:10px;background:#fff;color:#374151
    }
    .hamburger svg{width:26px;height:26px;stroke-width:2.5}
    .hm-icon{color:#444;display:inline-grid;place-items:center}
    .hm-icon svg{width:26px;height:26px;stroke-width:2}
    .hm-avatar{
      width:28px;height:28px;border-radius:50%;border:1px solid var(--hm-border);
      background:#fff;color:#334155;display:inline-grid;place-items:center;
      font-weight:700;font-size:12px;text-decoration:none;
      background-size:cover;background-position:center;padding:0 6px;
    }
    .hm-footer{background:#fff;border-top:1px solid var(--hm-border);margin-top:18px}
    .hm-footer .footer-wrap{
      max-width:1200px;margin:0 auto;padding:12px 16px;
      display:flex;flex-wrap:wrap;gap:8px;align-items:center;justify-content:space-between
    }
    .hm-footer .footer-links a{color:#4b5563;text-decoration:none}
    .hm-footer .footer-links a:hover{text-decoration:underline}

    .auth-container{
      max-width:420px;margin:40px auto;background:#fff;border:1px solid var(--hm-border);
      border-radius:12px;padding:24px;display:grid;gap:16px
    }
    h1{margin:0 0 8px;text-align:center}
    .muted{text-align:center;color:var(--muted);margin:0}
    form{display:grid;gap:12px}
    input{padding:12px;border:1px solid var(--hm-border);border-radius:8px;font:inherit}
    button.primary{
      background:var(--hm-accent);color:#fff;border:none;border-radius:8px;
      padding:12px;font-weight:700;cursor:pointer
    }
    button.oauth{
      border:1px solid #d1d5db;border-radius:8px;padding:10px 12px;
      display:flex;align-items:center;gap:10px;justify-content:center;
      background:#fff;cursor:pointer;font-size:14px;font-weight:500;
    }
    button.oauth svg{width:18px;height:18px}
    .divider{display:flex;align-items:center;gap:12px;color:#6b7280;font-size:14px}
    .divider::before,.divider::after{content:"";flex:1;height:1px;background:#e5e7eb}
    .links{text-align:center;display:grid;gap:6px;font-size:14px}
    .links a{color:var(--hm-accent);text-decoration:none}
    .hidden{display:none}
    .note{font-size:13px;color:#6b7280;text-align:center}
  </style>

  <!-- Supabase UMD bundle (CSP-compatible domain) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
<header class="hm-header" role="banner">
  <div class="wrap">
    <div class="left">
      <button class="hamburger" id="openMenu" aria-label="Open menu">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
          <line x1="4" y1="6"  x2="20" y2="6"></line>
          <line x1="4" y1="12" x2="20" y2="12"></line>
          <line x1="4" y1="18" x2="20" y2="18"></line>
        </svg>
      </button>
      <a class="hm-brand" href="index.html">Hemline Market</a>
    </div>
    <div class="right">
      <a class="hm-icon" href="browse.html" aria-label="Browse & search">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <circle cx="11" cy="11" r="8"></circle><path d="M21 21l-4.3-4.3"></path>
        </svg>
      </a>
      <a class="hm-icon" href="favorites.html" aria-label="Favorites">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 1 0-7.78 7.78L12 21.23l8.84-8.84a5.5 5.5 0 0 0 0-7.78z"></path>
        </svg>
      </a>
      <a class="hm-icon" href="notifications.html" aria-label="Notifications">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M18 8a6 6 0 1 0-12 0c0 7-3 7-3 7h18s-3 0-3-7"></path>
          <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
        </svg>
      </a>
      <a class="hm-icon" href="cart.html" aria-label="Cart">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <circle cx="9" cy="21" r="1"></circle><circle cx="18" cy="21" r="1"></circle>
          <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h7.72a2 2 0 0 0 2-1.61L23 6H6"></path>
        </svg>
      </a>
      <!-- Avatar text will be updated by Supabase session (AA vs Log in) -->
      <a class="hm-avatar" id="avatar" href="auth.html?view=login" title="Your profile">Log in</a>
      <a class="hm-btn-primary" href="sell.html" style="text-decoration:none;background:#991b1b;color:#fff;padding:8px 12px;border-radius:999px;border:1px solid #991b1b;font-weight:700">Sell</a>
    </div>
  </div>
</header>

<aside class="sheet" id="menuSheet" aria-hidden="true">
  <header>
    <strong>Menu</strong>
    <button class="close" id="closeMenu" aria-label="Close menu"
            style="display:inline-grid;place-items:center;width:30px;height:30px;border:1px solid var(--hm-border);border-radius:8px;background:#fff;color:#444">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </header>
  <nav>
    <a href="dashboard.html">Dashboard</a>
    <a href="atelier.html">My Atelier</a>
    <a href="how-it-works.html">How It Works</a>
    <a href="sell.html">Sell Fabric</a>
    <a href="contact.html">Contact</a>
  </nav>
</aside>

<main class="wrap">
  <!-- LOGIN CARD -->
  <div class="auth-container" id="card-login">
    <h1>Sign in to your account</h1>
    <p class="muted">New to Hemline? <a href="#" id="link-signup">Create account</a></p>

    <form id="login">
      <input type="email" id="li-email" placeholder="Email" required>
      <input type="password" id="li-pass" placeholder="Password" required>
      <button class="primary">Log in</button>
    </form>

    <div class="divider">or</div>

    <!-- Google OAuth with logo -->
    <button class="oauth" id="login-google" type="button">
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path fill="#EA4335" d="M12 11v3.8h5.3C16.7 17.7 14.6 19 12 19a7 7 0 1 1 0-14c1.9 0 3.5.7 4.7 1.8l2.7-2.7A11 11 0 0 0 12 1 11 11 0 1 0 23 12c0-.7-.1-1.3-.2-2z"/>
        <path fill="#FBBC05" d="M3.5 7.3A7 7 0 0 1 12 5v-4A11 11 0 0 0 1 12c0 1.7.4 3.3 1.1 4.7l3.4-2.6A6.9 6.9 0 0 1 3.5 7.3z"/>
        <path fill="#34A853" d="M12 23c2.9 0 5.4-1 7.2-2.8l-3.3-2.7A6.7 6.7 0 0 1 12 19a7 7 0 0 1-6.4-4.3l-3.4 2.6A11 11 0 0 0 12 23z"/>
        <path fill="#4285F4" d="M23 12c0-.7-.1-1.3-.2-2H12v4h5.3a4.8 4.8 0 0 1-2 3.1l3.3 2.7C20.9 18.7 23 15.7 23 12z"/>
      </svg>
      <span>Continue with Google</span>
    </button>

    <!-- Apple OAuth with logo -->
    <button class="oauth" id="login-apple" type="button">
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path d="M16.8 2.3c0 1-.4 1.9-1 2.6-.7.8-1.8 1.3-2.7 1.2-.1-1 .4-2 .9-2.6.7-.8 1.8-1.3 2.8-1.3.1.1.1.1 0 .1z"/>
        <path d="M19.8 17.3c-.5 1.2-.8 1.7-1.5 2.7-.9 1.3-2.3 2.9-3.9 2.9-1.5 0-1.9-.9-3.8-.9-1.9 0-2.3.9-3.8.9-1.6 0-2.9-1.5-3.8-2.8C1.1 18 0 15.1 0 12.4c0-2.7 1.3-4.2 2.5-5.2 1-.8 2.3-1.3 3.5-1.3 1.7 0 2.7.9 4.1.9 1.3 0 2.1-.9 4.1-.9 1.3 0 2.6.7 3.5 1.4-3.1 1.7-2.6 6 .2 7.6-.1.1-.1.2-.1.4z"/>
      </svg>
      <span>Continue with Apple</span>
    </button>

    <div class="links">
      <a href="#" id="link-forgot">Forgot password?</a>
      <a href="#" id="link-otp">Email me a sign-in code</a>
      <span class="muted" id="status">Checking session…</span>
      <a class="note hidden" id="goto-dash" href="dashboard.html">You’re already signed in — go to dashboard</a>
    </div>
  </div>

  <!-- SIGNUP -->
  <div class="auth-container hidden" id="card-signup">
    <h1>Create your account</h1>
    <p class="muted">Spin up your seller profile and start listing fabric finds.</p>
    <form id="signup">
      <input type="email" id="su-email" placeholder="Email" required>
      <input type="password" id="su-pass" placeholder="Password" required>
      <button class="primary">Create account</button>
    </form>
    <div class="links"><a href="#" id="back-from-signup">Back to sign in</a></div>
  </div>

  <!-- FORGOT PASSWORD -->
  <div class="auth-container hidden" id="card-forgot">
    <h1>Reset your password</h1>
    <p class="muted">We’ll send a secure reset link to your inbox.</p>
    <form id="reset">
      <input type="email" id="rp-email" placeholder="Email" required>
      <button class="primary">Send reset link</button>
    </form>
    <div class="links"><a href="#" id="back-from-forgot">Back to sign in</a></div>
  </div>

  <!-- OTP -->
  <div class="auth-container hidden" id="card-otp">
    <h1>Email a sign-in code</h1>
    <p class="muted">Quick like a running stitch — no password needed.</p>
    <form id="otp">
      <input type="email" id="otp-email" placeholder="Email" required>
      <button class="primary">Send code</button>
    </form>
    <div class="links"><a href="#" id="back-from-otp">Back to sign in</a></div>
  </div>
</main>

<footer class="hm-footer" role="contentinfo">
  <div class="footer-wrap">
    <div class="copy">© 2025 Hemline Market</div>
    <nav class="footer-links" aria-label="Footer">
      <a href="about.html">About</a>
      <a href="faq.html">FAQ</a>
      <a href="contact.html">Contact</a>
      <a href="terms.html">Terms</a>
      <a href="privacy.html">Privacy</a>
    </nav>
  </div>
</footer>

<script>
  // Menu sheet
  (function(){
    const s=document.getElementById("menuSheet"),
          o=document.getElementById("openMenu"),
          c=document.getElementById("closeMenu");
    function open(){s.classList.add("open");s.setAttribute("aria-hidden","false")}
    function close(){s.classList.remove("open");s.setAttribute("aria-hidden","true")}
    o&&o.addEventListener("click",e=>{e.preventDefault();open()});
    c&&c.addEventListener("click",e=>{e.preventDefault();close()});
    document.addEventListener("keydown",e=>{if(e.key==="Escape") close()});
  })();

  // Supabase client
  const supabase = window.supabase.createClient(
    "https://clkizksbvxjkoatdajgd.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNsa2l6a3Nidnhqa29hdGRhamdkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2ODAyMDUsImV4cCI6MjA3MDI1NjIwNX0.m3wd6UAuqxa7BpcQof9mmzd8zdsmadwGDO0x7-nyBjI"
  );

  // Card helpers
  const show = id => document.getElementById(id).classList.remove('hidden');
  const hide = id => document.getElementById(id).classList.add('hidden');

  document.getElementById('link-signup').onclick=(e)=>{e.preventDefault(); hide('card-login'); show('card-signup');};
  document.getElementById('back-from-signup').onclick=(e)=>{e.preventDefault(); hide('card-signup'); show('card-login');};
  document.getElementById('link-forgot').onclick=(e)=>{e.preventDefault(); hide('card-login'); show('card-forgot');};
  document.getElementById('back-from-forgot').onclick=(e)=>{e.preventDefault(); hide('card-forgot'); show('card-login');};
  document.getElementById('link-otp').onclick=(e)=>{e.preventDefault(); hide('card-login'); show('card-otp');};
  document.getElementById('back-from-otp').onclick=(e)=>{e.preventDefault(); hide('card-otp'); show('card-login');};

  // Session check + avatar text
  (async ()=>{
    const { data:{ session } } = await supabase.auth.getSession();
    const st  = document.getElementById('status');
    const go  = document.getElementById('goto-dash');
    const av  = document.getElementById('avatar');

    if(session?.user){
      const email = session.user.email || "";
      const initials = (email[0] || "U") + (email.split("@")[0][1] || "");
      st.textContent = `Logged in as ${email}`;
      go.classList.remove('hidden');
      av.textContent = initials.toUpperCase();
      av.href = "account.html";
    } else {
      st.textContent = "Not logged in.";
      av.textContent = "Log in";
      av.href = "auth.html?view=login";
    }
  })();

  // Email + Password login
  document.getElementById("login").onsubmit=async (e)=>{
    e.preventDefault();
    const email=document.getElementById("li-email").value.trim();
    const password=document.getElementById("li-pass").value;
    const { error } = await supabase.auth.signInWithPassword({ email, password });
    if(!error) location.href="dashboard.html"; else alert(error.message);
  };

  // Sign up
  document.getElementById("signup").onsubmit=async (e)=>{
    e.preventDefault();
    const email=document.getElementById("su-email").value.trim();
    const password=document.getElementById("su-pass").value;
    const { error } = await supabase.auth.signUp({ email, password });
    alert(error ? error.message : "Check your email to confirm.");
    hide('card-signup'); show('card-login');
  };

  // Forgot password
  document.getElementById("reset").onsubmit=async (e)=>{
    e.preventDefault();
    const email=document.getElementById("rp-email").value.trim();
    const { error } = await supabase.auth.resetPasswordForEmail(
      email,
      { redirectTo: location.origin + "/auth.html" }
    );
    alert(error ? error.message : "Reset link sent.");
    hide('card-forgot'); show('card-login');
  };

  // OTP
  document.getElementById("otp").onsubmit=async (e)=>{
    e.preventDefault();
    const email=document.getElementById("otp-email").value.trim();
    const { error } = await supabase.auth.signInWithOtp({
      email,
      options:{ emailRedirectTo: location.origin + "/auth.html" }
    });
    alert(error ? error.message : "Code sent!");
    hide('card-otp'); show('card-login');
  };

  // OAuth
  document.getElementById("login-google").onclick=async ()=>{
    const { error } = await supabase.auth.signInWithOAuth({
      provider:"google",
      options:{ redirectTo: location.origin + "/dashboard.html" }
    });
    if(error) alert(error.message);
  };

  document.getElementById("login-apple").onclick=async ()=>{
    const { error } = await supabase.auth.signInWithOAuth({
      provider:"apple",
      options:{ redirectTo: location.origin + "/dashboard.html" }
    });
    if(error) alert(error.message);
  };
</script>
</body>
</html>
