<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Sign In — Hemline Market</title>
  <style>
    :root{
      --hm-border:#e5e7eb;
      --hm-accent:#991b1b;
      --ink:#111827;
      --muted:#6b7280;
    }
    html,body{
      margin:0;
      max-width:100%;
      overflow-x:hidden;
      background:#fafafa;
      color:var(--ink);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      -webkit-font-smoothing:antialiased;
    }
    img,svg,canvas,video{max-width:100%;height:auto;display:block}
    .wrap{max-width:1200px;margin:0 auto;padding:0 12px}

    /* Header */
    .hm-header{min-height:56px;background:#fff;border-bottom:1px solid var(--hm-border)}
    .hm-header .wrap{display:flex;align-items:center;justify-content:space-between}
    .hm-brand{font-size:24px;font-weight:800;color:var(--hm-accent);text-decoration:none}
    .right{display:flex;align-items:center;gap:14px}
    .hamburger{
      display:inline-grid;place-items:center;width:40px;height:40px;
      border:1px solid var(--hm-border);border-radius:10px;
      background:#fff;color:#374151;
    }
    .hamburger svg{width:26px;height:26px;stroke-width:2.5}
    .hm-icon{color:#444;display:inline-grid;place-items:center}
    .hm-icon svg{width:26px;height:26px;stroke-width:2}
    .hm-btn-primary{
      background:var(--hm-accent);
      color:#fff;
      border:1px solid var(--hm-accent);
      border-radius:999px;
      padding:10px 18px;
      font-weight:700;
      text-decoration:none;
      box-shadow:0 2px 8px rgba(153,27,27,.25);
    }

    /* Account icon with status badge */
    .hm-account{
      position:relative;
    }
    .hm-account-badge{
      position:absolute;
      bottom:2px;
      right:2px;
      width:8px;
      height:8px;
      border-radius:999px;
      border:2px solid #fff;
      background:#d1d5db; /* logged out / unknown */
    }
    .hm-account.is-logged-in .hm-account-badge{
      background:#16a34a; /* logged in */
    }

    /* Slide-out menu */
    .sheet{
      position:fixed;inset:0 auto 0 0;width:min(84vw,340px);
      background:#fff;border-right:1px solid var(--hm-border);
      transform:translateX(-100%);transition:transform .25s ease;
      z-index:100;display:flex;flex-direction:column;
    }
    .sheet.open{transform:translateX(0)}
    .sheet header{
      display:flex;align-items:center;justify-content:space-between;
      padding:10px;border-bottom:1px solid var(--hm-border);
    }
    .sheet nav{display:grid;padding:10px}
    .sheet nav a{
      padding:10px;border:1px solid var(--hm-border);border-radius:10px;
      text-decoration:none;color:#1f2937;
    }
    .sheet nav a+a{margin-top:8px}
    .sheet .close{
      display:inline-grid;place-items:center;width:30px;height:30px;
      border:1px solid var(--hm-border);border-radius:8px;
      background:#fff;color:#444;
    }

    /* Footer */
    .hm-footer{
      background:#fff;border-top:1px solid var(--hm-border);margin-top:18px;
    }
    .hm-footer .footer-wrap{
      max-width:1200px;margin:0 auto;padding:12px 16px;
      display:flex;flex-wrap:wrap;gap:8px;align-items:center;justify-content:space-between;
    }
    .hm-footer .footer-links a{color:#4b5563;text-decoration:none}
    .hm-footer .footer-links a:hover{text-decoration:underline}

    /* Auth cards */
    .auth-container{
      max-width:420px;margin:40px auto;background:#fff;
      border:1px solid var(--hm-border);border-radius:12px;
      padding:24px;display:grid;gap:16px;
    }
    h1{margin:0 0 8px;text-align:center}
    .muted{text-align:center;color:var(--muted);margin:0}
    form{display:grid;gap:12px}
    input{
      padding:12px;border:1px solid var(--hm-border);
      border-radius:8px;font:inherit;
    }
    button.primary{
      background:var(--hm-accent);color:#fff;border:none;
      border-radius:8px;padding:12px;font-weight:700;cursor:pointer;
    }

    button.oauth{
      border:1px solid #d1d5db;border-radius:8px;
      padding:10px 12px;
      display:flex;align-items:center;gap:8px;
      justify-content:center;background:#fff;cursor:pointer;
      font:inherit;
    }
    button.oauth .icon{
      width:20px;height:20px;border-radius:999px;
      background:#fff;display:inline-flex;align-items:center;justify-content:center;
      flex-shrink:0;
    }
    button.oauth .icon svg{
      width:18px;height:18px;display:block;
    }
    button.oauth .icon.apple{
      background:#000;
    }
    button.oauth .icon.apple svg{
      fill:#fff;
    }

    .divider{
      display:flex;align-items:center;gap:12px;
      color:#6b7280;font-size:14px;
    }
    .divider::before,.divider::after{
      content:"";flex:1;height:1px;background:#e5e7eb;
    }
    .links{
      text-align:center;display:grid;gap:6px;
      font-size:14px;
    }
    .links a{color:var(--hm-accent);text-decoration:none}
    .hidden{display:none}
    .note{font-size:13px;color:#6b7280;text-align:center}

    @media (max-width:640px){
      .auth-container{margin:24px 12px}
      .hm-header .wrap{padding:0 8px}
    }
  </style>
</head>
<body>
<header class="hm-header" role="banner">
  <div class="wrap">
    <div class="left">
      <button class="hamburger" id="openMenu" aria-label="Open menu">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
          <line x1="4" y1="6"  x2="20" y2="6"></line>
          <line x1="4" y1="12" x2="20" y2="12"></line>
          <line x1="4" y1="18" x2="20" y2="18"></line>
        </svg>
      </button>
      <a class="hm-brand" href="index.html">Hemline Market</a>
    </div>
    <div class="right">
      <a class="hm-icon" href="browse.html" aria-label="Browse &amp; search">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="M21 21l-4.3-4.3"></path>
        </svg>
      </a>
      <a class="hm-icon" href="ThreadTalk.html" aria-label="ThreadTalk" title="ThreadTalk">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M4 6.5A4.5 4.5 0 0 1 8.5 2h7A4.5 4.5 0 0 1 20 6.5v5A4.5 4.5 0 0 1 15.5 16H12l-4 4v-4H8.5A4.5 4.5 0 0 1 4 11.5z"></path>
        </svg>
      </a>
      <a class="hm-icon" href="favorites.html" aria-label="Favorites">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 1 0-7.78 7.78L12 21.23l8.84-8.84a5.5 5.5 0 0 0 0-7.78z"></path>
        </svg>
      </a>
      <a class="hm-icon" href="notifications.html" aria-label="Notifications">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M18 8a6 6 0 1 0-12 0c0 7-3 7-3 7h18s-3 0-3-7"></path>
          <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
        </svg>
      </a>
      <a class="hm-icon" href="cart.html" aria-label="Cart">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <circle cx="9"  cy="21" r="1"></circle>
          <circle cx="18" cy="21" r="1"></circle>
          <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h7.72a2 2 0 0 0 2-1.61L23 6H6"></path>
        </svg>
      </a>

      <!-- Account icon with login status -->
      <a class="hm-icon hm-account" id="headerAccountLink" href="auth.html?view=login" aria-label="Sign in or manage your account">
        <span class="hm-account-badge" id="headerAccountBadge"></span>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <circle cx="12" cy="8" r="3.2"></circle>
          <path d="M5 19c1.4-3 3.5-4.5 7-4.5s5.6 1.5 7 4.5"></path>
        </svg>
      </a>

      <a class="hm-btn-primary" href="sell.html">Sell</a>
    </div>
  </div>
</header>

<aside class="sheet" id="menuSheet" aria-hidden="true">
  <header>
    <strong>Menu</strong>
    <button class="close" id="closeMenu" aria-label="Close menu">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </header>
  <nav>
    <a href="account.html">Account</a>
    <a href="atelier.html">My Atelier</a>
    <a href="how.html">How It Works</a>
    <a href="sell.html">Sell Fabric</a>
    <a href="ThreadTalk.html">ThreadTalk</a>
    <a href="contact.html">Contact</a>
  </nav>
</aside>

<main class="wrap">
  <div class="auth-container" id="card-login">
    <h1>Sign in to your account</h1>
    <p class="muted">New to Hemline? <a href="#" id="link-signup">Create account</a></p>

    <form id="login">
      <input type="email" id="li-email" placeholder="Email" required>
      <input type="password" id="li-pass" placeholder="Password" required>
      <button class="primary">Log in</button>
    </form>

    <div class="divider">or</div>

    <button class="oauth" id="login-google" type="button">
      <span class="icon">
        <!-- Google "G" logo -->
        <svg viewBox="0 0 24 24">
          <path fill="#EA4335" d="M12 10.2v3.9h5.4A4.9 4.9 0 0 1 12 19.6 7.6 7.6 0 1 1 19.6 12v1.1H12z"/>
          <path fill="#FBBC05" d="M5.3 9.7A4.5 4.5 0 0 1 9.4 6.2c1.3 0 2.4.5 3.3 1.3l2.5-2.5A7.6 7.6 0 0 0 4.4 8.4z"/>
          <path fill="#34A853" d="M12 19.6a7.5 7.5 0 0 0 5.3-2.1L15 15.3A4.6 4.6 0 0 1 9.4 17a4.5 4.5 0 0 1-4.1-2.8l-2.5 1.9A7.6 7.6 0 0 0 12 19.6z"/>
          <path fill="#4285F4" d="M19.6 12c0-.5-.1-1-.2-1.5H12v3.6h5.4A4.7 4.7 0 0 0 19.6 12z"/>
        </svg>
      </span>
      <span>Continue with Google</span>
    </button>

    <button class="oauth" id="login-apple" type="button">
      <span class="icon apple">
        <!-- Apple logo -->
        <svg viewBox="0 0 24 24">
          <path d="M16.7 2c-.9.1-2 .6-2.6 1.3-.6.7-1.1 1.8-.9 2.8 1-.1 2.1-.6 2.8-1.3.6-.7 1.1-1.8.9-2.8zm2.2 6.1c-1.3-.1-2.4.7-3 0-.6-.7-1.1-1.1-1.8-1.1-.7 0-1.3.4-1.8 1.1-.8 1.1-1.2 3-0.3 4.5.4.7.9 1.5 1.6 1.5.6 0 .7-.4 1.6-.4.9 0 .9.4 1.6.4.7 0 1.1-.7 1.5-1.4.5-.7.7-1.4.7-1.4-.1-.1-1.4-.5-1.4-2.1 0-1.3 1.1-1.9 1.1-1.9-.7-1-1.8-1.1-2-1.1z"/>
        </svg>
      </span>
      <span>Continue with Apple</span>
    </button>

    <div class="links">
      <a href="#" id="link-forgot">Forgot password?</a>
      <a href="#" id="link-otp">Email me a sign-in code</a>
      <span class="muted" id="status">Checking session…</span>
      <a class="note hidden" id="goto-dash" href="index.html">You’re already signed in — go to homepage</a>
    </div>
  </div>

  <div class="auth-container hidden" id="card-signup">
    <h1>Create your account</h1>
    <p class="muted">Spin up your seller profile and start listing fabric finds.</p>
    <form id="signup">
      <input type="email" id="su-email" placeholder="Email" required>
      <input type="password" id="su-pass" placeholder="Password" required>
      <button class="primary">Create account</button>
    </form>
    <p class="note">
      Password must be at least 8 characters and include at least one letter and one number.
      Symbols are optional but allowed.
    </p>
    <div class="links">
      <a href="#" id="back-from-signup">Back to sign in</a>
    </div>
  </div>

  <div class="auth-container hidden" id="card-forgot">
    <h1>Reset your password</h1>
    <p class="muted">We’ll send a secure reset link to your inbox.</p>
    <form id="reset">
      <input type="email" id="rp-email" placeholder="Email" required>
      <button class="primary">Send reset link</button>
    </form>
    <div class="links">
      <a href="#" id="back-from-forgot">Back to sign in</a>
    </div>
  </div>

  <div class="auth-container hidden" id="card-otp">
    <h1>Email a sign-in code</h1>
    <p class="muted">Quick like a running stitch — no password needed.</p>
    <form id="otp">
      <input type="email" id="otp-email" placeholder="Email" required>
      <button class="primary">Send code</button>
    </form>
    <div class="links">
      <a href="#" id="back-from-otp">Back to sign in</a>
    </div>
  </div>
</main>

<footer class="hm-footer" role="contentinfo">
  <div class="footer-wrap">
    <div class="copy">© 2025 Hemline Market</div>
    <nav class="footer-links" aria-label="Footer">
      <a href="about.html">About</a>
      <a href="faq.html">FAQ</a>
      <a href="contact.html">Contact</a>
      <a href="terms.html">Terms</a>
      <a href="privacy.html">Privacy</a>
    </nav>
  </div>
</footer>

<!-- Supabase JS (classic script) -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  // Menu
  (function(){
    const s=document.getElementById("menuSheet"),
          o=document.getElementById("openMenu"),
          c=document.getElementById("closeMenu");
    function open(){s.classList.add("open");s.setAttribute("aria-hidden","false")}
    function close(){s.classList.remove("open");s.setAttribute("aria-hidden","true")}
    o&&o.addEventListener("click",e=>{e.preventDefault();open()});
    c&&c.addEventListener("click",e=>{e.preventDefault();close()});
    document.addEventListener("keydown",e=>{if(e.key==="Escape") close()});
  })();

  // Supabase client for this page only
  const supabase = window.supabase.createClient(
    "https://clkizksbvxjkoatdajgd.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNsa2l6a3Nidnhqa29hdGRhamdkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2ODAyMDUsImV4cCI6MjA3MDI1NjIwNX0.m3wd6UAuqxa7BpcQof9mmzd8zdsmadwGDO0x7-nyBjI"
  );

  function updateHeaderForSession(session){
    const headerAccountLink = document.getElementById('headerAccountLink');
    if(!headerAccountLink) return;
    if(session && session.user){
      headerAccountLink.href = "account.html";
      headerAccountLink.setAttribute("aria-label","Your account");
      headerAccountLink.classList.add("is-logged-in");
    }else{
      headerAccountLink.href = "auth.html?view=login";
      headerAccountLink.setAttribute("aria-label","Sign in or manage your account");
      headerAccountLink.classList.remove("is-logged-in");
    }
  }

  // Show status; do not auto-redirect
  (async ()=>{
    const { data:{ session } } = await supabase.auth.getSession();
    const st = document.getElementById('status');
    const go = document.getElementById('goto-dash');
    updateHeaderForSession(session);
    if(session?.user){
      st.textContent = `Logged in as ${session.user.email}`;
      go.classList.remove('hidden');
    } else {
      st.textContent = 'Not logged in.';
    }
  })();

  // Card toggles
  const show = id => document.getElementById(id).classList.remove('hidden');
  const hide = id => document.getElementById(id).classList.add('hidden');

  document.getElementById('link-signup').onclick=(e)=>{
    e.preventDefault(); hide('card-login'); show('card-signup');
  };
  document.getElementById('back-from-signup').onclick=(e)=>{
    e.preventDefault(); hide('card-signup'); show('card-login');
  };
  document.getElementById('link-forgot').onclick=(e)=>{
    e.preventDefault(); hide('card-login'); show('card-forgot');
  };
  document.getElementById('back-from-forgot').onclick=(e)=>{
    e.preventDefault(); hide('card-forgot'); show('card-login');
  };
  document.getElementById('link-otp').onclick=(e)=>{
    e.preventDefault(); hide('card-login'); show('card-otp');
  };
  document.getElementById('back-from-otp').onclick=(e)=>{
    e.preventDefault(); hide('card-otp'); show('card-login');
  };

  function isStrongPassword(pw){
    if(!pw || pw.length < 8) return false;
    if(!/[A-Za-z]/.test(pw)) return false;
    if(!/[0-9]/.test(pw)) return false;
    return true;
  }

  // Email + Password login → go to homepage
  document.getElementById("login").onsubmit=async (e)=>{
    e.preventDefault();
    const email=document.getElementById("li-email").value.trim();
    const password=document.getElementById("li-pass").value;
    const { error } = await supabase.auth.signInWithPassword({ email, password });
    if(!error) location.href="index.html";
    else alert(error.message);
  };

  // Sign up → create user + display_name (from email local-part), with password rules
  document.getElementById("signup").onsubmit=async (e)=>{
    e.preventDefault();
    const email=document.getElementById("su-email").value.trim();
    const password=document.getElementById("su-pass").value;

    if(!isStrongPassword(password)){
      alert("Password must be at least 8 characters and include at least one letter and one number.");
      return;
    }

    const local = email.split("@")[0] || "";
    const display_name = local || "Hemline sewist";

    const { error } = await supabase.auth.signUp({
      email,
      password,
      options:{
        data:{ display_name }
      }
    });
    alert(error ? error.message : "Check your email to confirm.");
    hide('card-signup'); show('card-login');
  };

  // Forgot password
  document.getElementById("reset").onsubmit=async (e)=>{
    e.preventDefault();
    const email=document.getElementById("rp-email").value.trim();
    const { error } = await supabase.auth.resetPasswordForEmail(email,{
      redirectTo: location.origin + "/auth.html"
    });
    alert(error ? error.message : "Reset link sent.");
    hide('card-forgot'); show('card-login');
  };

  // OTP
  document.getElementById("otp").onsubmit=async (e)=>{
    e.preventDefault();
    const email=document.getElementById("otp-email").value.trim();
    const { error } = await supabase.auth.signInWithOtp({
      email,
      options:{ emailRedirectTo: location.origin + "/auth.html" }
    });
    alert(error ? error.message : "Code sent!");
    hide('card-otp'); show('card-login');
  };

  // OAuth → homepage
  document.getElementById("login-google").onclick=async ()=>{
    const { error } = await supabase.auth.signInWithOAuth({
      provider:"google",
      options:{ redirectTo: location.origin + "/index.html" }
    });
    if(error) alert(error.message);
  };

  document.getElementById("login-apple").onclick=async ()=>{
    const { error } = await supabase.auth.signInWithOAuth({
      provider:"apple",
      options:{ redirectTo: location.origin + "/index.html" }
    });
    if(error) alert(error.message);
  };
</script>
</body>
</html>
