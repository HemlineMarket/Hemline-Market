<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Product — Hemline Market</title>
  <link rel="stylesheet" href="/styles/hm-modern.css">
  <link rel="stylesheet" href="/styles/hem-header.css">
  <link rel="stylesheet" href="/styles/hm-typography.css">
  <link rel="stylesheet" href="/styles/hm-footer.css">
  <style>
    :root{ --hm-accent:#991b1b; --hm-border:#e5e7eb; --hm-muted:#6b7280; }
    body{margin:0;background:#fafafa;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
    .container{max-width:1100px;margin:16px auto;padding:0 12px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:18px}
    @media (max-width:900px){ .grid{grid-template-columns:1fr} }
    .card{background:#fff;border:1px solid var(--hm-border);border-radius:12px;padding:12px}
    .ph{aspect-ratio:4/3;display:grid;place-items:center;color:#6b7280;background:linear-gradient(180deg,#f8fafc,#eef2f7);border-radius:8px;overflow:hidden}
    .ph img{width:100%;height:100%;object-fit:cover}
    .title{font-size:22px;font-weight:800;margin:0 0 6px}
    .sub{color:#6b7280;margin:6px 0}
    .btn{padding:10px 14px;border-radius:10px;border:1px solid var(--hm-border);background:#fff;font-weight:700;cursor:pointer}
    .btn-primary{border-color:var(--hm-accent);background:var(--hm-accent);color:#fff;box-shadow:0 2px 8px rgba(153,27,27,.25)}
    .cart-badge{ position:absolute; top:-6px; right:-8px; min-width:18px; height:18px; padding:0 4px; display:none; align-items:center; justify-content:center; background:var(--hm-accent); color:#fff; border-radius:999px; font-size:11px; font-weight:800; line-height:18px; border:1px solid #fff; }
    .muted{color:var(--hm-muted)}
  </style>
</head>
<body>

<header class="hm-header" role="banner">
  <div class="container" style="max-width:1200px">
    <div class="left" style="display:flex;align-items:center;gap:10px">
      <a class="hm-brand" href="index.html">Hemline Market</a>
    </div>
    <div class="right" style="display:flex;align-items:center;gap:14px">
      <a class="hm-icon" href="browse.html" aria-label="Browse">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="11" cy="11" r="8"></circle><path d="M21 21l-4.3-4.3"></path></svg>
      </a>
      <a class="hm-icon" href="cart.html" aria-label="Cart">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <circle cx="9"  cy="21" r="1"></circle>
          <circle cx="18" cy="21" r="1"></circle>
          <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h7.72a2 2 0 0 0 2-1.61L23 6H6"></path>
        </svg>
        <span class="cart-badge" data-cart-badge></span>
      </a>
    </div>
  </div>
</header>

<main class="container">
  <div id="notFound" class="card" style="display:none;text-align:center;color:#6b7280;padding:40px 12px">
    We couldn't find that listing. <a href="browse.html" class="btn" style="margin-left:8px">Back to Browse</a>
  </div>

  <div id="product" class="grid" style="display:none">
    <div class="card">
      <div class="ph" id="photo"></div>
    </div>
    <div class="card">
      <h1 class="title" id="title">Loading…</h1>
      <div class="sub"><span id="price"></span> • <span id="stats"></span></div>
      <div class="muted" id="details"></div>
      <div style="display:flex;gap:10px;margin-top:12px">
        <button id="addToCart" class="btn btn-primary">Add to Cart</button>
        <a href="browse.html" class="btn">Keep Browsing</a>
      </div>
    </div>
  </div>
</main>

<footer class="hm-footer" role="contentinfo" style="margin-top:18px">
  <div class="footer-wrap" style="max-width:1200px">
    <div class="copy">© 2025 Hemline Market</div>
    <nav class="footer-links"><a href="about.html">About</a><a href="faq.html">FAQ</a><a href="contact.html">Contact</a><a href="terms.html">Terms</a><a href="privacy.html">Privacy</a></nav>
  </div>
</footer>

<script>
(function(){
  const badge = document.querySelector('[data-cart-badge]');
  function readCart(){ try{ return JSON.parse(localStorage.getItem('hm_cart')||'[]'); }catch(_){ return []; } }
  function writeCart(items){ localStorage.setItem('hm_cart', JSON.stringify(items)); updateBadge(items); }
  function updateBadge(items = readCart()){
    if (!badge) return;
    const n = items.reduce((s,i)=>s+(i.qty||1),0);
    if (n>0){ badge.textContent=n; badge.style.display='inline-flex'; }
    else { badge.textContent=''; badge.style.display='none'; }
  }
  updateBadge();

  const params = new URLSearchParams(location.search);
  const id = params.get('id') || '';

  const notFound = document.getElementById('notFound');
  const product = document.getElementById('product');
  const photo = document.getElementById('photo');
  const title = document.getElementById('title');
  const price = document.getElementById('price');
  const stats = document.getElementById('stats');
  const details = document.getElementById('details');
  const addToCart = document.getElementById('addToCart');

  async function load(){
    try{
      const res = await fetch('/data/listings.json');
      const all = await res.json();
      // match by id OR slug OR title (fallback)
      const item = all.find(it =>
        (it.id && String(it.id)===id) ||
        (it.slug && String(it.slug)===id) ||
        (String(it.title)===id)
      );

      if(!item){
        notFound.style.display = 'block';
        return;
      }

      // render
      product.style.display = 'grid';
      title.textContent = item.title;
      price.textContent = `$${item.price}/yd`;
      stats.textContent = `${item.width}″ • ${item.gsm} GSM`;
      details.innerHTML = `
        <div><strong>Department:</strong> ${item.dept||'—'}</div>
        <div><strong>Fabric:</strong> ${item.fabricType||'—'}</div>
        <div><strong>Fiber:</strong> ${(item.fiberType||'—')}</div>
        <div><strong>Content:</strong> ${(item.content||[]).join(', ')||'—'}</div>
        <div><strong>Color:</strong> ${item.color||'—'}</div>
        <div><strong>Origin:</strong> ${item.origin||'—'}</div>
        <div><strong>Designer:</strong> ${item.designer||'—'}</div>
        <div><strong>Yards:</strong> ${item.yards||'—'}</div>
      `;
      photo.innerHTML = item.photo
        ? `<img src="${item.photo}" alt="${item.title}">`
        : `<div>${item.title}</div>`;

      // add-to-cart
      addToCart.addEventListener('click', ()=>{
        const cart = readCart();
        const key = item.id || item.slug || item.title;
        const idx = cart.findIndex(x => x.id === key);
        if (idx >= 0) cart[idx].qty = (cart[idx].qty||1) + 1;
        else cart.push({ id:key, name:item.title, amount: Math.round(item.price*100), qty:1 });
        writeCart(cart);

        const original = addToCart.textContent;
        addToCart.textContent = 'Added ✓';
        addToCart.disabled = true;
        setTimeout(()=>{ addToCart.textContent = original; addToCart.disabled = false; }, 1200);
      });
    }catch(e){
      notFound.style.display = 'block';
    }
  }

  load();
})();
</script>
</body>
</html>
