<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>ThreadTalk — Hemline Market</title>

  <link rel="icon" href="/favicon.ico" type="image/x-icon"/>

  <!-- Shared site styles (same stack as index.html) -->
  <link rel="stylesheet" href="styles/hm-modern.css"/>
  <link rel="stylesheet" href="styles/hm-header.css"/>
  <link rel="stylesheet" href="styles/hm-typography.css"/>
  <link rel="stylesheet" href="styles/hm-footer.css"/>

  <!-- ThreadTalk-specific styles (for FB-style feed polish) -->
  <link rel="stylesheet" href="styles/threadtalk.css"/>

  <style>
    /* Global vars used by the universal header/footer (copied from index.html) */
    :root{
      /* header/footer expect these: */
      --hm-accent:#991b1b;
      --hm-text:#111827;
      --hm-muted:#6b7280;
      --hm-border:#e5e7eb;
      --hm-bg-card:rgba(255,255,255,.96);

      /* page-specific palette (ThreadTalk) */
      --hm-brand:#991b1b;
      --ink:#3f2f2a;
      --muted:#7a6e68;
      --border:#e8e0d9;
      --card:#ffffff;
      --bg:#fdfbf9;
      --accent:#2d2d2d;
    }

    body{
      margin:0;
      background:
        radial-gradient(1200px 420px at 50% -240px, rgba(153,27,27,.06) 0%, rgba(253,251,249,0) 60%),
        linear-gradient(180deg, var(--bg) 0%, #fff 100%);
      color:var(--ink);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      -webkit-font-smoothing:antialiased;
    }

    /* ------------------------------------------------------------------
       HEADER + SHELL (IDENTICAL TO index.html)
       This is what hm-shell.js expects.
    ------------------------------------------------------------------ */
    .hm-header{
      min-height:56px;
      background:#fff;
      border-bottom:1px solid var(--hm-border);
      position:relative;
      z-index:101;
    }
    .hm-header .wrap{
      max-width:1200px;
      margin:0 auto;
      padding:0 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
    }
    .left{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .hm-brand{
      font-size:24px;
      font-weight:800;
      color:var(--hm-accent);
      text-decoration:none;
    }
    .hamburger{
      display:inline-grid;
      place-items:center;
      width:36px;
      height:36px;
      border:1px solid var(--hm-border);
      border-radius:10px;
      background:#fff;
      color:#374151;
      cursor:pointer;
    }
    .hamburger svg{width:22px;height:22px;stroke-width:2}
    .right{
      display:flex;
      align-items:center;
      gap:14px;
    }
    .hm-icon{
      color:#444;
      display:inline-grid;
      place-items:center;
      text-decoration:none;
    }
    .hm-icon svg{width:26px;height:26px;stroke-width:2}

    /* Account icon + login badge (used inside hm-shell header) */
    .hm-account{
      position:relative;
      display:inline-grid;
      place-items:center;
      width:26px;
      height:26px;
    }
    .hm-account svg{
      width:26px;
      height:26px;
      stroke-width:2;
      display:block;
    }
    .hm-account-badge{
      position:absolute;
      bottom:-2px;
      right:-2px;
      width:10px;
      height:10px;
      border-radius:50%;
      border:2px solid #fff;
      background:#d1d5db;
    }
    .hm-account.is-logged-in .hm-account-badge{background:#16a34a;}
    .hm-account.is-logged-out .hm-account-badge{background:#d1d5db;}

    .hm-btn-primary{
      background:var(--hm-accent);
      color:#fff;
      border:1px solid var(--hm-accent);
      border-radius:999px;
      padding:10px 18px;
      font-weight:700;
      text-decoration:none;
      box-shadow:0 2px 8px rgba(153,27,27,.25);
      white-space:nowrap;
    }

    /* Slide-out sheet from hm-shell */
    .sheet{
      position:fixed;
      inset:0 auto 0 0;
      width:min(84vw,340px);
      background:#fff;
      border-right:1px solid var(--hm-border);
      transform:translateX(-100%);
      transition:transform .25s ease;
      z-index:100;
      display:flex;
      flex-direction:column;
    }
    .sheet.open{transform:translateX(0)}
    .sheet header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:10px;
      border-bottom:1px solid var(--hm-border);
    }
    .sheet nav{
      display:grid;
      padding:10px;
    }
    .sheet nav a{
      padding:10px;
      border:1px solid var(--hm-border);
      border-radius:10px;
      text-decoration:none;
      color:#1f2937;
    }
    .sheet nav a + a{margin-top:8px}
    .sheet .close{
      display:inline-grid;
      place-items:center;
      width:30px;
      height:30px;
      border:1px solid var(--hm-border);
      border-radius:8px;
      background:#fff;
      color:#444;
      cursor:pointer;
    }

    /* Overlay for shell drawer */
    #sheetOverlay{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.25);
      backdrop-filter:blur(1px);
      display:none;
      z-index:90;
    }
    #sheetOverlay.show{display:block}

    /* ------------------------------------------------------------------
       THREADTALK PAGE LAYOUT
    ------------------------------------------------------------------ */
    .tt-wrap{
      max-width:1200px;
      margin:22px auto 44px;
      padding:0 16px;
    }

    /* Hero + compact composer */
    .tt-hero{
      border:1px solid var(--border);
      border-radius:20px;
      padding:18px 16px;
      text-align:left;
      box-shadow:0 10px 20px rgba(50,38,31,.07);
      background:radial-gradient(120% 150% at 50% 0%, #fff 0%, rgba(153,27,27,.05) 55%, #fff 100%);
    }

    .tt-hero-header{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:16px;
      flex-wrap:wrap;
      margin-bottom:8px;
    }
    .tt-hero-left{
      flex:1 1 260px;
      min-width:220px;
    }
    .tt-hero-right{
      flex:0 0 260px;
      max-width:320px;
    }

    .tt-hero h1{
      font-family:ui-serif,"Cormorant Garamond",Georgia,serif;
      font-size:clamp(28px,4.2vw,44px);
      margin:0 0 4px;
    }
    .tt-hero .sub{
      color:var(--muted);
      font-size:15px;
      margin:6px 0 12px;
    }

    .tt-search{
      display:flex;
      align-items:center;
      gap:8px;
      background:#fff;
      border-radius:999px;
      border:1px solid var(--border);
      padding:6px 10px;
      box-shadow:0 6px 12px rgba(50,38,31,.05);
    }
    .tt-search-label{
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.08em;
      color:var(--muted);
      white-space:nowrap;
    }
    .tt-search-input{
      flex:1;
      border:none;
      outline:none;
      font-size:14px;
      background:transparent;
      color:var(--ink);
    }
    .tt-search-input::placeholder{
      color:var(--muted);
    }

    .composer{
      max-width:780px;
      margin:10px auto 0;
      text-align:left;
      background:#fff;
      border:1px solid var(--border);
      border-radius:14px;
      padding:8px;
      box-shadow:0 6px 14px rgba(50,38,31,.06);
    }
    .composer .row{
      display:flex;
      gap:8px;
      margin:8px;
      align-items:flex-start;
    }
    .composer select,
    .composer textarea{
      width:100%;
      border:1px solid var(--border);
      border-radius:10px;
      padding:10px 12px;
      font:inherit;
      color:var(--ink);
      background:#fff;
    }
    .composer textarea{
      min-height:84px;
      resize:vertical;
    }
    .composer .actions{
      display:flex;
      align-items:center;
      gap:10px;
      justify-content:space-between;
      margin:6px 8px 4px;
    }
    .left-actions{
      display:flex;
      gap:8px;
      align-items:center;
    }
    .right-actions{
      display:flex;
      gap:8px;
      align-items:center;
    }

    /* Make Category narrow, text area / title wide */
    .composer .row{display:flex;gap:10px;align-items:flex-start}
    #composeCategory{
      flex:0 0 240px;
      max-width:260px;
      width:auto !important;
    }
    .composer-main{
      flex:1 1 auto;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .composer-title-label{
      font-size:12px;
      color:var(--muted);
    }
    .composer-title{
      border:1px solid var(--border);
      border-radius:10px;
      padding:8px 10px;
      font:inherit;
    }
    #composeText{
      flex:1 1 auto;
      width:auto !important;
      min-height:110px;
    }

    .icon-btn{
      display:inline-grid;
      place-items:center;
      width:36px;
      height:36px;
      border-radius:10px;
      border:1px solid var(--border);
      background:#fff;
      cursor:pointer;
    }
    .icon-btn svg{width:20px;height:20px}
    .icon-photo{color:#dc2626}
    .icon-video{color:#2563eb}

    .tt-post{
      appearance:none;
      border:1px solid var(--accent);
      background:var(--accent);
      color:#fff;
      padding:8px 14px;
      border-radius:10px;
      font-weight:700;
    }
    .tt-post:disabled{
      opacity:.5;
      cursor:not-allowed;
    }

    .preview-wrap{
      display:flex;
      gap:10px;
      padding:0 8px 8px;
    }
    .preview-wrap img,
    .preview-wrap video{
      max-width:140px;
      max-height:120px;
      border-radius:10px;
      border:1px solid var(--border);
    }

    /* Topics */
    .topics{margin-top:22px}

    /* Force a tidy 4x4 grid on desktop */
    .topics-grid{
      display:grid;
      grid-template-columns:repeat(4,minmax(0,1fr));
      gap:16px;
    }

    .topic{
      position:relative;
      overflow:hidden;
      background:#fff;
      display:block;
      text-decoration:none;
      color:var(--ink);
      border:1px solid var(--border);
      border-radius:16px;
      padding:20px 18px 18px 18px;
      box-shadow:0 10px 16px rgba(50,38,31,.06);
      transition:transform .15s ease, box-shadow .15s ease, border-color .15s ease;
    }
    .topic:hover{
      transform:translateY(-2px);
      box-shadow:0 16px 28px rgba(50,38,31,.1);
      border-color:#e2d7cf;
    }
    .topic .title{
      font-weight:800;
      letter-spacing:.2px;
    }
    .topic::before{
      content:'';
      position:absolute;
      left:0;
      top:0;
      bottom:0;
      width:4px;
      background:var(--hm-brand);
      opacity:.9;
    }
    .tile-art{
      position:absolute;
      right:-6px;
      top:-6px;
      width:84px;
      height:84px;
      opacity:.2;
      pointer-events:none;
      stroke:var(--hm-brand);
      fill:none;
      stroke-width:1.5;
    }

    /* (Old .tt-search-row styles can stay; no markup uses them now) */

    /* Feed */
    .feed{margin-top:24px}
    .feed h2{
      font-size:18px;
      margin:4px 0 12px 4px;
      color:#5a463d;
    }
    .cards{
      display:flex;
      flex-direction:column;
      gap:16px;
      max-width:1200px;
      margin:0 auto;
    }
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:16px;
      padding:18px 20px;
      box-shadow:0 12px 18px rgba(50,38,31,.07);
    }
    .meta{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      color:var(--muted);
      font-size:13px;
      margin-bottom:6px;
      flex-wrap:wrap;
    }
    .meta-main{
      display:flex;
      align-items:center;
      gap:6px;
      flex-wrap:wrap;
    }
    /* Never show avatars on ThreadTalk cards */
    .avatar{
      display:none;
    }
    .title{
      margin:4px 0 8px;
      line-height:1.35;
    }
    .cat{
      font-weight:800;
      margin-right:.35rem;
      text-decoration:none;
      color:var(--hm-brand);
    }
    .preview{
      color:#5e544d;
      font-size:14px;
      margin-bottom:8px;
      white-space:pre-wrap;
    }
    .post-img,
    .post-video{
      width:100%;
      height:auto;
      border-radius:12px;
      margin:8px 0;
      border:1px solid var(--border);
      display:block;
      max-height:560px;
    }
    .actions{
      display:flex;
      gap:14px;
      align-items:center;
      color:#7e6f66;
      font-size:13px;
      margin-top:8px;
    }

    /* Reactions / comments / edit */
    .tt-react-row{
      display:flex;
      gap:6px;
      margin-top:4px;
      flex-wrap:wrap;
    }
    .tt-react{
      border:1px solid var(--border);
      background:#fff;
      border-radius:999px;
      padding:3px 8px;
      font-size:12px;
      cursor:pointer;
    }
    .tt-react span{
      min-width:1.2em;
      display:inline-block;
      text-align:center;
    }
    .tt-react-active{
      border-color:var(--hm-accent);
      box-shadow:0 0 0 1px rgba(153,27,27,.08);
    }

    .tt-comments{
      margin-top:10px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .tt-comment{
      border:1px solid var(--border);
      background:#fff;
      border-radius:10px;
      padding:8px;
    }
    .tt-comment-head{
      color:var(--muted);
      font-size:12px;
      margin-bottom:4px;
    }
    .tt-comment-new{
      display:flex;
      gap:8px;
    }
    .tt-comment-input{
      flex:1;
      border:1px solid var(--border);
      border-radius:10px;
      padding:8px;
    }
    .tt-comment-send{
      border:1px solid var(--accent);
      background:var(--accent);
      color:#fff;
      border-radius:10px;
      padding:8px 12px;
    }

    .tt-menu{
      position:relative;
    }
    .tt-menu-btn{
      border:1px solid var(--border);
      background:#fff;
      border-radius:8px;
      padding:4px 8px;
    }
    .tt-menu-pop{
      position:absolute;
      right:0;
      top:32px;
      background:#fff;
      border:1px solid var(--border);
      border-radius:10px;
      box-shadow:0 8px 18px rgba(0,0,0,.08);
      display:grid;
      z-index:10;
    }
    .tt-menu-item{
      padding:8px 12px;
      background:#fff;
      border:none;
      text-align:left;
      cursor:pointer;
    }
    .tt-menu-item:hover{background:#faf7f4}
    .tt-menu-item.danger{color:#b91c1c}

    .tt-edit-area{
      width:100%;
      min-height:84px;
      border:1px solid var(--border);
      border-radius:10px;
      padding:10px;
    }
    .tt-edit-actions{
      display:flex;
      gap:8px;
      margin-top:8px;
    }
    .tt-edit-save,
    .tt-edit-cancel{
      border:1px solid var(--border);
      background:#fff;
      border-radius:10px;
      padding:8px 12px;
    }
    .tt-edit-save{
      border-color:var(--accent);
      background:var(--accent);
      color:#fff;
    }

    /* Toast */
    .toast{
      position:fixed;
      left:50%;
      bottom:22px;
      transform:translateX(-50%);
      background:#1f2937;
      color:#fff;
      padding:10px 14px;
      border-radius:10px;
      font-size:14px;
      box-shadow:0 6px 18px rgba(0,0,0,.18);
      opacity:0;
      pointer-events:none;
      transition:opacity .2s;
      z-index:200;
    }
    .toast.show{opacity:1}

    .sr-only{
      position:absolute !important;
      width:1px;
      height:1px;
      padding:0;
      margin:-1px;
      overflow:hidden;
      clip:rect(0,0,0,0);
      white-space:nowrap;
      border:0;
    }

    a:focus-visible,
    button:focus-visible{
      outline:3px solid rgba(153,27,27,.35);
      outline-offset:2px;
      border-radius:10px;
    }

    /* Tablet: 2 columns for topics */
    @media (max-width:900px){
      .topics-grid{
        grid-template-columns:repeat(2,minmax(0,1fr));
      }
    }

    /* Mobile refinements */
    @media (max-width:640px){
      .tt-hero{padding:14px 12px}
      .composer{box-shadow:none}
      #composeCategory{max-width:100%;font-size:16px}
      #composeText{min-height:120px;font-size:16px}
      .topics-grid{grid-template-columns:1fr}
      .topic{padding:16px 14px}
      .card{padding:14px 14px}
      .actions,.reax{gap:10px}
      .tt-post{width:100%}
      .composer .row{flex-direction:column}
      #composeCategory,
      #composeText{
        width:100% !important;
        max-width:100%;
        flex:0 0 auto;
      }
      .composer-main{
        width:100%;
      }
    }
  </style>
</head>
<body>

  <!-- UNIVERSAL HEADER injected by hm-shell.js -->
  <div id="hm-shell-header"></div>

  <main class="tt-wrap" role="main">
    <!-- HERO + search + Composer -->
    <section class="tt-hero" aria-labelledby="tt-title">
      <div class="tt-hero-header">
        <div class="tt-hero-left">
          <h1 id="tt-title">ThreadTalk</h1>
          <p class="sub">Chat fabric, fit, and everything in between.</p>
        </div>

        <div class="tt-hero-right">
          <form class="tt-search" role="search">
            <span class="tt-search-label">ThreadTalk search</span>
            <label class="sr-only" for="threadSearch">Search ThreadTalk</label>
            <input
              id="threadSearch"
              class="tt-search-input"
              type="search"
              placeholder="Search titles &amp; posts…"
              autocomplete="off"
            />
          </form>
        </div>
      </div>

      <form class="composer" id="composer" aria-label="Create a thread">
        <div class="row">
          <select id="composeCategory" aria-label="Category">
            <option value="">Category (optional) — blank defaults to Loose Threads</option>
            <option value="showcase">Showcase</option>
            <option value="tailoring">Tailoring</option>
            <option value="stitch-school">Stitch School</option>
            <option value="fabric-sos">Fabric SOS</option>
            <option value="before-after">Before &amp; After</option>
            <option value="pattern-hacks">Pattern Hacks</option>
            <option value="stash-confessions">Stash Confessions</option>
            <option value="loose-threads">Loose Threads</option>
          </select>

          <div class="composer-main">
            <label class="composer-title-label" for="composeTitle">Post title</label>
            <input id="composeTitle" class="composer-title" type="text" maxlength="120"/>
            <textarea id="composeText" placeholder="Share what you’re working on, stuck on, or proud of. Add #hashtags if you want."></textarea>
          </div>
        </div>

        <div class="preview-wrap" id="mediaPreview" hidden></div>

        <div class="actions">
          <div class="left-actions">
            <label class="icon-btn" id="photoBtn" title="Add photo">
              <input type="file" id="photoInput" accept="image/*" hidden>
              <svg class="icon-photo" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M4 5h3l2-2h6l2 2h3a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2zm8 3a4 4 0 1 0 .001 8.001A4 4 0 0 0 12 8z"/>
              </svg>
            </label>
            <label class="icon-btn" id="videoBtn" title="Add video">
              <input type="file" id="videoInput" accept="video/*" hidden>
              <svg class="icon-video" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M15 10.5v-2a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h9a2 2 0 0 0 2-2v-2l5 3v-9l-5 3z"/>
              </svg>
            </label>
          </div>
          <div class="right-actions">
            <button type="submit" class="tt-post" id="postBtn">Post</button>
          </div>
        </div>
      </form>
    </section>

    <!-- TOPICS -->
    <section class="topics" id="topics" aria-label="Popular topics">
      <div class="topics-grid">
        <a class="topic" href="showcase.html" aria-label="Showcase">
          <strong class="title">Showcase</strong>
          <svg class="tile-art" viewBox="0 0 64 64" aria-hidden="true">
            <path d="M28 10c4 0 8 3 8 7s-4 7-8 7-8-3-8-7 4-7 8-7zM24 25c-2 8 16 8 14 0M28 10v-4M28 32v14M22 46h12M26 46v8M32 46v8"/>
          </svg>
        </a>

        <a class="topic" href="tailoring.html" aria-label="Tailoring">
          <strong class="title">Tailoring</strong>
          <svg class="tile-art" viewBox="0 0 64 64" aria-hidden="true">
            <path d="M10 46c12-10 22-10 34 0" />
            <path d="M14 50h24M14 54h18" />
            <circle cx="46" cy="46" r="6"/>
          </svg>
        </a>

        <a class="topic" href="stitch-school.html" aria-label="Stitch School">
          <strong class="title">Stitch School</strong>
          <svg class="tile-art" viewBox="0 0 64 64" aria-hidden="true">
            <path d="M18 14c20 8 28 18 28 36" />
            <path d="M36 12l-8 40" />
            <circle cx="36" cy="12" r="2"/>
          </svg>
        </a>

        <a class="topic" href="fabric-sos.html" aria-label="Fabric SOS">
          <strong class="title">Fabric SOS</strong>
          <svg class="tile-art" viewBox="0 0 64 64" aria-hidden="true">
            <rect x="14" y="14" width="28" height="18" rx="2"/>
            <rect x="18" y="18" width="28" height="18" rx="2"/>
          </svg>
        </a>

        <a class="topic" href="before-after.html" aria-label="Before & After">
          <strong class="title">Before &amp; After</strong>
          <svg class="tile-art" viewBox="0 0 64 64" aria-hidden="true">
            <rect x="12" y="14" width="40" height="28" rx="2"/>
            <path d="M32 14v28M20 20l6 6M38 34l6 6"/>
          </svg>
        </a>

        <a class="topic" href="pattern-hacks.html" aria-label="Pattern Hacks">
          <strong class="title">Pattern Hacks</strong>
          <svg class="tile-art" viewBox="0 0 64 64" aria-hidden="true">
            <path d="M18 40l10-10M18 20l10 10M34 30l12-8M34 30l12 8"/>
            <path d="M46 18l2 2M50 22l2 2M46 26l2 2"/>
          </svg>
        </a>

        <a class="topic" href="stash-confessions.html" aria-label="Stash Confessions">
          <strong class="title">Stash Confessions</strong>
          <svg class="tile-art" viewBox="0 0 64 64" aria-hidden="true">
            <path d="M12 44h40M12 30h40M12 16h40"/>
            <rect x="14" y="18" width="8" height="8" rx="1"/>
            <rect x="24" y="18" width="10" height="8" rx="1"/>
            <rect x="36" y="18" width="14" height="8" rx="1"/>
          </svg>
        </a>

        <a class="topic" href="loose-threads.html" aria-label="Loose Threads">
          <strong class="title">Loose Threads</strong>
          <svg class="tile-art" viewBox="0 0 64 64" aria-hidden="true">
            <path d="M16 44h14a8 8 0 0 1-8 8h-6zM18 36v8h10v-8" />
            <rect x="38" y="36" width="6" height="12" rx="1"/>
            <rect x="46" y="36" width="6" height="12" rx="1"/>
          </svg>
        </a>
      </div>
    </section>

    <!-- FEED -->
    <section class="feed" id="feed" aria-labelledby="feed-title">
      <h2 id="feed-title">Latest Threads</h2>
      <div class="cards" id="cards" aria-live="polite"></div>
      <div id="emptyState" style="color:#7a6e68;font-size:14px;margin:12px 4px">
        No threads yet. Be the first to post!
      </div>
    </section>
  </main>

  <!-- UNIVERSAL FOOTER injected by hm-shell.js -->
  <div id="hm-shell-footer"></div>

  <div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true">Posted</div>

  <!-- Supabase JS (same as index.html) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- Shared shell: universal header/footer + menu + header session + HM.supabase -->
  <script src="scripts/hm-shell.js"></script>

  <script>
    // Render shared header + footer FIRST (this also sets window.HM.supabase)
    window.HM && window.HM.renderShell({ currentPage: "threadtalk" });
  </script>

  <!-- ThreadTalk logic (Supabase threads + reactions/comments/edit/search) -->
  <script src="scripts/threadtalk.js"></script>
</body>
</html>
