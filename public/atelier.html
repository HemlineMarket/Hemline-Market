<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Your Atelier — Hemline Market</title>

  <!-- Shared styles -->
  <link rel="stylesheet" href="styles/hm-modern.css"/>
  <link rel="stylesheet" href="styles/hm-header.css"/>
  <link rel="stylesheet" href="styles/hm-typography.css"/>
  <link rel="stylesheet" href="styles/hm-footer.css"/>
  <link rel="icon" href="/favicon.ico" type="image/x-icon"/>

  <style>
    :root{
      --hm-accent:#991b1b;
      --hm-text:#111827;
      --hm-muted:#6b7280;
      --hm-border:#e5e7eb;
      --hm-bg:#f3f4f6;
    }
    html,body{
      margin:0;
      background:var(--hm-bg);
      color:var(--hm-text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      -webkit-font-smoothing:antialiased;
    }

    main.wrap{
      max-width:1100px;
      margin:18px auto 28px;
      padding:0 12px;
    }
    h1{
      margin:0 0 4px;
      font-size:28px;
      font-weight:800;
    }
    .subtle{
      margin:0 0 18px;
      font-size:14px;
      color:var(--hm-muted);
    }

    /* Layout */
    .atelier-grid{
      display:grid;
      grid-template-columns:1.1fr 1.4fr;
      gap:14px;
      align-items:flex-start;
    }
    @media (max-width:900px){
      .atelier-grid{
        grid-template-columns:1fr;
      }
    }

    .card{
      background:#fff;
      border:1px solid var(--hm-border);
      border-radius:12px;
      box-shadow:0 6px 16px rgba(0,0,0,.06);
    }
    .card .hd{
      padding:10px 12px;
      border-bottom:1px solid var(--hm-border);
      font-weight:800;
      font-size:15px;
    }
    .card .bd{
      padding:12px;
      font-size:14px;
    }

    /* Profile column */
    .profile-main{
      display:flex;
      align-items:flex-start;
      gap:12px;
    }
    .profile-avatar{
      width:52px;
      height:52px;
      border-radius:999px;
      border:1px solid var(--hm-border);
      background:#f9fafb;
      display:inline-grid;
      place-items:center;
      font-weight:800;
      font-size:17px;
      color:#334155;
      background-size:cover;
      background-position:center;
    }
    .profile-text{
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .profile-name{
      font-weight:800;
    }
    .profile-location{
      font-size:13px;
      color:var(--hm-muted);
    }
    .profile-bio{
      margin-top:2px;
      font-size:13px;
      color:#374151;
    }
    .profile-handle{
      margin-top:8px;
      font-size:13px;
      font-weight:700;
    }
    .profile-tagline{
      margin-top:4px;
      font-size:13px;
      color:#374151;
    }
    .profile-stats-row{
      margin-top:8px;
      font-size:12px;
      color:var(--hm-muted);
      display:flex;
      gap:4px;
      flex-wrap:wrap;
    }
    .profile-note{
      margin-top:10px;
      font-size:12px;
      color:var(--hm-muted);
    }
    .profile-note a{
      color:var(--hm-accent);
      text-decoration:none;
    }
    .profile-note a:hover{
      text-decoration:underline;
    }
    .profile-actions-row{
      margin-top:10px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    .btn{
      padding:8px 14px;
      border-radius:10px;
      border:1px solid var(--hm-border);
      background:#fff;
      font-size:14px;
      font-weight:600;
      cursor:pointer;
    }
    .btn.primary{
      border-color:var(--hm-accent);
      background:var(--hm-accent);
      color:#fff;
      box-shadow:0 2px 8px rgba(153,27,27,.25);
    }

    /* Listings column */
    .listings-header-row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      font-size:13px;
      color:var(--hm-muted);
      margin-bottom:4px;
    }
    .listings-header-row strong{
      color:#111827;
    }
    .listing-tiles{
      margin-top:10px;
      display:grid;
      grid-template-columns:repeat(3,minmax(0,1fr));
      gap:10px;
    }
    @media (max-width:900px){
      .listing-tiles{
        grid-template-columns:repeat(2,minmax(0,1fr));
      }
    }
    @media (max-width:640px){
      .listing-tiles{
        grid-template-columns:1fr;
      }
    }
    .listing-tile{
      border-radius:12px;
      border:1px solid var(--hm-border);
      overflow:hidden;
      background:#f9fafb;
      display:flex;
      flex-direction:column;
      min-height:140px;
    }
    .listing-thumb{
      height:78px;
      background:linear-gradient(135deg,#e5e7eb,#f3f4f6);
    }
    .listing-copy{
      padding:8px 9px 10px;
      font-size:12px;
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .listing-copy strong{
      font-size:13px;
    }
    .listing-meta{
      margin-top:4px;
      display:flex;
      justify-content:space-between;
      gap:4px;
      font-size:12px;
      color:var(--hm-muted);
    }
    .listings-footer{
      margin-top:10px;
      font-size:12px;
      color:var(--hm-muted);
    }

    /* Lower row cards */
    .atelier-lower{
      margin-top:12px;
      display:grid;
      grid-template-columns:minmax(0,1.1fr) minmax(0,0.9fr) minmax(0,0.9fr);
      gap:12px;
    }
    @media (max-width:900px){
      .atelier-lower{
        grid-template-columns:1fr;
      }
    }

    .field{
      display:flex;
      flex-direction:column;
      gap:4px;
      margin-bottom:8px;
      font-size:13px;
    }
    .field label{
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.04em;
      color:#6b7280;
      font-weight:700;
    }
    .field input[type="url"],
    .field input[type="text"]{
      padding:7px 10px;
      border-radius:8px;
      border:1px solid var(--hm-border);
      background:#f9fafb;
      font:inherit;
      font-size:13px;
    }

    .rating-wrap{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
      margin-bottom:8px;
    }
    .stat{
      border:1px solid var(--hm-border);
      border-radius:10px;
      padding:8px 9px;
      background:#f9fafb;
      font-size:12px;
    }
    .stat .big{
      font-size:18px;
      font-weight:800;
    }
    .stat .label{
      margin-top:2px;
      color:var(--hm-muted);
    }
    .meter{
      height:7px;
      border-radius:999px;
      background:#e5e7eb;
      overflow:hidden;
      margin-top:6px;
    }
    .meter span{
      display:block;
      height:100%;
      width:0;
      background:var(--hm-accent);
    }

    .copyrow{
      display:grid;
      grid-template-columns:1fr auto;
      gap:8px;
      align-items:center;
    }
    .copyrow input{
      padding:7px 10px;
      border-radius:999px;
      border:1px solid var(--hm-border);
      background:#f9fafb;
      font-size:13px;
    }
    .pill{
      display:inline-block;
      margin-top:8px;
      padding:5px 9px;
      border-radius:999px;
      border:1px dashed var(--hm-border);
      font-size:12px;
      color:var(--hm-muted);
    }
    .micro{
      margin-top:6px;
      font-size:11px;
      color:var(--hm-muted);
    }
  </style>
</head>
<body>

<!-- HEADER (shared look with other pages) -->
<header class="hm-header" role="banner">
  <div class="wrap">
    <div class="left">
      <button class="hamburger" id="openMenu" type="button" aria-label="Open menu" aria-controls="menuSheet" aria-expanded="false">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
          <line x1="4" y1="6"  x2="20" y2="6"></line>
          <line x1="4" y1="12" x2="20" y2="12"></line>
          <line x1="4" y1="18" x2="20" y2="18"></line>
        </svg>
      </button>
      <a class="hm-brand" href="index.html">Hemline Market</a>
    </div>

    <div class="right">
      <a class="hm-icon" href="browse.html" aria-label="Browse &amp; search">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="M21 21l-4.3-4.3"></path>
        </svg>
      </a>
      <a class="hm-icon" href="ThreadTalk.html" aria-label="ThreadTalk" title="ThreadTalk">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M4 6.5A4.5 4.5 0 0 1 8.5 2h7A4.5 4.5 0 0 1 20 6.5v5A4.5 4.5 0 0 1 15.5 16H12l-4 4v-4H8.5A4.5 4.5 0 0 1 4 11.5z"></path>
        </svg>
      </a>
      <a class="hm-icon" href="favorites.html" aria-label="Favorites">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 1 0-7.78 7.78L12 21.23l8.84-8.84a5.5 5.5 0 0 0 0-7.78z"></path>
        </svg>
      </a>
      <a class="hm-icon" href="notifications.html" aria-label="Notifications">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M18 8a6 6 0 1 0-12 0c0 7-3 7-3 7h18s-3 0-3-7"></path>
          <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
        </svg>
      </a>
      <a class="hm-icon" href="cart.html" aria-label="Cart">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <circle cx="9" cy="21" r="1"></circle>
          <circle cx="18" cy="21" r="1"></circle>
          <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h7.72a2 2 0 0 0 2-1.61L23 6H6"></path>
        </svg>
      </a>

      <!-- Avatar used by shared auth/session script -->
      <a class="hm-avatar" id="headerAvatar" href="account.html" title="Your account" style="display:none;">RK</a>

      <!-- Header login button (shown when logged OUT) -->
      <a class="cta-header" id="loginHeaderBtn" href="auth.html" aria-label="Log in to Hemline Market">
        Log in
      </a>

      <a class="hm-btn-primary" href="sell.html">Sell</a>
    </div>
  </div>
</header>

<!-- OVERLAY + LEFT MENU -->
<div id="sheetOverlay" aria-hidden="true"></div>

<aside class="sheet" id="menuSheet" aria-hidden="true" role="dialog" aria-modal="true" aria-label="Site menu">
  <header>
    <strong>Menu</strong>
    <button class="close" id="closeMenu" aria-label="Close menu">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </header>
  <nav>
    <a href="browse.html">Browse</a>
    <a href="atelier.html">My Atelier</a>
    <a href="sell.html">Sell Fabric</a>
    <a href="ThreadTalk.html">ThreadTalk</a>
    <a href="account.html">Account</a>
    <a href="contact.html">Contact</a>
  </nav>
</aside>

<main class="wrap" id="maincontent">
  <h1>Your Atelier</h1>
  <p class="subtle">
    Your public shop profile and listings. Buyers see this page when they tap your name on a listing.
  </p>

  <div class="atelier-grid">
    <!-- PROFILE COLUMN -->
    <section class="card">
      <div class="hd">Profile</div>
      <div class="bd">
        <div class="profile-main">
          <!-- Avatar + initials populated by shared JS (same ids as Account) -->
          <span id="profileAvatar" class="profile-avatar">RK</span>

          <div class="profile-text">
            <div id="profileName" class="profile-name">Hemline Member</div>
            <div id="profileLocation" class="profile-location">Location coming soon</div>
            <div id="profileBio" class="profile-bio">
              Add a short note about your sourcing, favorite textiles, or sewing style on your Account page.
            </div>

            <div id="profileHandle" class="profile-handle">@your.shop</div>
            <div id="profileTagline" class="profile-tagline">
              Designer deadstock, atelier finds, and fabrics with a story.
            </div>
          </div>
        </div>

        <div class="profile-stats-row">
          <span id="profileStatsListings">0 completed listings</span>
          <span aria-hidden="true">·</span>
          <span id="profileStatsShipping">0% on-time shipping</span>
        </div>

        <p class="profile-note">
          Buyers only see this page — not your address or payout information.
          Edit your name, location, bio, and shop details on your
          <a href="account.html">Account</a> page.
        </p>

        <div class="profile-actions-row">
          <a class="btn primary" href="sell.html">List a fabric</a>
          <a class="btn" href="account.html">Edit shop details</a>
        </div>
      </div>
    </section>

    <!-- LISTINGS COLUMN -->
    <section class="card">
      <div class="hd">Listings</div>
      <div class="bd">
        <div class="listings-header-row">
          <strong>Available fabric</strong>
          <span><span id="activeListingCount">0</span> active listings</span>
        </div>

        <div class="listing-tiles">
          <article class="listing-tile">
            <div class="listing-thumb"></div>
            <div class="listing-copy">
              <strong>Your fabric listing will show here</strong>
              <p>Smooth twills, crisp poplins, luxe silk — once wired to Supabase, this pulls real data.</p>
              <div class="listing-meta">
                <span>$—</span>
                <span>— yds</span>
              </div>
            </div>
          </article>

          <article class="listing-tile">
            <div class="listing-thumb"></div>
            <div class="listing-copy">
              <strong>Designer deadstock, atelier finds</strong>
              <p>Yards, fiber content, and shipping info will show here.</p>
              <div class="listing-meta">
                <span>$—</span>
                <span>— yds</span>
              </div>
            </div>
          </article>

          <article class="listing-tile">
            <div class="listing-thumb"></div>
            <div class="listing-copy">
              <strong>Linen, wool, silk &amp; more</strong>
              <p>As you list fabric, cards will replace these samples.</p>
              <div class="listing-meta">
                <span>$—</span>
                <span>— yds</span>
              </div>
            </div>
          </article>
        </div>

        <p class="listings-footer">
          No active listings yet. List fabric from your Sell page and they’ll appear here.
        </p>
      </div>
    </section>
  </div>

  <!-- LOWER ROW: LINKS / SHARE / RATING -->
  <div class="atelier-lower">
    <!-- Links -->
    <section class="card">
      <div class="hd">Links</div>
      <div class="bd">
        <div class="field">
          <label for="shopWebsite">Website</label>
          <input id="shopWebsite" type="url" placeholder="https://example.com"/>
        </div>
        <div class="field">
          <label for="shopInstagram">Instagram</label>
          <input id="shopInstagram" type="text" placeholder="@yourhandle"/>
        </div>
        <div class="field">
          <label for="shopTikTok">TikTok</label>
          <input id="shopTikTok" type="text" placeholder="@yourhandle"/>
        </div>
        <p class="micro">
          You can share these in your listings or messages — we won’t show private contact details.
        </p>
      </div>
    </section>

    <!-- Share your shop -->
    <section class="card">
      <div class="hd">Share your shop</div>
      <div class="bd">
        <div class="field">
          <label for="shopLink">Public link</label>
          <div class="copyrow">
            <input id="shopLink" type="text" readonly value="">
            <button id="copyShopLinkBtn" class="btn" type="button">Copy</button>
          </div>
        </div>
        <p class="pill">
          Tip: your link updates as you refine your shop name and story.
        </p>
        <p id="copyShopLinkMsg" class="micro" style="display:none;">Link copied!</p>
      </div>
    </section>

    <!-- Shop rating -->
    <section class="card">
      <div class="hd">Shop rating</div>
      <div class="bd">
        <div class="rating-wrap">
          <div class="stat">
            <div class="big" id="completedCount">0</div>
            <div class="label">Completed listings</div>
          </div>
          <div class="stat">
            <div class="big"><span id="onTimePct">0</span>%</div>
            <div class="label">On-time shipments</div>
            <div class="meter"><span id="meterFill"></span></div>
          </div>
        </div>
        <button class="btn" type="button" aria-disabled="true" style="opacity:.7;cursor:default;">
          Not yet rated
        </button>
        <p class="micro">
          Ratings appear after you’ve sold at least 5 listings. We show your on-time shipping
          percentage — no public comments.
        </p>
      </div>
    </section>
  </div>
</main>

<!-- FOOTER -->
<footer class="hm-footer" role="contentinfo">
  <div class="footer-wrap">
    <div class="copy">© 2025 Hemline Market</div>
    <nav class="footer-links" aria-label="Footer">
      <a href="about.html">About</a>
      <a href="faq.html">FAQ</a>
      <a href="contact.html">Contact</a>
      <a href="terms.html">Terms</a>
      <a href="privacy.html">Privacy</a>
    </nav>
  </div>
</footer>

<!-- JS: Hamburger / sheet and simple shop-link helper -->
<script>
  (function(){
    const sheet   = document.getElementById('menuSheet');
    const openBtn = document.getElementById('openMenu');
    const closeBtn= document.getElementById('closeMenu');
    const overlay = document.getElementById('sheetOverlay');

    function lockScroll(lock){
      document.body.style.overflow = lock ? 'hidden' : '';
    }
    function openSheet(){
      if (!sheet) return;
      sheet.classList.add('open');
      sheet.setAttribute('aria-hidden','false');
      if (overlay){
        overlay.classList.add('show');
        overlay.setAttribute('aria-hidden','false');
      }
      if (openBtn) openBtn.setAttribute('aria-expanded','true');
      lockScroll(true);
    }
    function closeSheet(){
      if (!sheet) return;
      sheet.classList.remove('open');
      sheet.setAttribute('aria-hidden','true');
      if (overlay){
        overlay.classList.remove('show');
        overlay.setAttribute('aria-hidden','true');
      }
      if (openBtn) openBtn.setAttribute('aria-expanded','false');
      lockScroll(false);
    }

    if (openBtn && closeBtn && sheet){
      openBtn.addEventListener('click', function(e){ e.preventDefault(); openSheet(); });
      closeBtn.addEventListener('click', function(e){ e.preventDefault(); closeSheet(); });
      if (overlay){
        overlay.addEventListener('click', closeSheet);
      }
      document.addEventListener('keydown', function(e){
        if (e.key === 'Escape') closeSheet();
      });
    }

    // Simple shop-link generator based on current origin + handle
    function slugify(str){
      return (str || '').toLowerCase().trim()
        .replace(/&/g,' and ')
        .replace(/[^a-z0-9]+/g,'-')
        .replace(/^-+|-+$/g,'')
        .substring(0,60) || 'your-shop';
    }

    const handleEl = document.getElementById('profileHandle');
    const shopLinkInput = document.getElementById('shopLink');
    const copyBtn = document.getElementById('copyShopLinkBtn');
    const copyMsg = document.getElementById('copyShopLinkMsg');

    function updateShopLink(){
      if (!shopLinkInput) return;
      const base = window.location.origin || (location.protocol + '//' + location.host);
      const handleText = handleEl ? handleEl.textContent.replace(/^@/,'') : 'your-shop';
      const slug = slugify(handleText);
      shopLinkInput.value = base + '/atelier.html?shop=' + encodeURIComponent(slug);
    }
    updateShopLink();

    if (copyBtn && shopLinkInput && copyMsg){
      copyBtn.addEventListener('click', async function(){
        try{
          await navigator.clipboard.writeText(shopLinkInput.value);
        }catch(e){
          shopLinkInput.select();
          document.execCommand('copy');
        }
        copyMsg.style.display='block';
        setTimeout(function(){ copyMsg.style.display='none'; }, 1200);
      });
    }

    // Demo rating values from localStorage (optional preview only)
    try{
      const completed = Number(localStorage.getItem('hm.seller.completed') || 0);
      const ontime = Number(localStorage.getItem('hm.seller.ontime') || 0);
      const clamp = v => Math.max(0, Math.min(100, v));
      const pct = clamp(ontime);

      const completedEl = document.getElementById('completedCount');
      const pctEl = document.getElementById('onTimePct');
      const meterFill = document.getElementById('meterFill');

      if (completedEl) completedEl.textContent = completed;
      if (pctEl) pctEl.textContent = pct;
      if (meterFill) meterFill.style.width = pct + '%';
    }catch(e){}
  })();
</script>

<!-- Shared Supabase/account wiring for avatar + profile fields -->
<script type="module" src="scripts/account-auth.js"></script>

</body>
</html>
