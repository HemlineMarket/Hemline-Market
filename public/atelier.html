<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Atelier — Hemline Market</title>

<link rel="stylesheet" href="styles/hm-modern.css"/>
<link rel="stylesheet" href="styles/hem-header.css"/>
<link rel="stylesheet" href="styles/hm-typography.css"/>
<link rel="stylesheet" href="styles/hm-footer.css"/>

<style>
  :root{
    --ink:#111827;--muted:#6b7280;--border:#e5e7eb;--accent:#991b1b;--bg:#fafafa
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;-webkit-font-smoothing:antialiased}

  /* Header */
  .hm-header{min-height:56px;background:#fff;border-bottom:1px solid var(--border)}
  .hm-header .wrap{max-width:1200px;margin:0 auto;padding:0 12px;display:flex;align-items:center;justify-content:space-between}
  .hm-brand{font-size:24px;font-weight:800;color:var(--accent);text-decoration:none}
  .hamburger{display:inline-grid;place-items:center;width:36px;height:36px;border:1px solid var(--border);border-radius:10px;background:#fff;color:#374151}
  .hamburger svg{width:22px;height:22px;stroke-width:2}
  .right{display:flex;align-items:center;gap:14px}
  .hm-icon{color:#444;display:inline-grid;place-items:center}
  .hm-icon svg{width:26px;height:26px;stroke-width:2}
  .hm-avatar{width:28px;height:28px;border-radius:50%;border:1px solid var(--border);background:#fff;color:#334155;display:inline-grid;place-items:center;font-weight:700;font-size:12px;text-decoration:none}

  /* Page */
  .wrap{max-width:1200px;margin:18px auto 28px;padding:0 12px}
  .hero{display:flex;align-items:center;gap:14px;margin-bottom:12px}
  .banner{width:100%;height:140px;border-radius:14px;background:linear-gradient(180deg,#f8fafc,#eef2f7);border:1px solid var(--border)}
  .shop{display:flex;align-items:center;gap:12px;margin-top:-28px}
  .shop .av{width:56px;height:56px;border-radius:999px;border:2px solid #fff;box-shadow:0 4px 12px rgba(0,0,0,.08);display:grid;place-items:center;background:#fff;font-weight:900;color:#374151}
  .shop h1{margin:0;font-size:22px}
  .shop .sub{margin:0;color:var(--muted);font-size:13px}
  .shop-actions{margin-left:auto;display:flex;gap:8px}
  .btn{padding:8px 12px;border:1px solid var(--border);border-radius:10px;background:#fff;font-weight:700;cursor:pointer;text-decoration:none;color:#111827}
  .btn-primary{background:var(--accent);color:#fff;border-color:var(--accent);box-shadow:0 2px 8px rgba(153,27,27,.25)}

  /* Grid */
  .grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:10px}
  @media (max-width:900px){ .grid{grid-template-columns:repeat(2,minmax(0,1fr))} }
  @media (max-width:560px){ .grid{grid-template-columns:1fr} }
  .card{background:#fff;border:1px solid var(--border);border-radius:12px;overflow:hidden;text-decoration:none;color:#1f2937}
  .thumb{aspect-ratio:4/3;background:linear-gradient(180deg,#f8fafc,#eef2f7);display:grid;place-items:center;color:#6b7280}
  .info{padding:8px 10px}
  .title{font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .meta{display:flex;justify-content:space-between;align-items:center;margin-top:6px;font-size:14px;color:#6b7280}
  .price{font-weight:800;color:#111827}

  .empty{margin-top:10px;border-left:4px solid #f59e0b;background:#fff7ed;padding:10px;border-radius:10px;color:#92400e}
</style>
</head>
<body>

<!-- HEADER -->
<header class="hm-header" role="banner">
  <div class="wrap">
    <div style="display:flex;align-items:center;gap:10px">
      <button class="hamburger" id="openMenu" aria-label="Open menu">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
          <line x1="4" y1="6" x2="20" y2="6"></line>
          <line x1="4" y1="12" x2="20" y2="12"></line>
          <line x1="4" y1="18" x2="20" y2="18"></line>
        </svg>
      </button>
      <a class="hm-brand" href="index.html">Hemline Market</a>
    </div>
    <div class="right">
      <a class="hm-icon" href="favorites.html" aria-label="Favorites">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 1 0-7.78 7.78L12 21.23l8.84-8.84a5.5 5.5 0 0 0 0-7.78z"/></svg>
      </a>
      <a class="hm-icon" href="notifications.html" aria-label="Notifications">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M18 8a6 6 0 1 0-12 0c0 7-3 7-3 7h18s-3 0-3-7"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
      </a>
      <a class="hm-avatar" id="avatar" href="account.html" title="Your profile">AA</a>
      <a class="btn btn-primary" href="seller/index.html">Sell</a>
    </div>
  </div>
</header>

<main class="wrap">
  <!-- Banner + shop header -->
  <div class="hero">
    <div class="banner" id="banner" aria-hidden="true"></div>
  </div>
  <div class="shop">
    <div class="av" id="shopAv">A</div>
    <div>
      <h1 id="shopName">Atelier</h1>
      <p class="sub" id="shopSub">Loading seller…</p>
    </div>
    <div class="shop-actions" id="ownerActions" style="display:none">
      <a class="btn" href="seller/index.html">Seller Dashboard</a>
      <a class="btn btn-primary" href="seller/index.html?list=new">+ New Listing</a>
    </div>
  </div>

  <!-- Listings -->
  <section style="margin-top:12px">
    <div id="grid" class="grid"></div>
    <div id="empty" class="empty" style="display:none">No listings yet.</div>
  </section>
</main>

<!-- FOOTER -->
<footer class="hm-footer" role="contentinfo">
  <div class="footer-wrap">
    <div class="copy">© 2025 Hemline Market</div>
    <nav class="footer-links" aria-label="Footer">
      <a href="how.html" class="how">How It Works</a>
      <a href="about.html">About</a>
      <a href="contact.html">Contact</a>
      <a href="faq.html">FAQ</a>
      <a href="privacy.html">Privacy</a>
      <a href="terms.html">Terms</a>
    </nav>
  </div>
</footer>

<script src="env.js"></script>
<script>
(async function(){
  // --- Resolve which seller's Atelier to show ---
  // Priority: ?seller=handle -> localStorage.shop_handle -> logged-in email prefix
  const params = new URLSearchParams(location.search);
  let handle = (params.get('seller') || '').trim();

  // If none provided, try local storage (you can set this after sign-up)
  if(!handle){
    try{ handle = localStorage.getItem('shop_handle') || ''; }catch(e){}
  }

  // If still none, try Supabase auth (fallback to email prefix as a readable handle)
  let currentUser = null;
  try{
    if(window.supabase){
      const { data: { user } } = await supabase.auth.getUser();
      currentUser = user || null;
      if(!handle && currentUser?.email){
        handle = currentUser.email.split('@')[0];
      }
    }
  }catch(e){ /* non-blocking */ }

  // Basic shop header fill
  const shopNameEl = document.getElementById('shopName');
  const shopSubEl  = document.getElementById('shopSub');
  const shopAvEl   = document.getElementById('shopAv');
  const ownerActions = document.getElementById('ownerActions');

  const niceHandle = handle || 'seller';
  shopNameEl.textContent = niceHandle + " — Atelier";
  shopSubEl.textContent  = "Listings by @" + niceHandle;
  shopAvEl.textContent   = (niceHandle[0] || 'A').toUpperCase();

  // If this viewer is the owner, show quick actions
  if(currentUser && currentUser.email && niceHandle === currentUser.email.split('@')[0]){
    ownerActions.style.display = 'flex';
  } else {
    // Also treat stored handle as "owner" for local dev
    try{
      const my = localStorage.getItem('shop_handle') || '';
      if(my && my === niceHandle) ownerActions.style.display = 'flex';
    }catch(e){}
  }

  // --- Load listings (temporary: from JSON). Later this will come from DB filtered by seller. ---
  let all = [];
  try{
    const res = await fetch('data/listings.json');
    all = await res.json();
  }catch(e){
    all = [];
  }

  // Assume each listing has a sellerHandle field; if not, fall back to designer containing the handle (dev-only)
  const mine = all.filter(it => {
    if(it.sellerHandle){ return String(it.sellerHandle).toLowerCase() === niceHandle.toLowerCase(); }
    const hay = ((it.seller||'') + ' ' + (it.designer||'') + ' ' + (it.title||'')).toLowerCase();
    return hay.includes(niceHandle.toLowerCase());
  });

  const grid = document.getElementById('grid');
  const empty = document.getElementById('empty');
  if(mine.length === 0){
    empty.style.display = 'block';
  }else{
    mine.forEach(it=>{
      const a = document.createElement('a');
      a.className = 'card';
      a.href = 'item.html?id=' + encodeURIComponent(it.id || '');
      a.innerHTML = `
        <div class="thumb">${it.photo ? '' : 'photo'}</div>
        <div class="info">
          <div class="title">${it.title || 'Untitled'}</div>
          <div class="meta"><span class="price">$${it.price || '—'}/yd</span><span>${(it.width||'') + (it.gsm? ' • '+it.gsm+' GSM':'' )}</span></div>
        </div>`;
      grid.appendChild(a);
    });
  }

  // Optional avatar image if you ever store one
  try{
    const url = localStorage.getItem("avatarUrl");
    if(url){ const av = document.getElementById("avatar"); if(av){ av.textContent=''; av.style.backgroundImage="url('"+url+"')"; } }
  }catch(e){}
})();
</script>
</body>
</html>
