<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Atelier â€” Hemline Market</title>

  <!-- Shared universal styles -->
  <link rel="stylesheet" href="styles/hm-modern.css"/>
  <link rel="stylesheet" href="styles/hem-header.css"/>
  <link rel="stylesheet" href="styles/hm-typography.css"/>
  <link rel="stylesheet" href="styles/hm-footer.css"/>
  <link rel="icon" href="/favicon.ico" type="image/x-icon"/>

  <!-- ALL your old Atelier styles kept exactly -->
  <style>
    :root{
      --hm-accent:#991b1b;
      --hm-border:#e5e7eb;
      --hm-muted:#6b7280;
      --hm-text:#111827;
      --hm-bg:#f4f4f7;
    }
    html,body{
      margin:0;
      max-width:100%;
      overflow-x:hidden;
      background:var(--hm-bg);
      color:var(--hm-text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      -webkit-font-smoothing:antialiased;
    }
    img,svg,canvas,video{max-width:100%;height:auto;display:block}

    main.atelier-wrap{
      max-width:1200px;
      margin:18px auto 24px;
      padding:0 12px;
      display:grid;
      grid-template-columns:minmax(0,2fr) minmax(0,1.3fr);
      gap:18px;
    }
    @media(max-width:880px){
      main.atelier-wrap{ grid-template-columns:1fr; }
    }

    h1.atelier-title{
      margin:0 0 4px;
      font-size:26px;
      font-weight:800;
    }
    .atelier-subtitle{
      margin:0 0 18px;
      color:var(--hm-muted);
      font-size:14px;
    }

    .hm-card{
      background:#fff;
      border-radius:14px;
      border:1px solid var(--hm-border);
      box-shadow:0 6px 18px rgba(15,23,42,.06);
      margin-bottom:16px;
    }
    .hm-card-header{
      padding:10px 16px;
      border-bottom:1px solid var(--hm-border);
      font-size:11px;
      letter-spacing:.18em;
      text-transform:uppercase;
      color:#9ca3af;
      font-weight:600;
    }
    .hm-card-body{
      padding:16px;
      font-size:14px;
    }

    .listings-empty{
      margin-top:12px;
      padding:12px 14px;
      border-radius:12px;
      border:1px dashed #d1d5db;
      background:#f9fafb;
      font-size:13px;
      color:#6b7280;
    }

    .atelier-listings-grid{
      margin-top:14px;
      display:grid;
      grid-template-columns:repeat(3,minmax(0,1fr));
      gap:12px;
    }
    @media(max-width:1050px){
      .atelier-listings-grid{ grid-template-columns:repeat(2,1fr); }
    }
    @media(max-width:640px){
      .atelier-listings-grid{ grid-template-columns:1fr; }
    }

    .atelier-card{
      border-radius:12px;
      border:1px solid var(--hm-border);
      background:#fff;
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }
    .atelier-card-photo{
      aspect-ratio:4/3;
      background:linear-gradient(180deg,#f8fafc,#e5e7eb);
      display:grid;
      place-items:center;
      color:#9ca3af;
      font-size:12px;
    }
    .atelier-card-photo img{
      width:100%;
      height:100%;
      object-fit:cover;
    }
    .atelier-card-body{
      padding:8px 10px 10px;
      display:flex;
      flex-direction:column;
      gap:4px;
      font-size:13px;
    }
  </style>
</head>
<body>

<!-- UNIVERSAL HEADER -->
<div id="hm-shell-header"></div>

<main class="atelier-wrap" id="maincontent">
  <section>
    <h1 class="atelier-title" id="atelierTitle">Atelier</h1>
    <p class="atelier-subtitle" id="atelierSubtitle">
      Browse fabrics from this studio and discover the story behind each piece.
    </p>

    <div class="hm-card">
      <div class="hm-card-header">Listings</div>
      <div class="hm-card-body">

        <div id="listingsEmpty" class="listings-empty">
          No listings yet.
        </div>

        <div id="listingsGrid" class="atelier-listings-grid" style="display:none;"></div>

      </div>
    </div>
  </section>

  <section>
    <div class="hm-card">
      <div class="hm-card-header">About this Atelier</div>
      <div class="hm-card-body">
        <div id="atelierOwnerName" style="font-weight:700;margin-bottom:8px;">
          Unknown shop
        </div>
        <div id="atelierBio" style="white-space:pre-line;"></div>
      </div>
    </div>
  </section>
</main>

<!-- UNIVERSAL FOOTER -->
<div id="hm-shell-footer"></div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="scripts/hm-shell.js"></script>

<script>
  const supabaseClient = window.supabase.createClient(
    "https://clkizksbvxjkoatdajgd.supabase.co",
    "YOUR_PUBLIC_ANON_KEY"
  );

  async function initAtelier(){
    const params = new URLSearchParams(window.location.search);
    const sellerId = params.get("u");

    const owner = document.getElementById("atelierOwnerName");
    const bio   = document.getElementById("atelierBio");
    const empty = document.getElementById("listingsEmpty");
    const grid  = document.getElementById("listingsGrid");

    if(!sellerId){
      owner.textContent = "Unknown shop";
      bio.textContent   = "";
      return;
    }

    const prof = await supabaseClient
      .from("profiles")
      .select("*")
      .eq("id", sellerId)
      .maybeSingle();

    if(prof.data){
      owner.textContent = (prof.data.first_name+" "+prof.data.last_name).trim() || prof.data.email;
      bio.textContent   = prof.data.bio || "";
    }

    const { data: listings } = await supabaseClient
      .from("listings")
      .select("*")
      .eq("seller_id", sellerId);

    if(!listings || !listings.length){
      empty.style.display="block";
      grid.style.display="none";
      return;
    }

    empty.style.display="none";
    grid.style.display="grid";

    grid.innerHTML = "";
    listings.forEach(l=>{
      const card = document.createElement("div");
      card.className = "atelier-card";

      const link = document.createElement("a");
      link.href = "listing.html?id="+l.id;
      link.className = "atelier-card-photo";

      if(l.image_url_1){
        const img = document.createElement("img");
        img.src = l.image_url_1;
        link.appendChild(img);
      }else{
        link.textContent="Photo";
      }

      const body = document.createElement("div");
      body.className = "atelier-card-body";

      const title = document.createElement("div");
      title.textContent = l.title;
      title.style.fontWeight="700";

      body.appendChild(title);
      card.appendChild(link);
      card.appendChild(body);
      grid.appendChild(card);
    });
  }

  initAtelier();
  window.HM && window.HM.renderShell({ currentPage:"atelier" });
</script>

</body>
</html>
