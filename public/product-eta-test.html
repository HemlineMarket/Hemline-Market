<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hemline — Product ETA Test</title>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: system-ui, sans-serif; margin: 24px; line-height: 1.45; }
    h1 { font-size: 20px; margin-bottom: 12px; }
    label { display:block; margin-top:12px; font-size:14px; }
    input { width:100%; padding:8px; border:1px solid #ddd; border-radius:6px; }
    .row { display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    button { margin-top:12px; padding:10px 14px; border:0; border-radius:8px; background:#111; color:#fff; cursor:pointer; }
    .muted { color:#6b7280; font-size:12px; }
  </style>
</head>
<body>
  <h1>Product ETA Test</h1>
  <p class="muted">This page mounts the reusable ETA widget and sets <code>seller_id</code> to the currently signed-in user.</p>

  <div class="row">
    <label>Weight (oz)
      <input id="w" type="number" step="0.1" value="24" />
      <span class="muted">Typical 2–3 yd light fabric: 12–24 oz</span>
    </label>
    <label>Ships in (min/max days)
      <div class="row" style="grid-template-columns: 1fr 1fr; gap:8px;">
        <input id="hmin" type="number" step="1" min="0" value="1" />
        <input id="hmax" type="number" step="1" min="0" value="2" />
      </div>
    </label>
  </div>

  <div class="row">
    <label>Length (in) <input id="lin" type="number" step="0.1" value="12" /></label>
    <label>Width (in)  <input id="win" type="number" step="0.1" value="9" /></label>
  </div>
  <div class="row">
    <label>Height (in) <input id="hin" type="number" step="0.1" value="2" /></label>
    <div></div>
  </div>

  <button id="mount">Mount ETA widget</button>

  <!-- Mount target; seller_id will be set by script below before init -->
  <div id="etaMount"
       data-weight-oz="24"
       data-handling-min="1"
       data-handling-max="2"
       data-length-in="12"
       data-width-in="9"
       data-height-in="2"></div>

  <script src="/js/eta-widget.js"></script>
  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
    const SUPABASE_URL = "https://clkizksbvxjkoatdajgd.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNsa2l6a3Nidnhqa29hdGRhamdkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2ODAyMDUsImV4cCI6MjA3MDI1NjIwNX0.m3wd6UAuqxa7BpcQof9mmzd8zdsmadwGDO0x7-nyBjI";
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const $ = id => document.getElementById(id);
    const mountBtn = $('mount');
    const mountDiv = $('etaMount');

    // Keep the mount's data attributes in sync with the inputs
    function syncAttrs() {
      mountDiv.setAttribute('data-weight-oz', String($('w').value));
      mountDiv.setAttribute('data-handling-min', String($('hmin').value));
      mountDiv.setAttribute('data-handling-max', String($('hmax').value));
      mountDiv.setAttribute('data-length-in', String($('lin').value));
      mountDiv.setAttribute('data-width-in',  String($('win').value));
      mountDiv.setAttribute('data-height-in', String($('hin').value));
    }

    mountBtn.addEventListener('click', async () => {
      // Require auth so we know which seller’s origin to use
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) {
        alert("Sign in first so we can set your seller_id.");
        return;
      }
      // Set seller_id + shipping attrs, then mount
      mountDiv.setAttribute('data-seller-id', user.id);
      syncAttrs();
      // Initialize the widget
      window.EtaWidget.init({ mountId: 'etaMount' });
    });
  </script>
</body>
</html>
