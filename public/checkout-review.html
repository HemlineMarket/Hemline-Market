<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<meta name="description" content="Hemline Market — Review your cart items, adjust yardage, and proceed to checkout with friendly, accessible validation.">
<title>Hemline Market — Order Review</title>
<meta name="theme-color" content="#333333"/>
<style>
  :root{
    --hm-charcoal:#333333; --hm-rosewood:#65000b; --hm-hunter:#355e3b; --hm-black:#000;
    --hm-text:#333333; --hm-muted:#6b7280; --hm-bg:#fff;
    --hm-border:1px solid rgba(0,0,0,.12); --hm-shadow:0 8px 24px rgba(0,0,0,.08);
    --hm-radius:14px; --hm-gap:16px; --hm-cta:#65000b;
    --hm-error-bg:#fff6f7; --hm-error-border:#ff8aa3; --hm-error-text:#7f1d1d;
  }
  *{box-sizing:border-box}
  html,body{margin:0;color:var(--hm-text);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:#f6f6f6}
  a{text-decoration:none;color:#000} a:hover{color:var(--hm-rosewood)}
  img{max-width:100%;display:block}

  /* ✅ Visible keyboard focus */
  :focus-visible{ outline:3px solid var(--hm-rosewood); outline-offset:2px; border-radius:6px; }

  /* Header (matches site) + cart badge */
  .hm-header{position:sticky;top:0;z-index:50;background:rgba(255,255,255,.9);backdrop-filter:saturate(120%) blur(6px);border-bottom:1px solid rgba(0,0,0,.08)}
  .hm-header-inner{height:90px;max-width:1100px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;gap:20px;padding:0 16px}
  .hm-logo img{height:80px}
  .hm-nav{display:flex;gap:20px;align-items:center;flex-wrap:wrap}
  .hm-nav a{font-weight:700}
  .hm-nav .cta{font-weight:900;padding:10px 18px;border-radius:999px;background:var(--hm-cta);color:#fff;border:1px solid #000}
  .cart-link{position:relative;padding-right:10px}
  .cart-count{position:absolute;top:-8px;right:-12px;min-width:20px;height:20px;border-radius:999px;background:#111;color:#fff;display:inline-flex;align-items:center;justify-content:center;font-size:12px;font-weight:800;border:1px solid #000}

  /* Page */
  .wrap{max-width:1100px;margin:24px auto 48px;padding:0 16px;display:grid;grid-template-columns:1.2fr .8fr;gap:22px}
  @media (max-width:980px){.wrap{grid-template-columns:1fr}}
  .card{background:#fff;border:var(--hm-border);border-radius:18px;box-shadow:var(--hm-shadow)}
  .card h2{margin:0;padding:16px 18px;border-bottom:1px solid rgba(0,0,0,.12)}
  .card-body{padding:18px}

  .row{display:grid;grid-template-columns:80px 1fr auto;gap:12px;align-items:center;padding:12px 0;border-bottom:1px dashed rgba(0,0,0,.08)}
  .row:last-child{border-bottom:none}
  .thumb{width:80px;height:80px;border-radius:12px;background:linear-gradient(0deg,#e9e9e9,#f5f5f5);overflow:hidden;border:var(--hm-border)}
  .thumb img{width:100%;height:100%;object-fit:cover}
  .line-title{font-weight:800}
  .meta{color:var(--hm-muted);font-size:13px}

  .qty{display:flex;align-items:center;gap:6px}
  .qty button{width:30px;height:30px;border:var(--hm-border);border-radius:10px;background:#fff;font-weight:900;cursor:pointer}
  .qty input{width:64px;text-align:center;padding:10px;border:var(--hm-border);border-radius:10px}
  .remove{color:#7f1d1d;font-weight:800;cursor:pointer;border:var(--hm-border);border-radius:10px;padding:6px 8px;background:#fff}

  .summary li{display:flex;justify-content:space-between;margin:8px 0}
  .summary .total{font-weight:900;font-size:18px}
  .cta{display:block;text-align:center;margin-top:14px;padding:12px 16px;border-radius:12px;border:1px solid #000;background:var(--hm-cta);color:#fff;font-weight:900;text-decoration:none}
  .cta[aria-disabled="true"]{opacity:.6;pointer-events:none}
  .ghost{display:block;text-align:center;margin-top:10px;padding:10px 14px;border-radius:12px;border:var(--hm-border);background:#fff;font-weight:800}

  .empty{padding:22px;text-align:center}
  .empty h3{margin:6px 0 4px}
  .empty p{color:var(--hm-muted)}

  /* ✅ Friendly inline errors */
  .error-summary{
    display:none; margin:0 0 12px 0; border-radius:14px;
    background:var(--hm-error-bg); border:2px solid var(--hm-error-border);
    color:var(--hm-error-text); padding:12px 14px; font-weight:800;
  }
  .error-summary.show{display:block}
  .error-list{margin:8px 0 0 18px; color:var(--hm-error-text)}
  .row.error .qty input{outline:3px solid rgba(255,0,66,.15); border-color:var(--hm-error-border)}
</style>
</head>
<body>

<header class="hm-header">
  <div class="hm-header-inner">
    <a class="hm-logo" href="/" aria-label="Hemline Market home">
      <img src="/logo.png" alt="Hemline Market logo" onerror="this.style.display='none'">
    </a>
    <nav class="hm-nav" aria-label="Primary">
      <a href="/catalog.html">Browse</a>
      <a href="/favorites" aria-label="Favorites">❤ Favorites</a>
      <a href="/account">My Account</a>
      <a href="/cart.html" class="cart-link" aria-label="Shopping cart">Cart <span class="cart-count" data-cart-count>0</span></a>
      <a class="cta" href="/list">List Item</a>
    </nav>
  </div>
</header>

<main class="wrap">
  <!-- Left: items -->
  <section class="card" aria-label="Order review items">
    <h2>Order Review</h2>
    <div class="card-body">
      <!-- ✅ error summary lives here -->
      <div id="errorSummary" class="error-summary" role="alert" aria-live="assertive" tabindex="-1">
        Let’s fix a few things:
        <ul id="errorList" class="error-list"></ul>
      </div>

      <div id="lines"></div>
    </div>
  </section>

  <!-- Right: totals -->
  <aside class="card" aria-label="Order summary">
    <h2>Summary</h2>
    <div class="card-body">
      <ul class="summary" id="summary">
        <li><span>Subtotal</span><span id="s-sub">$0.00</span></li>
        <li><span>Shipping</span><span id="s-ship">$6.95</span></li>
        <li><span>Tax (est.)</span><span id="s-tax">$0.00</span></li>
        <li class="total"><span>Total</span><span id="s-total">$0.00</span></li>
      </ul>
      <a href="/checkout.html" class="cta" id="proceed" aria-disabled="true">Proceed to Checkout</a>
      <a href="/catalog.html" class="ghost">Keep browsing</a>
    </div>
  </aside>
</main>

<script>
/* Tiny cart util + friendly errors + a11y tweaks */
(function(){
  const CART_KEY='hm_cart_v1';
  const shipFlat = 6.95;   // placeholder (shipping calc later)
  const taxRate  = 0.00;   // placeholder

  const $ = (s,r=document)=>r.querySelector(s);
  const $$ = (s,r=document)=>Array.from(r.querySelectorAll(s));
  const fmt = n => '$' + (Number(n||0)).toFixed(2);

  function readCart(){ try{ return JSON.parse(localStorage.getItem(CART_KEY)||'[]'); }catch(e){ return []; } }
  function writeCart(items){ localStorage.setItem(CART_KEY, JSON.stringify(items)); syncCount(); }

  function syncCount(){
    const count = readCart().reduce((n,i)=>n+(Number(i.qty)||1),0);
    document.querySelectorAll('[data-cart-count]').forEach(el=>el.textContent=count);
  }

  function validateItems(items){
    const errors = [];
    const MIN_QTY = 1;
    const MAX_QTY = 500;
    const MIN_PRICE = 0;

    items.forEach((it, idx)=>{
      const q = Number(it.qty||0);
      const p = Number(it.price||0);
      if(!Number.isFinite(q) || q < MIN_QTY) errors.push({idx, type:'qty', msg:`“${it.name||'Item'}” needs at least 1 yard.`});
      if(q > MAX_QTY) errors.push({idx, type:'qty', msg:`“${it.name||'Item'}” quantity looks too high.`});
      if(!Number.isFinite(p) || p < MIN_PRICE) errors.push({idx, type:'price', msg:`“${it.name||'Item'}” has an invalid price.`});
    });
    return errors;
  }

  function render(){
    const lines = $('#lines');
    const errorSummary = $('#errorSummary');
    const errorList = $('#errorList');
    const proceed = $('#proceed');

    const items = readCart();

    // Empty state
    if(!items.length){
      lines.innerHTML = `
        <div class="empty">
          <h3>Your cart is empty</h3>
          <p class="meta">Save favorites for later or keep browsing — we’ll hold your picks here.</p>
          <a class="ghost" href="/catalog.html">Browse fabrics →</a>
        </div>`;
      $('#s-sub').textContent = fmt(0);
      $('#s-tax').textContent = fmt(0);
      $('#s-total').textContent = fmt(0 + shipFlat);
      proceed.setAttribute('aria-disabled','true');
      errorSummary.classList.remove('show');
      errorList.innerHTML='';
      return;
    }

    // Render lines
    lines.innerHTML = '';
    items.forEach((it, idx)=>{
      const row = document.createElement('div');
      row.className = 'row';
      row.setAttribute('data-idx', idx);

      const t = document.createElement('div');
      t.className = 'thumb';
      if(it.image){ const img = document.createElement('img'); img.src = it.image; img.alt = it.name ? `${it.name} preview` : 'Item preview'; t.appendChild(img); }
      row.appendChild(t);

      const mid = document.createElement('div');
      const qtyId = `qty-${idx}`;
      mid.innerHTML = `
        <div class="line-title">${it.name||'Fabric'}</div>
        <div class="meta">${it.sku||''}</div>
        <div class="qty" aria-label="Quantity controls for ${it.name||'item'}">
          <button type="button" data-act="dec" aria-controls="${qtyId}" aria-label="Decrease quantity">−</button>
          <input id="${qtyId}" type="number" inputmode="numeric" min="1" step="1" value="${Number(it.qty||1)}" aria-label="Quantity (yards)">
          <button type="button" data-act="inc" aria-controls="${qtyId}" aria-label="Increase quantity">+</button>
          <span class="meta" style="margin-left:8px">yd</span>
          <button type="button" class="remove" data-act="rm" aria-label="Remove ${it.name||'item'} from cart">Remove</button>
        </div>`;
      row.appendChild(mid);

      const rt = document.createElement('div');
      rt.style.fontWeight='900';
      rt.setAttribute('aria-live','polite');
      rt.textContent = fmt((it.price||0) * (it.qty||1));
      row.appendChild(rt);

      lines.appendChild(row);
    });

    // Qty handlers + input
    lines.addEventListener('click', (e)=>{
      const btn = e.target.closest('[data-act]');
      if(!btn) return;
      const act = btn.getAttribute('data-act');
      const row = btn.closest('.row'); const idx = Number(row?.getAttribute('data-idx')); if(isNaN(idx)) return;
      const items = readCart(); if(!items[idx]) return;

      if(act==='inc'){ items[idx].qty = (Number(items[idx].qty)||1) + 1; }
      if(act==='dec'){ items[idx].qty = Math.max(1, (Number(items[idx].qty)||1) - 1); }
      if(act==='rm'){ items.splice(idx,1); }
      writeCart(items);
      render();
    }, { once:true });

    lines.addEventListener('change', (e)=>{
      const input = e.target.closest('.qty input');
      if(!input) return;
      const row = input.closest('.row'); const idx = Number(row?.getAttribute('data-idx')); if(isNaN(idx)) return;
      const items = readCart(); if(!items[idx]) return;

      const v = Math.max(1, Math.floor(Number(input.value)||1));
      items[idx].qty = v; writeCart(items); render();
    }, { once:true });

    // Totals
    const sub = items.reduce((n,i)=>n + (Number(i.price||0) * (Number(i.qty||1))), 0);
    const tax = sub * taxRate;
    const total = sub + shipFlat + tax;
    $('#s-sub').textContent = fmt(sub);
    $('#s-tax').textContent = fmt(tax);
    $('#s-total').textContent = fmt(total);

    // ✅ Validate & show friendly errors
    const errs = validateItems(items);
    $$('.row').forEach(r=>r.classList.remove('error'));
    if(errs.length){
      errorList.innerHTML='';
      errs.forEach(er=>{
        const li=document.createElement('li'); li.textContent=er.msg; errorList.appendChild(li);
        const badRow = $(`.row[data-idx="${er.idx}"]`); badRow?.classList.add('error');
      });
      errorSummary.classList.add('show');
      errorSummary.focus();
      proceed.setAttribute('aria-disabled','true');
    } else {
      errorSummary.classList.remove('show');
      errorList.innerHTML='';
      proceed.removeAttribute('aria-disabled');
    }
  }

  // Prevent navigation when disabled
  document.addEventListener('click', (e)=>{
    const a = e.target.closest('a#proceed[aria-disabled="true"]');
    if(a){ e.preventDefault(); const sum = document.getElementById('errorSummary'); sum?.scrollIntoView({behavior:'smooth', block:'center'}); }
  });

  // init
  syncCount();
  render();
})();
</script>

</body>
</html>
