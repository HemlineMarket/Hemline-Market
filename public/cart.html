<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Cart — Hemline Market</title>

  <link rel="stylesheet" href="styles/hm-modern.css"/>
  <link rel="stylesheet" href="styles/hem-header.css"/>
  <link rel="stylesheet" href="styles/hm-typography.css"/>
  <link rel="stylesheet" href="styles/hm-footer.css"/>

  <style>
    :root{
      --hm-accent:#991b1b;
      --hm-border:#e5e7eb;
    }
    body{margin:0;background:#fafafa;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;-webkit-font-smoothing:antialiased;color:#111827}
    .wrap{max-width:900px;margin:20px auto;padding:0 12px}

    h1{font-size:24px;margin-bottom:20px}

    table{width:100%;border-collapse:collapse;background:#fff;border:1px solid var(--hm-border);border-radius:12px;overflow:hidden}
    th,td{padding:12px;border-bottom:1px solid var(--hm-border);text-align:left;font-size:14px}
    th{background:#f9fafb;font-weight:700}
    td img{width:60px;height:60px;object-fit:cover;border-radius:8px}
    td .title{font-weight:600}
    td .price{color:#374151}
    td .qty input{width:60px;padding:6px;border:1px solid var(--hm-border);border-radius:6px;text-align:center}
    td .remove{color:#991b1b;cursor:pointer;font-weight:700}
    tr:last-child td{border-bottom:0}

    .summary{margin-top:20px;display:flex;justify-content:space-between;align-items:center}
    .subtotal{font-size:18px;font-weight:700}
    .checkout-btn{background:var(--hm-accent);color:#fff;padding:12px 24px;border-radius:999px;font-weight:700;border:0;cursor:pointer}
    .checkout-btn[disabled]{opacity:.6;cursor:not-allowed}
  </style>
</head>
<body>

<!-- HEADER -->
<header class="hm-header" role="banner">
  <div class="wrap" style="display:flex;justify-content:space-between;align-items:center">
    <a class="hm-brand" href="index.html">Hemline Market</a>
    <a href="browse.html">Continue Shopping</a>
  </div>
</header>

<div class="wrap">
  <h1>Your Cart</h1>
  <div id="cartTable"></div>
  <div class="summary">
    <div class="subtotal" id="subtotal">Subtotal: $0.00</div>
    <button id="checkoutBtn" class="checkout-btn">Checkout</button>
  </div>
</div>

<!-- FOOTER -->
<footer class="hm-footer">
  <div class="footer-wrap">
    <div class="copy">© 2025 Hemline Market</div>
    <nav class="footer-links">
      <a href="about.html">About</a>
      <a href="faq.html">FAQ</a>
      <a href="contact.html">Contact</a>
      <a href="terms.html">Terms</a>
      <a href="privacy.html">Privacy</a>
    </nav>
  </div>
</footer>

<script src="scripts/cart.js"></script>
<script>
(function(){
  const cartTable = document.getElementById('cartTable');
  const subtotalEl = document.getElementById('subtotal');
  const checkoutBtn = document.getElementById('checkoutBtn');

  function render(){
    const items = Cart.get();
    if(!items.length){
      cartTable.innerHTML = '<p>Your cart is empty.</p>';
      checkoutBtn.disabled = true;
      subtotalEl.textContent = 'Subtotal: $0.00';
      return;
    }
    let html = '<table><thead><tr><th>Item</th><th>Price</th><th>Qty</th><th>Total</th><th></th></tr></thead><tbody>';
    let subtotal = 0;
    items.forEach((it,i)=>{
      const line = it.price * it.qty;
      subtotal += line;
      html += `<tr>
        <td><img src="${it.image||''}" alt=""><span class="title">${it.name}</span></td>
        <td class="price">$${(it.price/100).toFixed(2)}</td>
        <td class="qty"><input type="number" min="1" value="${it.qty}" data-index="${i}"></td>
        <td>$${(line/100).toFixed(2)}</td>
        <td><span class="remove" data-index="${i}">×</span></td>
      </tr>`;
    });
    html += '</tbody></table>';
    cartTable.innerHTML = html;
    subtotalEl.textContent = 'Subtotal: $' + (subtotal/100).toFixed(2);
    checkoutBtn.disabled = false;
  }

  // Event listeners
  cartTable.addEventListener('input', e=>{
    if(e.target.matches('input[type="number"]')){
      const i = +e.target.dataset.index;
      Cart.updateQty(i, +e.target.value);
      render();
    }
  });
  cartTable.addEventListener('click', e=>{
    if(e.target.matches('.remove')){
      const i = +e.target.dataset.index;
      Cart.remove(i);
      render();
    }
  });

  checkoutBtn.addEventListener('click', async ()=>{
    checkoutBtn.disabled = true;
    try{
      const items = Cart.get();
      const res = await fetch('/api/checkout/stripe', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ items })
      });
      const data = await res.json();
      if(data.url){ window.location.href = data.url; }
      else alert(data.error || 'Checkout failed');
    }catch(err){ alert('Checkout error'); }
    finally{ checkoutBtn.disabled = false; }
  });

  render();
})();
</script>
</body>
</html>
