<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Your Cart — Hemline Market</title>
  <link rel="stylesheet" href="/styles/hm-modern.css">
  <link rel="stylesheet" href="/styles/hem-header.css">
  <link rel="stylesheet" href="/styles/hm-typography.css">
  <link rel="stylesheet" href="/styles/hm-footer.css">
  <style>
    :root{ --hm-accent:#991b1b; --hm-border:#e5e7eb; --hm-muted:#6b7280; }
    body{margin:0;background:#fafafa;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
    .wrap{max-width:900px;margin:16px auto;padding:0 12px}
    .card{background:#fff;border:1px solid var(--hm-border);border-radius:12px;padding:12px}
    .line{display:grid;grid-template-columns:1fr auto auto auto;gap:10px;align-items:center;border-bottom:1px dashed #eee;padding:10px 0}
    .line:last-child{border-bottom:0}
    .qty{display:inline-flex;align-items:center;border:1px solid var(--hm-border);border-radius:10px;overflow:hidden}
    .qty button{background:#fff;border:0;padding:8px 10px;cursor:pointer}
    .qty input{width:46px;text-align:center;border:0;padding:8px 0}
    .right{display:flex;gap:10px;align-items:center}
    .total{display:flex;justify-content:flex-end;gap:20px;margin-top:12px;font-weight:800}
    .muted{color:var(--hm-muted)}
    .btn{padding:10px 14px;border-radius:10px;border:1px solid var(--hm-border);background:#fff;font-weight:700;cursor:pointer}
    .btn-primary{border-color:var(--hm-accent);background:var(--hm-accent);color:#fff;box-shadow:0 2px 8px rgba(153,27,27,.25)}
    .empty{color:var(--hm-muted);text-align:center;padding:40px 10px}
    .cart-badge{ position:absolute; top:-6px; right:-8px; min-width:18px; height:18px; padding:0 4px; display:none; align-items:center; justify-content:center; background:var(--hm-accent); color:#fff; border-radius:999px; font-size:11px; font-weight:800; line-height:18px; border:1px solid #fff; }
  </style>
</head>
<body>

<header class="hm-header">
  <div class="wrap" style="max-width:1200px">
    <div class="left">
      <a class="hm-brand" href="index.html">Hemline Market</a>
    </div>
    <div class="right">
      <a class="hm-icon" href="browse.html" aria-label="Browse">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="11" cy="11" r="8"></circle><path d="M21 21l-4.3-4.3"></path></svg>
      </a>
      <a class="hm-icon" href="cart.html" aria-label="Cart">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <circle cx="9"  cy="21" r="1"></circle><circle cx="18" cy="21" r="1"></circle>
          <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h7.72a2 2 0 0 0 2-1.61L23 6H6"></path>
        </svg>
        <span class="cart-badge" data-cart-badge></span>
      </a>
    </div>
  </div>
</header>

<div class="wrap">
  <h1>Your Cart</h1>
  <div id="cartBox" class="card"></div>
  <div class="total"><span>Subtotal</span><span id="subtotal">$0.00</span></div>
  <div class="right" style="justify-content:flex-end;margin-top:10px">
    <a class="btn" href="browse.html">Continue shopping</a>
    <button id="checkout" class="btn btn-primary">Checkout</button>
  </div>
</div>

<footer class="hm-footer" role="contentinfo">
  <div class="footer-wrap" style="max-width:1200px">
    <div class="copy">© 2025 Hemline Market</div>
    <nav class="footer-links"><a href="about.html">About</a><a href="faq.html">FAQ</a><a href="contact.html">Contact</a><a href="terms.html">Terms</a><a href="privacy.html">Privacy</a></nav>
  </div>
</footer>

<script>
(function(){
  const box = document.getElementById('cartBox');
  const subtotalEl = document.getElementById('subtotal');
  const checkoutBtn = document.getElementById('checkout');
  const badge = document.querySelector('[data-cart-badge]');

  function readCart(){ try{ return JSON.parse(localStorage.getItem('hm_cart')||'[]'); }catch(_){ return []; } }
  function writeCart(items){ localStorage.setItem('hm_cart', JSON.stringify(items)); updateBadge(items); }
  function money(cents){ return '$' + (cents/100).toFixed(2); }

  function updateBadge(items = readCart()){
    if (!badge) return;
    const n = items.reduce((s,i)=>s+(i.qty||1),0);
    if (n>0){ badge.textContent=n; badge.style.display='inline-flex'; }
    else { badge.textContent=''; badge.style.display='none'; }
  }

  function render(){
    const items = readCart();
    if (items.length===0){
      box.innerHTML = '<div class="empty">Your cart is empty.</div>';
      subtotalEl.textContent = '$0.00';
      updateBadge(items);
      return;
    }
    let html = '';
    let subtotal = 0;
    items.forEach((it, idx)=>{
      const line = (it.amount||0) * (it.qty||1);
      subtotal += line;
      html += `
        <div class="line" data-idx="${idx}">
          <div><strong>${it.name||'Item'}</strong><div class="muted">${it.id||''}</div></div>
          <div class="muted">${money(it.amount||0)}</div>
          <div class="qty">
            <button type="button" data-action="dec">−</button>
            <input type="number" min="1" step="1" value="${it.qty||1}" data-qty readonly>
            <button type="button" data-action="inc">+</button>
          </div>
          <div><strong>${money(line)}</strong> <button class="btn" data-action="remove" style="margin-left:8px">Remove</button></div>
        </div>`;
    });
    box.innerHTML = html;
    subtotalEl.textContent = money(subtotal);
    updateBadge(items);
  }

  // quantity / remove
  box.addEventListener('click', (e)=>{
    const line = e.target.closest('.line'); if(!line) return;
    const idx = parseInt(line.dataset.idx,10);
    const items = readCart();
    if (Number.isNaN(idx) || !items[idx]) return;

    const act = e.target.getAttribute('data-action');
    if (act === 'inc'){ items[idx].qty = (items[idx].qty||1) + 1; writeCart(items); render(); }
    if (act === 'dec'){ items[idx].qty = Math.max(1, (items[idx].qty||1) - 1); writeCart(items); render(); }
    if (act === 'remove'){ items.splice(idx,1); writeCart(items); render(); }
  });

  // Fake checkout hook (leave as-is; your real Stripe flow can read hm_cart server-side if needed)
  checkoutBtn.addEventListener('click', async ()=>{
    const items = readCart();
    if (items.length===0) return alert('Cart is empty.');
    // Example: send to your API later. For now, just go back to browse.
    alert('Proceeding to checkout…');
    location.href = 'browse.html';
  });

  // initial
  render();
  // make sure header badge updates if user navigated here directly
  if (window.HM_CART_BADGE_UPDATE) window.HM_CART_BADGE_UPDATE(readCart());
})();
</script>
</body>
</html>
