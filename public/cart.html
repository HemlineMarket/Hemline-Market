<!doctype html><html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Hemline ‚Äî Cart</title>
<style>
:root{--ink:#0f172a;--line:#e5e7eb;--bg:#fafafa;--card:#fff;--brand:#0ea5e9}
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;margin:24px;background:var(--bg);color:var(--ink)}
.wrap{max-width:1000px;margin:auto}h1{font-size:1.75rem;margin:0 0 8px}.sub{color:#475569;margin:0 0 24px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px}
.card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:14px;box-shadow:0 2px 6px rgba(0,0,0,.05)}
.thumb{width:100%;height:170px;object-fit:cover;border-radius:8px;margin:0 0 10px;background:#f1f5f9}
.row{display:flex;justify-content:space-between;align-items:center;gap:8px}.title{font-weight:600}
.qty{display:flex;align-items:center;gap:6px}.btn{border:1px solid var(--line);background:#fff;border-radius:10px;padding:6px 10px;cursor:pointer}
.btn:hover{border-color:#cbd5e1}.danger{color:#b91c1c;border-color:#fecaca}
.bar{display:flex;justify-content:space-between;align-items:center;margin:18px 0 10px}
.cta{background:var(--brand);color:#fff;border:none;border-radius:12px;padding:10px 16px;font-weight:600;cursor:pointer}
.cta:disabled{opacity:.5;cursor:not-allowed}.link{color:#111827;text-decoration:none}
.totals{background:#fff;border:1px solid var(--line);border-radius:12px;padding:14px;margin-top:16px}
.empty{border:2px dashed var(--line);border-radius:12px;padding:24px;text-align:center;color:#475569}

/* Arrivals + flip */
.carousel{margin:26px 0 6px}
.track{display:grid;grid-auto-flow:column;grid-auto-columns:minmax(220px,1fr);gap:12px;overflow:auto;padding-bottom:6px;scroll-snap-type:x mandatory}
.flip{perspective:1000px;cursor:pointer}
.flip>.face{position:relative;transform-style:preserve-3d;transition:transform .5s;border:1px solid var(--line);border-radius:12px;overflow:hidden}
.flip.is-flipped>.face{transform:rotateY(180deg)}
.flip .front,.flip .back{backface-visibility:hidden;padding:12px;background:#fff;min-height:240px}
.flip .front img{width:100%;height:140px;object-fit:cover;border-radius:8px;margin-bottom:8px}
.flip .back{position:absolute;inset:0;transform:rotateY(180deg)}
.badge{display:inline-block;background:#e2e8f0;border-radius:999px;padding:2px 8px;font-size:.75rem;margin-top:6px}
.small{font-size:.9rem;color:#475569}
.add{margin-top:10px;background:#0ea5e9;color:#fff;border:none;border-radius:10px;padding:8px 10px;cursor:pointer;width:100%}

/* Fabric Roll progress overlay */
.overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(15,23,42,.55);backdrop-filter:blur(2px);z-index:50}
.panel{width:min(560px,92vw);background:#fff;border:1px solid var(--line);border-radius:16px;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,.15)}
.step{display:flex;align-items:center;gap:10px;margin:10px 0}
.dot{width:10px;height:10px;border-radius:50%;background:#cbd5e1}
.step.done .dot{background:#0ea5e9}
.roll{height:16px;border-radius:999px;border:1px solid #cbd5e1;overflow:hidden;margin:12px 0 6px}
.fill{height:100%;width:0%;background:repeating-linear-gradient(135deg,#0ea5e9 0 14px,#38bdf8 14px 28px);transition:width .5s}
.note{font-size:.9rem;color:#475569}
</style>
</head><body><div class="wrap">
  <h1>üßµ Your Cart</h1>
  <p class="sub">Items you‚Äôve added. Edit quantities or remove before checkout.</p>

  <div id="cartGrid" class="grid" hidden></div>
  <div id="emptyMsg" class="empty" hidden>Cart is empty. <a class="link" href="/listings.html">Continue shopping ‚Üí</a></div>

  <div class="totals" id="totalsBox" hidden>
    <div class="bar"><strong>Subtotal</strong><div><span id="subtotal">$0.00</span></div></div>
    <div class="bar">
      <a class="link" href="/listings.html">‚Üê Continue shopping</a>
      <div style="display:flex;gap:8px">
        <button id="clearBtn" class="btn danger">Remove all</button>
        <button id="checkoutBtn" class="cta" disabled>Checkout</button>
      </div>
    </div>
  </div>

  <div class="carousel">
    <div class="bar"><strong>New Arrivals</strong><span class="small">Click a card to flip</span></div>
    <div id="arrivals" class="track"></div>
  </div>
</div>

<!-- Fabric Roll Progress Overlay -->
<div id="overlay" class="overlay">
  <div class="panel">
    <h3 style="margin:0 0 6px">Preparing Checkout</h3>
    <div class="step" id="s1"><span class="dot"></span><span>Securing cart</span></div>
    <div class="step" id="s2"><span class="dot"></span><span>Creating checkout session</span></div>
    <div class="step" id="s3"><span class="dot"></span><span>Rolling fabric to counter</span></div>
    <div class="roll"><div id="fill" class="fill"></div></div>
    <div class="note" id="note">Please wait‚Ä¶</div>
  </div>
</div>

<script>
/* Cart core */
(function(){
  const KEY="hem_cart",PH="https://via.placeholder.com/600x400?text=Fabric";
  const read=()=>{try{const v=JSON.parse(localStorage.getItem(KEY)||"[]");return Array.isArray(v)?v:[]}catch(e){return[]}};
  const save=(a)=>localStorage.setItem(KEY,JSON.stringify(a));
  const $=(id)=>document.getElementById(id); const fmt=(n)=>`$${n.toFixed(2)}`;
  function render(){
    let cart=read(); const grid=$("cartGrid"),empty=$("emptyMsg"),totals=$("totalsBox"),
      subtotalEl=$("subtotal"),checkout=$("checkoutBtn"),clearBtn=$("clearBtn");
    grid.innerHTML="";
    if(!cart.length){grid.hidden=true;empty.hidden=false;totals.hidden=true;return}
    empty.hidden=true;grid.hidden=false;totals.hidden=false;
    cart.forEach((it,i)=>{
      const card=document.createElement("div");card.className="card";
      card.innerHTML=`
        <img class="thumb" src="${it.img||PH}" alt="Fabric"/>
        <div class="title">${it.title||"Untitled Fabric"}</div>
        <div class="row"><span class="small">Price/Yd</span><strong>${fmt(+it.price||0)}</strong></div>
        <div class="row"><span class="small">Yards</span>
          <div class="qty">
            <button class="btn" data-a="dec" data-i="${i}">‚àí</button>
            <span id="q-${i}">${it.qty||1}</span>
            <button class="btn" data-a="inc" data-i="${i}">+</button>
          </div>
        </div>
        <div class="row"><span class="small">Line total</span><strong id="l-${i}">${fmt((+it.price||0)*(it.qty||1))}</strong></div>
        <div class="row"><span></span><button class="btn danger" data-a="rm" data-i="${i}">Remove</button></div>`;
      grid.appendChild(card);
    });
    grid.onclick=(e)=>{const b=e.target.closest("button");if(!b)return;const i=+b.dataset.i,a=b.dataset.a,cartNow=read();
      if(a==="inc") cartNow[i].qty=(cartNow[i].qty||1)+1;
      if(a==="dec") cartNow[i].qty=Math.max(1,(cartNow[i].qty||1)-1);
      if(a==="rm") cartNow.splice(i,1);
      save(cartNow);render();
    };
    const sum=read().reduce((s,x)=>s+(+x.price||0)*(x.qty||1),0);
    subtotalEl.textContent=fmt(sum); checkout.disabled=!(sum>0);
    clearBtn.onclick=()=>{save([]);render()};
    checkout.onclick=startCheckout;
  }
  render();

  /* Checkout skeleton with Fabric Roll */
  function startCheckout(){
    const overlay=$("overlay"),fill=$("fill"),s1=$("s1"),s2=$("s2"),s3=$("s3"),note=$("note");
    overlay.style.display="flex"; fill.style.width="0%"; [s1,s2,s3].forEach(x=>x.classList.remove("done")); note.textContent="Please wait‚Ä¶";

    const tick=(w,el,msg,cb)=>setTimeout(()=>{fill.style.width=w; el.classList.add("done"); note.textContent=msg; cb&&cb();},450);

    tick("25%",s1,"Cart secured",()=> {
      tick("60%",s2,"Checkout session ready",()=> {
        tick("100%",s3,"Redirecting to payment‚Ä¶",()=> {
          // Placeholder redirect (real Stripe comes next step)
          setTimeout(()=>{ alert("Stripe Checkout integration comes next. Progress bar is working."); overlay.style.display="none"; },700);
        });
      });
    });
  }
})();

/* Arrivals */
(function(){
  const data=[
    {id:"mw-wool-crepe",title:"Merino Wool Crepe ‚Äî Black",price:38.00,img:"https://images.unsplash.com/photo-1610030469983-98b5a19b7935?q=80&w=1200"},
    {id:"silk-charmeuse",title:"Silk Charmeuse ‚Äî Ivory",price:42.00,img:"https://images.unsplash.com/photo-1542060748-10c28b62716a?q=80&w=1200"},
    {id:"cotton-sateen",title:"Cotton Sateen ‚Äî Navy",price:18.50,img:"https://images.unsplash.com/photo-1490481651871-ab68de25d43d?q=80&w=1200"},
    {id:"tropical-wool",title:"Tropical Wool ‚Äî Charcoal",price:34.00,img:"https://images.unsplash.com/photo-1512436991641-6745cdb1723f?q=80&w=1200"}
  ];
  const track=document.getElementById("arrivals");
  function add(it){
    let cart=[]; try{cart=JSON.parse(localStorage.getItem("hem_cart")||"[]")}catch(e){}
    const f=cart.find(x=>x.id===it.id); if(f) f.qty=(f.qty||1)+1; else cart.push({...it,qty:1});
    localStorage.setItem("hem_cart",JSON.stringify(cart)); alert("Added to cart"); location.reload();
  }
  data.forEach(it=>{
    const el=document.createElement("div");el.className="flip";el.innerHTML=`
      <div class="face">
        <div class="front"><img src="${it.img}" alt="Fabric"/><div class="title">${it.title}</div><div class="badge">$${it.price}/yd</div></div>
        <div class="back"><div class="title">${it.title}</div><p class="small">Luxe hand, smooth drape. Ideal for skirts & dresses.</p><button class="add">Add to Cart</button></div>
      </div>`;
    el.addEventListener("click",(e)=>{if(e.target.classList.contains("add"))return;el.classList.toggle("is-flipped")});
    el.querySelector(".add").onclick=()=>add(it);
    track.appendChild(el);
  });
})();
</script>
</body></html>
