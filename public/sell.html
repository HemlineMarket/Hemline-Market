<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<meta name="description" content="Hemline Market ‚Äî List fabric with clear photos and transparent specs. Accessible, seller-friendly form with live validation.">
<title>Hemline Market ‚Äî List an Item</title>
<meta name="theme-color" content="#333333"/>
<style>
  :root{
    --hm-charcoal:#333333; --hm-rosewood:#65000b; --hm-hunter:#355e3b; --hm-black:#000;
    --hm-bg:#fff; --hm-text:#333333; --hm-muted:#6b7280;
    --hm-border:1px solid rgba(0,0,0,.12); --hm-shadow:0 8px 24px rgba(0,0,0,.08);
    --hm-radius:14px; --hm-gap:16px; --hm-cta:#65000b;
    --hm-error-bg:#fff6f7; --hm-error-border:#ff8aa3; --hm-error-text:#7f1d1d;
    --hm-good:#22c55e;
  }
  *{box-sizing:border-box}
  html,body{margin:0;color:var(--hm-text);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}

  /* FULL-BLEED BACKGROUND (brand) */
  body{position:relative;min-height:100vh}
  body::before{
    content:""; position:fixed; inset:0; z-index:-2;
    background:url('/bodyforms.jpg') center/cover no-repeat;
    background-position:50% 40%;
  }
  body::after{
    content:""; position:fixed; inset:0; z-index:-1; pointer-events:none;
    background:
      radial-gradient(1200px 520px at 8% 20%, rgba(0,0,0,.46), transparent 58%),
      linear-gradient(to bottom, rgba(255,255,255,.06), rgba(255,255,255,.36) 65%, rgba(255,255,255,.44));
  }

  a{text-decoration:none;color:#000} a:hover{color:var(--hm-rosewood)}
  img{max-width:100%;display:block}

  /* ‚úÖ Visible keyboard focus */
  :focus-visible{ outline:3px solid var(--hm-rosewood); outline-offset:2px; border-radius:6px; }

  /* Header (site) */
  .hm-header{position:sticky;top:0;z-index:50;background:rgba(255,255,255,.9);backdrop-filter:saturate(120%) blur(6px);border-bottom:1px solid rgba(0,0,0,.08)}
  .hm-header-inner{height:90px;max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;gap:20px;padding:0 16px}
  .hm-logo img{height:80px}
  .hm-nav{display:flex;gap:20px;align-items:center;flex-wrap:wrap}
  .hm-nav a{font-weight:700}
  .hm-nav .cta{font-weight:900;padding:10px 18px;border-radius:999px;background:var(--hm-cta);color:#fff;border:1px solid #000}

  /* Layout */
  .wrap{max-width:1200px;margin:26px auto 48px;padding:0 16px;display:grid;grid-template-columns:1.15fr .85fr;gap:22px}
  @media (max-width:980px){.wrap{grid-template-columns:1fr}}
  .card{
    background:rgba(255,255,255,.92); backdrop-filter:saturate(115%) blur(4px);
    border:1px solid rgba(0,0,0,.08); border-radius:18px; box-shadow:var(--hm-shadow)
  }
  .card h2{margin:0;padding:16px 18px;border-bottom:1px solid rgba(0,0,0,.12)}
  .card-body{padding:18px}

  /* Sections */
  .section{border:var(--hm-border);border-radius:14px;padding:16px;margin-bottom:16px;background:#fff}
  .section-title{display:flex;align-items:center;justify-content:space-between;margin:0 0 12px 0;font-weight:800}
  .field{display:flex;flex-direction:column;gap:8px;margin-top:8px}
  .label{font-weight:700}
  .hint{font-size:12px;color:var(--hm-muted)}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:14px}
  @media (max-width:640px){.row{grid-template-columns:1fr}}
  .input, .select, textarea{padding:12px 14px;border:var(--hm-border);border-radius:12px;font-size:14px;background:#fff}
  textarea{min-height:140px;resize:vertical}

  /* $ prefix input */
  .prefix{position:relative}
  .prefix .prefix-tag{position:absolute;inset:0 auto 0 10px;display:flex;align-items:center;color:#6b7280}
  .prefix input{padding-left:30px}

  /* Uploader */
  .uploader{border:2px dashed rgba(0,0,0,.15);border-radius:14px;padding:18px;text-align:center;background:#fafafa}
  .uploader.drag{background:#f1f7f3;border-color:var(--hm-hunter)}
  .uploader input[type=file]{display:none}
  .thumbs{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:10px;margin-top:12px}
  .t{position:relative;border:var(--hm-border);border-radius:12px;overflow:hidden;background:#fff}
  .t img{width:100%;height:120px;object-fit:cover}
  .t .remove{position:absolute;top:6px;right:6px;background:#fff;border:var(--hm-border);border-radius:999px;width:28px;height:28px;display:flex;align-items:center;justify-content:center;cursor:pointer}

  /* Color chips */
  .chips{display:grid;grid-template-columns:repeat(6,minmax(0,1fr));gap:10px}
  @media (max-width:900px){.chips{grid-template-columns:repeat(4,minmax(0,1fr))}}
  @media (max-width:600px){.chips{grid-template-columns:repeat(3,minmax(0,1fr))}}
  .chip{display:flex;align-items:center;gap:8px;border:var(--hm-border);border-radius:999px;padding:8px 12px;cursor:pointer;user-select:none;background:#fff}
  .chip input{appearance:none;width:0;height:0;position:absolute;pointer-events:none}
  .chip .dot{flex:0 0 16px;width:16px;height:16px;border-radius:50%;border:1px solid rgba(0,0,0,.15);display:inline-block}
  .chip.active{outline:3px solid rgba(53,94,59,.18);box-shadow:0 0 0 2px rgba(0,0,0,.05) inset}
  .dot.black{background:#000} .dot.white{background:#fff}
  .dot.grey{background:#a1a1a1} .dot.cream{background:#f6f3e9}
  .dot.brown{background:#8a5a44} .dot.pink{background:#f6b6c6}
  .dot.red{background:#e21e2d} .dot.orange{background:#f59e0b}
  .dot.yellow{background:#f5d142} .dot.green{background:#2f8f2f}
  .dot.navy{background:#1b2a4a} .dot.blue{background:#2563eb}
  .dot.purple{background:#6d28d9}
  .dot.silver{background:linear-gradient(145deg,#bbb,#eee)}
  .dot.gold{background:linear-gradient(145deg,#d6b25e,#f7e7a2)}

  .actions{display:flex;gap:10px;justify-content:flex-end;margin-top:14px;flex-wrap:wrap}
  .btn{border:var(--hm-border);background:#fff;border-radius:12px;padding:12px 16px;font-weight:700;cursor:pointer}
  .btn-primary{background:var(--hm-cta);color:#fff;border-color:#000}
  .btn-primary[disabled]{opacity:.6;cursor:not-allowed}

  .preview .thumb{width:100%;height:200px;border-radius:12px;background:linear-gradient(0deg,#e9e9e9,#f5f5f5)}
  .meta{color:var(--hm-muted);font-size:13px}
  .price{font-weight:800}

  /* ‚úÖ Inline error components */
  .error-summary{
    display:none; margin-bottom:14px; border-radius:14px;
    background:var(--hm-error-bg); border:2px solid var(--hm-error-border);
    color:var(--hm-error-text); padding:12px 14px; font-weight:800;
  }
  .error-summary.show{display:block}
  .error-list{margin:8px 0 0 18px; color:var(--hm-error-text)}
  .error-msg{
    display:none; margin-top:6px; border-radius:10px;
    background:var(--hm-error-bg); border:1px solid var(--hm-error-border);
    color:var(--hm-error-text); padding:8px 10px; font-weight:700; font-size:13px;
  }
  .error .input, .error .select, .error textarea{
    border-color: var(--hm-error-border); outline: 3px solid rgba(255, 0, 66, .15);
  }
  .good .input, .good .select, .good textarea{
    outline: 3px solid rgba(34, 197, 94, .15);
  }
</style>
</head>
<body>

<header class="hm-header">
  <div class="hm-header-inner">
    <a class="hm-logo" href="/" aria-label="Hemline Market home">
      <img src="/logo.png" alt="Hemline Market logo" onerror="this.style.display='none'">
    </a>
    <nav class="hm-nav" aria-label="Primary">
      <a href="/new">New Arrivals</a>
      <a href="/atelier">My Atelier</a>
      <a href="/favorites" aria-label="Favorites">‚ù§ Favorites</a>
      <a href="/notifications" aria-label="Notifications">üîî Notifications</a>
      <a href="/account">My Account</a>
      <a class="cta" href="/list">List Item</a>
    </nav>
  </div>
</header>

<main class="wrap">
  <!-- FORM -->
  <section class="card" aria-label="List item form">
    <h2>List an Item</h2>
    <div class="card-body">
      <!-- ‚úÖ friendly error summary -->
      <div id="errorSummary" class="error-summary" role="alert" aria-live="assertive" tabindex="-1">
        Let‚Äôs fix a few things:
        <ul id="errorList" class="error-list"></ul>
      </div>

      <form id="sell-form" novalidate aria-describedby="formHelp">
        <p id="formHelp" class="hint">Fields marked required must be completed before publishing.</p>

        <!-- Images -->
        <div class="section" id="sec-images" aria-labelledby="imagesTitle">
          <h3 class="section-title" id="imagesTitle">Images</h3>
          <div class="hint" id="imagesHint" style="margin-bottom:10px">
            Please include at least three photos: <strong>one close-up</strong>, <strong>one folded</strong>, and <strong>one drape</strong>. Place a <strong>ruler in-frame</strong> in at least one photo (you can <a href="/ruler.svg" download>print this ruler</a>).
          </div>
          <div id="uploader" class="uploader" role="region" aria-label="Image uploader" aria-describedby="imagesHint">
            <input id="files" type="file" accept="image/*" multiple aria-label="Choose images to upload">
            <div>Drag & drop images here or</div>
            <button type="button" class="btn" id="pickFiles" aria-label="Pick images">Choose Images</button>
          </div>
          <div id="thumbs" class="thumbs" role="list" aria-label="Selected images"></div>
          <div id="err-images" class="error-msg" role="alert">Add at least 3 photos.</div>
        </div>

        <!-- Description -->
        <div class="section" id="sec-desc" aria-labelledby="descTitle">
          <h3 class="section-title" id="descTitle">Description</h3>
          <div class="field" id="fld-desc">
            <label class="label" for="description">Details</label>
            <textarea id="description" class="input" placeholder="Mention drape, structure/hand, weave, care, defects, stretch, finish, end-use, etc." aria-describedby="descHint"></textarea>
            <div id="descHint" class="hint">Examples: ‚Äúfluid drape‚Äù, ‚Äúlight structure‚Äù, ‚Äúhand-wash cold‚Äù, ‚Äútiny pull near selvage‚Äù.</div>
            <div id="err-desc" class="error-msg" role="alert">Add a brief description (a sentence or two).</div>
          </div>
          <div class="field" id="fld-title" style="margin-top:12px">
            <label class="label" for="title">Title <span class="hint">(required)</span></label>
            <input id="title" class="input" placeholder="e.g., Italian Silk Twill ‚Äî Navy Chain" required aria-required="true">
            <div id="err-title" class="error-msg" role="alert">Please add a title.</div>
          </div>
        </div>

        <!-- Price & Availability -->
        <div class="section" id="sec-price" aria-labelledby="priceTitle">
          <h3 class="section-title" id="priceTitle">Price & Availability</h3>
          <div class="row">
            <div class="field" id="fld-price">
              <label class="label" for="pricePerYd">Price (per yard) <span class="hint">(required)</span></label>
              <div class="prefix">
                <span class="prefix-tag" aria-hidden="true">$</span>
                <input id="pricePerYd" type="number" min="0" step="0.01" class="input" placeholder="e.g., 48" required aria-required="true" aria-describedby="priceHint">
              </div>
              <div id="priceHint" class="hint">Charged per yard.</div>
              <div id="err-price" class="error-msg" role="alert">Enter a valid price (0 or higher).</div>
            </div>
            <div class="field" id="fld-yards">
              <label class="label" for="yardsSelect">Yards Available <span class="hint">(0.5 increments, required)</span></label>
              <select id="yardsSelect" class="select" aria-required="true" aria-describedby="yardsHint"></select>
              <input type="hidden" id="yards" aria-hidden="true">
              <div id="yardsHint" class="hint">Choose total yardage you‚Äôre listing.</div>
              <div id="err-yards" class="error-msg" role="alert">Choose at least 0.5 yards.</div>
            </div>
          </div>
          <fieldset class="field" style="margin-top:12px">
            <legend class="label">Selling Mode</legend>
            <label><input type="radio" name="sellingMode" value="lot" checked> Sell all yardage together as one lot</label>
            <label style="margin-top:6px"><input type="radio" name="sellingMode" value="increments"> Sell in 0.5 yard increments (buyer chooses quantity)</label>
          </fieldset>
        </div>

        <!-- Specs -->
        <div class="section" id="sec-specs" aria-labelledby="specsTitle">
          <h3 class="section-title" id="specsTitle">Specs</h3>
          <div class="row">
            <div class="field" id="fld-width">
              <label class="label" for="widthIn">Width (inches)</label>
              <input id="widthIn" type="number" min="1" step="0.1" class="input" placeholder="e.g., 54" aria-describedby="widthHelp">
              <div class="hint" id="widthHelp"><label><input type="checkbox" id="widthUnknown"> Unknown</label></div>
            </div>
            <div class="field" id="fld-weight">
              <label class="label" for="weightGsm">Weight (GSM)</label>
              <input id="weightGsm" type="number" min="0" step="1" class="input" placeholder="e.g., 95" aria-describedby="weightHelp">
              <div class="hint" id="weightHelp"><label><input type="checkbox" id="weightUnknown"> Unknown</label></div>
            </div>
          </div>

          <div class="row" style="margin-top:12px">
            <fieldset class="field">
              <legend class="label">Department</legend>
              <div class="hint">Select at least one or mark Unknown</div>
              <div style="display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:8px;margin-top:6px" role="group" aria-label="Department">
                <label><input type="checkbox" name="department" value="fashion"> Fashion</label>
                <label><input type="checkbox" name="department" value="home"> Home</label>
                <label><input type="checkbox" name="department" value="quilting"> Quilting</label>
                <label><input type="checkbox" name="department" value="notions"> Notions</label>
                <label><input type="checkbox" name="department" value="unknown"> Unknown</label>
              </div>
            </fieldset>
            <fieldset class="field">
              <legend class="label">Country Made</legend>
              <div style="display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:8px;margin-top:6px" role="group" aria-label="Country made">
                <label><input type="checkbox" name="country" value="france"> France</label>
                <label><input type="checkbox" name="country" value="italy"> Italy</label>
                <label><input type="checkbox" name="country" value="japan"> Japan</label>
                <label><input type="checkbox" name="country" value="uk"> UK</label>
                <label><input type="checkbox" name="country" value="usa"> USA</label>
                <label><input type="checkbox" name="country" value="other"> Other</label>
                <label><input type="checkbox" name="country" value="unknown"> Unknown</label>
              </div>
            </fieldset>
          </div>

          <!-- Designer (optional) -->
          <div class="field" style="margin-top:12px">
            <label class="label" for="designer">Designer / Brand <span class="hint">(optional)</span></label>
            <input id="designer" class="input" placeholder="e.g., Loro Piana, Liberty, deadstock mill‚Ä¶" aria-describedby="designerHelp">
            <div id="designerHelp" class="hint">If unknown, leave blank.</div>
          </div>

          <!-- Content -->
          <fieldset class="field" style="margin-top:12px">
            <legend class="label">Fabric Content (multi-select)</legend>
            <div class="hint">Choose all that apply (Unknown and Other supported)</div>
            <div style="display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:8px;max-height:260px;overflow:auto;margin-top:6px" id="content-list" role="group" aria-label="Fabric content">
              <label><input type="checkbox" id="contentUnknown" value="unknown"> Unknown</label>
              <label><input type="checkbox" value="acetate"> Acetate</label>
              <label><input type="checkbox" value="acrylic"> Acrylic</label>
              <label><input type="checkbox" value="alpaca"> Alpaca</label>
              <label><input type="checkbox" value="bamboo"> Bamboo</label>
              <label><input type="checkbox" value="cashmere"> Cashmere</label>
              <label><input type="checkbox" value="cotton"> Cotton</label>
              <label><input type="checkbox" value="cupro"> Cupro</label>
              <label><input type="checkbox" value="elastane"> Elastane/Spandex</label>
              <label><input type="checkbox" value="hemp"> Hemp</label>
              <label><input type="checkbox" value="leather"> Leather</label>
              <label><input type="checkbox" value="linen"> Linen</label>
              <label><input type="checkbox" value="modal"> Modal</label>
              <label><input type="checkbox" value="mohair"> Mohair</label>
              <label><input type="checkbox" value="nylon"> Nylon</label>
              <label><input type="checkbox" value="polyamide"> Polyamide</label>
              <label><input type="checkbox" value="polyester"> Polyester</label>
              <label><input type="checkbox" value="polyurethane"> Polyurethane</label>
              <label><input type="checkbox" value="rayon"> Rayon/Viscose</label>
              <label><input type="checkbox" value="silk"> Silk</label>
              <label><input type="checkbox" value="tencel"> Tencel</label>
              <label><input type="checkbox" value="triacetate"> Triacetate</label>
              <label><input type="checkbox" value="wool"> Wool</label>
            </div>
            <div class="row" style="margin-top:6px">
              <div class="field">
                <label class="label" for="contentOther">Other (content)</label>
                <input class="input" id="contentOther" placeholder="e.g., ramie blend">
              </div>
            </div>
          </fieldset>

          <!-- Type -->
          <fieldset class="field" style="margin-top:12px">
            <legend class="label">Fabric Type (multi-select)</legend>
            <div style="display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:8px;max-height:260px;overflow:auto;margin-top:6px" id="type-list" role="group" aria-label="Fabric type">
              <label><input type="checkbox" id="typeUnknown" value="unknown"> Unknown</label>
              <label><input type="checkbox" value="boucle"> Boucl√©</label>
              <label><input type="checkbox" value="canvas"> Canvas</label>
              <label><input type="checkbox" value="chiffon"> Chiffon</label>
              <label><input type="checkbox" value="corduroy"> Corduroy</label>
              <label><input type="checkbox" value="crepe"> Crepe</label>
              <label><input type="checkbox" value="denim"> Denim</label>
              <label><input type="checkbox" value="gabardine"> Gabardine</label>
              <label><input type="checkbox" value="georgette"> Georgette</label>
              <label><input type="checkbox" value="jersey"> Jersey</label>
              <label><input type="checkbox" value="lace"> Lace</label>
              <label><input type="checkbox" value="leather"> Leather</label>
              <label><input type="checkbox" value="organza"> Organza</label>
              <label><input type="checkbox" value="poplin"> Poplin</label>
              <label><input type="checkbox" value="sateen"> Sateen</label>
              <label><input type="checkbox" value="satin"> Satin</label>
              <label><input type="checkbox" value="tulle"> Tulle</label>
              <label><input type="checkbox" value="tweed"> Tweed</label>
              <label><input type="checkbox" value="twill"> Twill</label>
              <label><input type="checkbox" value="velvet"> Velvet</label>
              <label><input type="checkbox" value="voile"> Voile</label>
            </div>
            <div class="row" style="margin-top:6px">
              <div class="field">
                <label class="label" for="typeOther">Other (type)</label>
                <input class="input" id="typeOther" placeholder="e.g., ottoman weave">
              </div>
            </div>
          </fieldset>

          <!-- Color -->
          <div class="section" aria-labelledby="colorTitle">
            <h3 class="section-title" id="colorTitle">Color</h3>
            <div class="chips" id="color-chips" role="group" aria-label="Color">
              <label class="chip"><input type="checkbox" value="unknown"><span>Unknown</span></label>
              <label class="chip"><input type="checkbox" value="black"><span class="dot black"></span><span>Black</span></label>
              <label class="chip"><input type="checkbox" value="white"><span class="dot white"></span><span>White</span></label>
              <label class="chip"><input type="checkbox" value="grey"><span class="dot grey"></span><span>Grey</span></label>
              <label class="chip"><input type="checkbox" value="cream"><span class="dot cream"></span><span>Cream</span></label>
              <label class="chip"><input type="checkbox" value="brown"><span class="dot brown"></span><span>Brown</span></label>
              <label class="chip"><input type="checkbox" value="pink"><span class="dot pink"></span><span>Pink</span></label>
              <label class="chip"><input type="checkbox" value="red"><span class="dot red"></span><span>Red</span></label>
              <label class="chip"><input type="checkbox" value="orange"><span class="dot orange"></span><span>Orange</span></label>
              <label class="chip"><input type="checkbox" value="yellow"><span class="dot yellow"></span><span>Yellow</span></label>
              <label class="chip"><input type="checkbox" value="green"><span class="dot green"></span><span>Green</span></label>
              <label class="chip"><input type="checkbox" value="navy"><span class="dot navy"></span><span>Navy</span></label>
              <label class="chip"><input type="checkbox" value="blue"><span class="dot blue"></span><span>Blue</span></label>
              <label class="chip"><input type="checkbox" value="purple"><span class="dot purple"></span><span>Purple</span></label>
              <label class="chip"><input type="checkbox" value="silver"><span class="dot silver"></span><span>Silver</span></label>
              <label class="chip"><input type="checkbox" value="gold"><span class="dot gold"></span><span>Gold</span></label>
            </div>
          </div>

          <div class="actions" aria-label="Form actions">
            <button type="button" class="btn" id="preview-btn">Preview</button>
            <button type="submit" class="btn btn-primary" id="publish-btn" disabled aria-disabled="true">Publish Listing</button>
          </div>
        </div>
      </form>
    </div>
  </section>

  <!-- PREVIEW -->
  <aside class="card preview" aria-label="Listing preview">
    <h2>Preview</h2>
    <div class="card-body">
      <div class="thumb" id="preview-thumb" role="img" aria-label="Preview image"></div>
      <h3 id="p-title" style="margin:12px 0 6px">Your Title</h3>
      <div class="meta" id="p-meta">0 yd ‚Ä¢ 0‚Ä≥ ‚Ä¢ ‚Äî</div>
      <div class="price" id="p-price">$0 / yd</div>
      <div class="meta" id="p-tags" style="margin-top:6px"></div>
      <p class="meta" id="p-desc" style="margin-top:8px"></p>
    </div>
  </aside>
</main>

<script>
(function(){
  const $=(s,r=document)=>r.querySelector(s);
  const $$=(s,r=document)=>Array.from(r.querySelectorAll(s));

  // 0.5-step yards
  const yardsSelect = $('#yardsSelect'); const yardsHidden = $('#yards');
  if (yardsSelect) {
    const frag = document.createDocumentFragment();
    for (let v=0.5; v<=100; v+=0.5){ const o=document.createElement('option'); o.value=v.toFixed(1); o.textContent=v.toFixed(1); frag.appendChild(o); }
    yardsSelect.appendChild(frag); yardsSelect.value='0.5'; yardsHidden.value='0.5';
    yardsSelect.addEventListener('change',()=>yardsHidden.value=yardsSelect.value);
  }

  // Unknown toggles lock others
  function wireUnknown(id, containerSel){
    const unk=$(id); if(!unk) return;
    unk.addEventListener('change',()=>{
      $$(containerSel+' input[type="checkbox"]').forEach(cb=>{ if(cb!==unk){cb.disabled=unk.checked; if(unk.checked) cb.checked=false;} });
    });
  }
  $('#widthUnknown')?.addEventListener('change',e=>{const i=$('#widthIn'); i.disabled=e.target.checked; if(e.target.checked) i.value='';});
  $('#weightUnknown')?.addEventListener('change',e=>{const i=$('#weightGsm'); i.disabled=e.target.checked; if(e.target.checked) i.value='';});
  wireUnknown('#contentUnknown','#content-list');
  wireUnknown('#typeUnknown','#type-list');

  // Uploader
  const uploader=$('#uploader'); const fileInput=$('#files'); const pickBtn=$('#pickFiles'); const thumbs=$('#thumbs'); let images=[];
  pickBtn?.addEventListener('click',()=>fileInput?.click());
  fileInput?.addEventListener('change',e=>addFiles(e.target.files));
  ['dragenter','dragover'].forEach(ev=>uploader?.addEventListener(ev,e=>{e.preventDefault();uploader.classList.add('drag');}));
  ['dragleave','drop'].forEach(ev=>uploader?.addEventListener(ev,e=>{e.preventDefault();uploader.classList.remove('drag');}));
  uploader?.addEventListener('drop',e=>addFiles(e.dataTransfer.files));
  function addFiles(list){ Array.from(list||[]).slice(0,12).forEach(f=>{const url=URL.createObjectURL(f); images.push({url});}); renderThumbs(); updatePreview(); validate(); }
  function renderThumbs(){
    thumbs.innerHTML=''; images.forEach((img,idx)=>{ const t=document.createElement('div'); t.className='t';
      const im=document.createElement('img'); im.src=img.url; const rm=document.createElement('button'); rm.className='remove'; rm.type='button'; rm.setAttribute('aria-label','Remove image'); rm.textContent='√ó';
      rm.addEventListener('click',()=>{images.splice(idx,1); renderThumbs(); updatePreview(); validate();}); t.appendChild(im); t.appendChild(rm); thumbs.appendChild(t);
    });
  }

  // Color chips visual active state
  $('#color-chips')?.addEventListener('change',(e)=>{
    const chip = e.target.closest('.chip'); if(!chip) return;
    chip.classList.toggle('active', e.target.checked);
  });
  $$('#color-chips input[type="checkbox"]').forEach(cb=>{
    const chip = cb.closest('.chip'); if (chip) chip.classList.toggle('active', cb.checked);
  });

  function values(){
    const v={};
    v.title=$('#title')?.value?.trim()||'';
    v.pricePerYd=Number($('#pricePerYd')?.value||0);
    v.yards=Number($('#yards')?.value||0.5);
    v.widthIn=Number($('#widthIn')?.value||0);
    v.weightGsm=Number($('#weightGsm')?.value||0);
    v.department=$$('input[name="department"]:checked').map(i=>i.value);
    v.country=$$('input[name="country"]:checked').map(i=>i.value);
    v.content=$$('#content-list input[type="checkbox"]:checked').map(i=>i.value);
    v.type=$$('#type-list input[type="checkbox"]:checked').map(i=>i.value);
    v.colors=$$('#color-chips input[type="checkbox"]:checked').map(i=>i.value);
    v.sellingMode=$('input[name="sellingMode"]:checked')?.value||'lot';
    v.desc=$('#description')?.value?.trim()||'';
    v.images=images.map(m=>m.url);
    v.contentOther=$('#contentOther')?.value?.trim()||'';
    v.typeOther=$('#typeOther')?.value?.trim()||'';
    v.designer=$('#designer')?.value?.trim()||'';
    return v;
  }

  function updatePreview(){
    const v=values();
    $('#p-title').textContent=v.title||'Your Title';
    $('#p-meta').textContent=`${v.yards||0} yd ‚Ä¢ ${v.widthIn||0}‚Ä≥ ‚Ä¢ ${(v.country[0]||'‚Äî').toUpperCase()}`;
    $('#p-price').textContent=`$${v.pricePerYd||0} / yd`;
    const extra = v.designer ? `Designer: ${v.designer}` : '';
    $('#p-tags').textContent=[v.type.join(', '), v.content.join(', '), v.colors.join(', '), extra, v.sellingMode==='increments'?'0.5 yd increments':'sold as one lot'].filter(Boolean).join(' ‚Ä¢ ');
    $('#p-desc').textContent=v.desc||'';
    const th=$('#preview-thumb');
    if(v.images?.length){ th.style.background=`url('${v.images[0]}') center/cover no-repeat`; th.setAttribute('aria-label','Preview image from the first uploaded photo'); }
    else { th.style.background='linear-gradient(0deg,#e9e9e9,#f5f5f5)'; th.setAttribute('aria-label','Preview placeholder'); }
  }

  // ‚úÖ Inline errors
  const fields = {
    images: {section:'#sec-images', err:'#err-images', valid:()=>images.length>=3, msg:'Add at least 3 photos (close-up, folded, drape).'},
    title:  {section:'#fld-title', err:'#err-title',  valid:()=>$('#title').value.trim().length>0, msg:'Please add a title.'},
    price:  {section:'#fld-price', err:'#err-price',  valid:()=>!isNaN(Number($('#pricePerYd').value)) && Number($('#pricePerYd').value)>=0, msg:'Enter a valid price (0 or higher).'},
    yards:  {section:'#fld-yards', err:'#err-yards',  valid:()=>Number($('#yards').value)>=0.5, msg:'Choose at least 0.5 yards.'}
  };

  function showFieldError(key, on){
    const cfg = fields[key];
    const sec = document.querySelector(cfg.section); const em = document.querySelector(cfg.err);
    if(!sec||!em) return;
    sec.classList.toggle('error', on);
    sec.classList.toggle('good', !on);
    em.style.display = on ? 'block' : 'none';
  }

  function validate(){
    const v=values(); // ensures hidden yards synced
    const failed = Object.keys(fields).filter(k=>!fields[k].valid());
    Object.keys(fields).forEach(k=>showFieldError(k, failed.includes(k)));

    const sum = $('#errorSummary'); const list = $('#errorList');
    if(failed.length){
      list.innerHTML = failed.map(k=>`<li>${fields[k].msg}</li>`).join('');
      sum.classList.add('show'); sum.setAttribute('tabindex','-1'); sum.focus();
    } else {
      sum.classList.remove('show');
      list.innerHTML = '';
    }

    $('#publish-btn').disabled = failed.length>0;
    $('#publish-btn').setAttribute('aria-disabled', String(failed.length>0));
    return failed.length===0;
  }

  // Events
  $('#sell-form')?.addEventListener('input',()=>{updatePreview(); validate();});
  $('#preview-btn')?.addEventListener('click',()=>{updatePreview(); validate();});
  $('#sell-form')?.addEventListener('submit',e=>{
    e.preventDefault(); updatePreview();
    if(!validate()) return;
    const v=values();
    const payload={ ...v, content:[...v.content, ...(v.contentOther?[v.contentOther]:[])], type:[...v.type, ...(v.typeOther?[v.typeOther]:[])] };
    console.log('SELLER_PAYLOAD', payload);
    alert('‚úÖ Listing looks good. (Demo) Check console for payload.');
  });

  // init
  updatePreview(); validate();
})();
</script>

</body>
</html>
