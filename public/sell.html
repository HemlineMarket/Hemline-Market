<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Hemline Market — List an Item</title>
<style>
  :root{--border:#e5e7eb;--ink:#111827;--muted:#6b7280;--brand:#111827}
  *{box-sizing:border-box}
  body{font:14px/1.5 system-ui,-apple-system,Segoe UI,Inter,Roboto,sans-serif;margin:0;color:var(--ink);background:#fff}
  /* NAV (shared) */
  .nav{position:sticky;top:0;z-index:20;background:#fff;border-bottom:1px solid var(--border)}
  .nav-inner{max-width:1100px;margin:0 auto;padding:10px 16px;display:flex;gap:10px;align-items:center}
  .brand{font-weight:800;text-decoration:none;color:var(--ink);font-size:18px}
  .nav-search{flex:1}
  .nav-search input{width:100%;padding:9px 12px;border:1px solid var(--border);border-radius:999px}
  .btn{padding:8px 12px;border:1px solid var(--border);border-radius:999px;background:#fff;text-decoration:none;color:var(--ink)}
  .btn:hover{background:#f3f4f6}
  .btn.primary{background:var(--brand);border-color:var(--brand);color:#fff}

  .wrap{max-width:760px;margin:24px auto;padding:0 16px}
  h1{font-size:22px;font-weight:800;margin:0 0 18px}
  form{display:grid;grid-template-columns:1fr;gap:16px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  label{font-weight:600;margin-bottom:6px;display:block}
  .muted{color:var(--muted);font-weight:500}
  input,select,textarea{width:100%;padding:10px;border:1px solid var(--border);border-radius:10px}
  textarea{min-height:90px}
  .field{display:flex;flex-direction:column}
  .hint{color:var(--muted);font-size:12px;margin-top:6px}
  .chips{display:flex;gap:8px;flex-wrap:wrap}
  .chip{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid var(--border);border-radius:999px;cursor:pointer}
  .chip input{appearance:none;width:14px;height:14px;border-radius:999px;border:1px solid var(--border)}
  .chip input:checked{background:#111827;border-color:#111827}
  .actions{display:flex;gap:10px}
  button{padding:12px 14px;border:1px solid var(--border);border-radius:10px;background:#fff;cursor:pointer;font-weight:700}
  .primary{background:#111827;border-color:#111827;color:#fff}
  .toast{position:fixed;inset:auto 16px 16px auto;background:#111827;color:#fff;padding:10px 12px;border-radius:10px;box-shadow:0 10px 24px rgba(0,0,0,.15);display:none}
</style>
</head>
<body>

<!-- Shared header -->
<div class="nav">
  <div class="nav-inner">
    <a class="brand" href="/index.html">hemlinemarket</a>
    <div class="nav-search"><input placeholder="Search fabrics…" onkeydown="if(event.key==='Enter'){location.href='/catalog.html?q='+encodeURIComponent(this.value)}"></div>
    <a class="btn" href="/catalog.html">Browse</a>
    <a class="btn" href="/favorites.html">Likes</a>
    <a class="btn" href="/news.html">News</a>
    <a class="btn" href="/profile.html">Profile</a>
    <a class="btn primary" href="/sell.html">List an item</a>
  </div>
</div>

<div class="wrap">
  <h1>List a Fabric</h1>

  <form id="sellForm">
    <div class="field">
      <label>Title</label>
      <input id="title" required placeholder="e.g. Italian Wool Crepe">
    </div>

    <div class="field">
      <label>Description <span class="muted">(optional)</span></label>
      <textarea id="description" placeholder="Notes about hand-feel, intended use, flaws, etc."></textarea>
    </div>

    <div class="row">
      <div class="field">
        <label>Fabric Type</label>
        <select id="fabric_type" required></select>
      </div>
      <div class="field">
        <label>Color</label>
        <select id="color" required></select>
      </div>
    </div>

    <div class="row">
      <div class="field">
        <label>Condition</label>
        <select id="condition" required>
          <option value="unknown">unknown</option>
          <option value="new">New</option>
          <option value="washed">Washed (pre-shrunk)</option>
          <option value="used">Used</option>
          <option value="vintage">Vintage</option>
        </select>
      </div>
      <div class="field">
        <label>Department</label>
        <select id="department" required>
          <option value="unknown">unknown</option>
          <option value="fashion">Fashion fabric</option>
          <option value="quilting">Quilting fabric</option>
          <option value="home">Home fabric</option>
          <option value="notions">Notions</option>
        </select>
      </div>
    </div>

    <div class="row">
      <div class="field">
        <label>Country of Origin</label>
        <select id="country">
          <option>unknown</option>
          <option>China</option><option>France</option><option>India</option>
          <option>Italy</option><option>Japan</option><option>Turkey</option><option>USA</option>
          <option>Other</option>
        </select>
      </div>
      <div class="field">
        <label>Designer <span class="muted">(optional)</span></label>
        <input id="designer" placeholder="e.g. Liberty, Mood, Joann">
      </div>
    </div>

    <div class="row">
      <div class="field">
        <label>Price (USD)</label>
        <input id="price" type="number" min="0" step="0.01" required>
      </div>
      <div class="field">
        <label>Price is for how many yards?</label>
        <input id="price_unit_yards" type="number" min="1" step="1" value="1" required oninput="updateOriginalLabel()">
      </div>
    </div>
    <div class="row">
      <div class="field">
        <label id="origLabel">Original Price (USD) <span class="muted">(optional; same yards)</span></label>
        <input id="original_price" type="number" min="0" step="0.01" placeholder="Retail or pre-discount price">
      </div>
      <div class="field">
        <label>Yards Available</label>
        <input id="yards" type="number" min="0" step="0.25" required>
      </div>
    </div>

    <div class="row">
      <div class="field">
        <label>Drapiness</label>
        <select id="drapiness">
          <option value="unknown">unknown</option>
          <option>fluid</option><option>moderate</option><option>crisp</option>
        </select>
      </div>
      <div class="field">
        <label>Visual Finish</label>
        <select id="visual_finish">
          <option value="unknown">unknown</option>
          <option>matte</option><option>semi-gloss</option><option>glossy</option>
        </select>
      </div>
    </div>

    <div class="row">
      <div class="field">
        <label>Texture / Hand</label>
        <select id="texture">
          <option value="unknown">unknown</option>
          <option>smooth</option><option>soft</option><option>brushed</option>
          <option>slub</option><option>nubby</option><option>pebbled</option>
        </select>
      </div>
      <div class="field">
        <label>Fabric Structure (construction)</label>
        <select id="fabric_structure">
          <option value="unknown">unknown</option>
          <option>plain weave</option><option>twill</option><option>satin</option>
          <option>rib knit</option><option>jersey knit</option><option>canvas</option>
          <option>lace</option><option>crepe</option>
        </select>
      </div>
    </div>

    <div class="row">
      <div class="field">
        <label>Transparency</label>
        <select id="transparency">
          <option value="unknown">unknown</option>
          <option>opaque</option><option>semi-sheer</option><option>sheer</option>
        </select>
      </div>
      <div class="field">
        <label>Images (URLs) <span class="muted">(comma-separated)</span></label>
        <input id="images" placeholder="https://... , https://...">
        <div class="hint">Tip: add multiple images separated by commas. Storage upload can come later.</div>
      </div>
    </div>

    <div class="field">
      <label>Certifications <span class="muted">(optional)</span></label>
      <div id="certWrap" class="chips"></div>
    </div>

    <div class="actions">
      <button type="button" id="resetBtn">Reset</button>
      <button class="primary" type="submit">Save Fabric</button>
    </div>
  </form>
</div>

<div class="toast" id="toast">Saved!</div>

<script type="module">
  import { createClient } from "https://esm.sh/@supabase/supabase-js@2.45.3";
  const supabase = createClient(
    "https://clkizksbvxjkoatdajgd.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNsa2l6a3Nidnhqa29hdGRhamdkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2ODAyMDUsImV4cCI6MjA3MDI1NjIwNX0.m3wd6UAuqxa7BpcQof9mmzd8zdsmadwGDO0x7-nyBjI"
  );

  // enums (include 'unknown')
  const FABRICS=['unknown','cotton','wool','silk','linen','denim','chiffon','crepe','jersey','satin','twill','canvas','lace','velvet','rayon','viscose','modal','tencel','lyocell','polyester','nylon','acrylic','other'];
  const COLORS=['unknown','beige','black','blue','brown','gray','green','orange','pink','purple','red','white','yellow'];
  const CERTS=['OEKO-TEX','GOTS','BCI','RWS','GRS'];

  // Populate selects
  const addOpts=(sel,arr)=>arr.sort((a,b)=>a.localeCompare(b)).forEach(v=>{const o=document.createElement('option');o.value=v;o.textContent=v;sel.appendChild(o);});
  addOpts(document.getElementById('fabric_type'),FABRICS);
  addOpts(document.getElementById('color'),COLORS);

  // Certifications chips
  const certState=new Set(), certWrap=document.getElementById('certWrap');
  CERTS.forEach(c=>{const lbl=document.createElement('label');lbl.className='chip';
    lbl.innerHTML=`<input type="checkbox"><span>${c}</span>`;
    const cb=lbl.querySelector('input');cb.onchange=()=>{cb.checked?certState.add(c):certState.delete(c)};certWrap.appendChild(lbl);
  });

  const el=id=>document.getElementById(id);
  window.updateOriginalLabel=function(){
    const n = Number(el('price_unit_yards').value||1);
    el('origLabel').innerHTML = `Original Price (USD) <span class="muted">(optional; for ${Math.max(1,n)} yard${n>1?'s':''})</span>`;
  };
  updateOriginalLabel();

  const toast=msg=>{const t=el('toast');t.textContent=msg;t.style.display='block';setTimeout(()=>t.style.display='none',1600)};

  el('sellForm').onsubmit=async e=>{
    e.preventDefault();
    const price   = Number(el('price').value||0);
    const priceFor= Math.max(1, Number(el('price_unit_yards').value||1));
    const original= el('original_price').value===''?null:Number(el('original_price').value);

    const payload={
      title: el('title').value.trim(),
      description: el('description').value.trim() || null,
      fabric_content: el('fabric_type').value,
      color_category: el('color').value,
      condition: el('condition').value,
      department: el('department').value,
      country_of_origin: el('country').value,
      designer: el('designer').value.trim() || null,
      price_cents: Math.round(price*100),
      price_unit_yards: priceFor,
      original_price_cents: original==null?null:Math.round(original*100),
      yards_available: Number(el('yards').value||0),
      drapiness: el('drapiness').value,
      visual_finish: el('visual_finish').value,
      texture: el('texture').value,
      fabric_structure: el('fabric_structure').value,
      transparency: el('transparency').value,
      certifications: [...certState],
      images: (el('images').value||'').split(',').map(s=>s.trim()).filter(Boolean),
      created_at: new Date().toISOString()
    };

    if(!payload.title){alert('Title is required');return;}
    if(payload.price_cents<0){alert('Price must be ≥ 0');return;}

    const {error}=await supabase.from('listings').insert([payload]);
    if(error){alert('Error: '+error.message);return;}
    toast('Fabric saved!');
    e.target.reset(); certState.clear(); [...certWrap.querySelectorAll('input[type=checkbox]')].forEach(cb=>cb.checked=false);
    updateOriginalLabel();
  };

  el('resetBtn').onclick=()=>{el('sellForm').reset();certState.clear();[...certWrap.querySelectorAll('input[type=checkbox]')].forEach(cb=>cb.checked=false);updateOriginalLabel()};
</script>
</body>
</html>
