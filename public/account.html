<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Account — Hemline Market</title>

  <!-- Favicon -->
  <link rel="icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16.png">

  <style>
    :root{
      --ink:#111827;
      --muted:#6b7280;
      --border:#e5e7eb;
      --accent:#991b1b;
      --bg:#fafafa;
      --pill:#4c1d95;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background:var(--bg);
      color:var(--ink);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      -webkit-font-smoothing:antialiased;
    }

    /* Header */
    .hm-header{min-height:56px;background:#fff;border-bottom:1px solid var(--border)}
    .hm-wrap{
      max-width:1200px;
      margin:0 auto;
      padding:0 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
    }
    .left{display:flex;align-items:center;gap:10px}
    .hm-brand{font-size:24px;font-weight:800;color:var(--accent);text-decoration:none}
    .hamburger{
      display:inline-grid;place-items:center;
      width:36px;height:36px;
      border:1px solid var(--border);
      border-radius:10px;
      background:#fff;
      color:#374151;
    }
    .hamburger svg{width:22px;height:22px;stroke-width:2}
    .right{display:flex;align-items:center;gap:14px}
    .hm-icon{color:#444;display:inline-grid;place-items:center}
    .hm-icon svg{width:26px;height:26px;stroke-width:2}
    .hm-avatar{
      width:28px;height:28px;
      border-radius:50%;
      border:1px solid var(--border);
      background:#fff;
      color:#334155;
      display:inline-grid;place-items:center;
      font-weight:700;font-size:12px;
      text-decoration:none;
      background-size:cover;
      background-position:center;
      overflow:hidden;
    }
    .hm-btn-primary{
      background:var(--accent);
      color:#fff;
      border:1px solid var(--accent);
      border-radius:999px;
      padding:10px 18px;
      font-weight:700;
      text-decoration:none;
      box-shadow:0 2px 8px rgba(153,27,27,.25);
    }
    .hm-btn-dark{
      background:#111827;
      color:#fff;
      border:1px solid #111827;
      border-radius:999px;
      padding:10px 18px;
      font-weight:700;
      text-decoration:none;
      box-shadow:0 2px 8px rgba(15,23,42,.25);
    }

    @media (max-width:640px){
      .hm-wrap{padding:0 8px}
      .hm-brand{font-size:20px}
    }

    /* Side sheet */
    .sheet{
      position:fixed;
      inset:0 auto 0 0;
      width:min(84vw,340px);
      background:#fff;
      border-right:1px solid var(--border);
      transform:translateX(-100%);
      transition:transform .25s ease;
      z-index:100;
      display:flex;
      flex-direction:column;
    }
    .sheet.open{transform:translateX(0)}
    .sheet header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:10px;
      border-bottom:1px solid var(--border);
    }
    .sheet nav{display:grid;padding:10px}
    .sheet nav a{
      padding:10px;
      border:1px solid var(--border);
      border-radius:10px;
      text-decoration:none;
      color:#1f2937;
    }
    .sheet nav a+a{margin-top:8px}
    .sheet .close{
      display:inline-grid;place-items:center;
      width:30px;height:30px;
      border:1px solid var(--border);
      border-radius:8px;
      background:#fff;
      color:#444;
    }

    /* Page layout */
    .wrap{
      max-width:1100px;
      margin:18px auto 28px;
      padding:0 12px;
    }
    h1{margin:0 0 6px;font-size:28px;font-weight:800}
    .subtle{color:var(--muted);font-size:14px;margin:0 0 16px}

    .grid{
      display:grid;
      grid-template-columns:1.25fr 380px;
      gap:14px;
      align-items:flex-start;
    }
    @media (max-width:1000px){
      .grid{grid-template-columns:1fr}
    }

    .card{
      background:#fff;
      border:1px solid var(--border);
      border-radius:12px;
      box-shadow:0 6px 16px rgba(0,0,0,.06);
      margin-bottom:14px;
    }
    .card .hd{
      padding:12px;
      border-bottom:1px solid var(--border);
      font-weight:800;
    }
    .card .bd{padding:12px}
    .muted{color:var(--muted)}
    .small{font-size:13px}

    /* Profile card */
    .profile-card .bd{
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .profile-main{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }
    .profile-info{
      display:flex;
      align-items:flex-start;
      gap:10px;
    }
    .profile-avatar{
      width:44px;
      height:44px;
      font-size:14px;
    }
    .profile-text div{line-height:1.3}
    .profile-name{font-weight:700}
    .profile-location{font-size:13px}
    .profile-tagline{font-size:13px;margin-top:2px}
    .profile-actions{
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .profile-links{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    .btn{
      padding:8px 14px;
      border:1px solid var(--border);
      border-radius:10px;
      background:#fff;
      font-weight:700;
      cursor:pointer;
      font-size:13px;
    }
    .btn.primary{
      background:var(--accent);
      border-color:var(--accent);
      color:#fff;
      box-shadow:0 2px 8px rgba(153,27,27,.25);
    }
    .btn.small{
      padding:6px 10px;
      font-size:12px;
      border-radius:999px;
    }
    .pill-link{
      border-radius:999px;
      border-color:#e5e7eb;
      color:var(--pill);
      background:#f5f3ff;
    }
    .pill-link:hover{
      background:#ede9fe;
    }

    /* Payouts & shipping */
    .payouts-body{display:flex;flex-direction:column;gap:14px}
    .payouts-body h3{
      margin:0 0 4px;
      font-size:14px;
      font-weight:700;
    }
    .payouts-body p{margin:0 0 6px;font-size:13px}

    .ship-summary{
      border:1px dashed var(--border);
      border-radius:10px;
      padding:10px;
      background:#f9fafb;
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:flex-start;
    }
    .ship-summary-main{
      font-size:13px;
      line-height:1.4;
    }
    .ship-summary-empty{
      font-style:italic;
      color:var(--muted);
    }
    .ship-form{
      margin-top:8px;
      display:grid;
      gap:8px;
    }
    .field{
      display:flex;
      flex-direction:column;
      gap:3px;
      font-size:13px;
    }
    .field label{
      color:#4b5563;
    }
    .field input,
    .field select{
      padding:7px 10px;
      border-radius:8px;
      border:1px solid var(--border);
      font:inherit;
    }
    .field-row{
      display:flex;
      gap:8px;
    }
    .field-row .field{flex:1}
    .status-text{
      font-size:12px;
      color:#16a34a;
      min-height:16px;
      margin-top:2px;
    }

    /* Switch */
    .switch{
      position:relative;
      width:46px;height:26px;
      border-radius:999px;
      background:#e5e7eb;
      border:1px solid var(--border);
      cursor:pointer;
      display:inline-block;
    }
    .switch::after{
      content:'';
      position:absolute;
      top:2px;left:2px;
      width:20px;height:20px;
      border-radius:50%;
      background:#fff;
      box-shadow:0 1px 2px rgba(0,0,0,.2);
      transition:left .2s;
    }
    .switch[data-on="true"]{background:#16a34a;border-color:#16a34a}
    .switch[data-on="true"]::after{left:24px}

    /* Footer */
    .hm-footer{background:#fff;border-top:1px solid var(--border)}
    .footer-wrap{
      max-width:1200px;
      margin:0 auto;
      padding:10px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .footer-links{display:flex;gap:14px;flex-wrap:wrap}
    .copy{color:#6b7280;font-size:14px}

    @media (max-width:640px){
      .wrap{padding:0 8px}
      h1{font-size:24px}
      .profile-main{flex-direction:column;align-items:flex-start}
      .profile-actions{flex-direction:row}
    }

    /* Logged-out message */
    .empty-card{
      padding:14px;
      font-size:14px;
    }
    .empty-card p{margin:0 0 8px}
  </style>
</head>
<body>

<header class="hm-header" role="banner">
  <div class="hm-wrap">
    <div class="left">
      <button id="openMenu" class="hamburger" aria-label="Open menu">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
          <line x1="4" y1="6"  x2="20" y2="6"></line>
          <line x1="4" y1="12" x2="20" y2="12"></line>
          <line x1="4" y1="18" x2="20" y2="18"></line>
        </svg>
      </button>
      <a class="hm-brand" href="index.html">Hemline Market</a>
    </div>
    <div class="right">
      <a class="hm-icon" href="browse.html" aria-label="Browse & search">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="M21 21l-4.3-4.3"></path>
        </svg>
      </a>
      <a class="hm-icon" href="favorites.html" aria-label="Favorites">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 1 0-7.78 7.78L12 21.23l8.84-8.84a5.5 5.5 0 0 0 0-7.78z"></path>
        </svg>
      </a>
      <!-- ThreadTalk icon -->
      <a class="hm-icon" href="ThreadTalk.html" aria-label="ThreadTalk">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M4 5h16v9H7l-3 3z"></path>
        </svg>
      </a>
      <a class="hm-icon" href="notifications.html" aria-label="Notifications">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M18 8a6 6 0 1 0-12 0c0 7-3 7-3 7h18s-3 0-3-7"></path>
          <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
        </svg>
      </a>
      <a class="hm-icon" href="cart.html" aria-label="Cart">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <circle cx="9" cy="21" r="1"></circle>
          <circle cx="18" cy="21" r="1"></circle>
          <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h7.72a2 2 0 0 0 2-1.61L23 6H6"></path>
        </svg>
      </a>
      <!-- Initials circle: hidden by default; JS will show when logged in -->
      <a class="hm-avatar" id="headerAvatar" href="account.html" title="Your account" style="display:none;">AA</a>
      <!-- Log in button links to auth page when logged out -->
      <a id="loginHeaderBtn" class="hm-btn-dark" href="auth.html">Log in</a>
      <a class="hm-btn-primary" href="sell.html">Sell</a>
    </div>
  </div>
</header>

<aside class="sheet" id="menuSheet" aria-hidden="true">
  <header>
    <strong>Menu</strong>
    <button class="close" id="closeMenu" aria-label="Close menu">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </header>
  <nav>
    <a href="browse.html">Browse</a>
    <a href="purchases.html">Purchases</a>
    <a href="sales.html">Sales</a>
    <a href="atelier.html">Your Atelier</a>
    <a href="favorites.html">Favorites</a>
    <a href="sell.html">Sell Fabric</a>
    <a href="help.html">Help</a>
    <a href="contact.html">Contact</a>
  </nav>
</aside>

<main class="wrap" id="maincontent">
  <h1>Account</h1>
  <p class="subtle">Manage your profile, sales, purchases, vacation hold, and payouts.</p>

  <!-- Logged out message -->
  <section id="notSignedIn" class="card" style="display:none;">
    <div class="empty-card">
      <p>You’re not signed in.</p>
      <p><a href="auth.html">Go to the Sign In page</a> to log in to Hemline Market.</p>
    </div>
  </section>

  <!-- Main account content: shown when logged IN -->
  <div class="grid" id="accountGrid" style="display:none">
    <!-- LEFT: Profile -->
    <section class="card profile-card">
      <div class="hd">Profile</div>
      <div class="bd">
        <div class="profile-main">
          <div class="profile-info">
            <span id="profileAvatar" class="hm-avatar profile-avatar">RK</span>
            <div class="profile-text">
              <div id="profileName" class="profile-name">Your name</div>
              <div id="profileEmail" class="muted profile-email">you@example.com</div>
              <div id="profileLocation" class="muted profile-location"></div>
              <div id="profileTagline" class="muted profile-tagline"></div>
            </div>
          </div>
          <div class="profile-actions">
            <button id="editPhotoBtn" class="btn small" type="button">Edit photo</button>
            <button id="editProfileBtn" class="btn small" type="button">Edit profile</button>
            <button id="logoutBtn" class="btn small" type="button">Log out</button>
          </div>
        </div>
        <div class="profile-links">
          <a class="btn pill-link" href="purchases.html">Purchases</a>
          <a class="btn pill-link" href="sales.html">Sales</a>
          <a class="btn pill-link" href="atelier.html">Your Atelier</a>
        </div>
      </div>

      <!-- Hidden file input for profile photo -->
      <input id="photoInput" type="file" accept="image/*" style="display:none">
    </section>

    <!-- RIGHT: Payouts & shipping -->
    <aside class="card">
      <div class="hd">Payouts &amp; shipping</div>
      <div class="bd payouts-body">
        <section>
          <h3>Payouts</h3>
          <p class="small">
            Set up payouts so we can send you money from your fabric sales.
          </p>
          <!-- Keep this as a simple link so it uses your real Stripe onboarding URL -->
          <a class="btn primary" id="stripePayoutLink" href="https://dashboard.stripe.com/connect/accounts/overview">
            Set up payouts with Stripe
          </a>
          <p class="small muted">
            We’ll send you to a secure Stripe page to enter your bank and tax details.
            Hemline never sees your full bank information.
          </p>
        </section>

        <section>
          <h3>Shipping labels</h3>
          <p class="small muted">
            Hemline uses Shippo to create shipping labels when you make a sale. We’ll use
            your default ship-from address below.
          </p>

          <!-- Compact summary view -->
          <div id="shippingSummary" class="ship-summary" style="display:none;">
            <div class="ship-summary-main" id="shippingSummaryText"></div>
            <div>
              <button id="editAddressBtn" class="btn small" type="button">Edit address</button>
            </div>
          </div>

          <!-- Editable form -->
          <form id="shippingForm" class="ship-form" autocomplete="shipping">
            <div class="field">
              <label for="shipName">Ship-from name</label>
              <input id="shipName" type="text" autocomplete="name" placeholder="Name that appears on labels">
            </div>

            <div class="field">
              <label for="shipStreet">Street address</label>
              <input id="shipStreet" type="text" autocomplete="address-line1">
            </div>

            <div class="field">
              <label for="shipStreet2">Apartment, suite, etc. (optional)</label>
              <input id="shipStreet2" type="text" autocomplete="address-line2">
            </div>

            <div class="field">
              <label for="shipCity">City</label>
              <input id="shipCity" type="text" autocomplete="address-level2">
            </div>

            <div class="field-row">
              <div class="field">
                <label for="shipState">State / Province</label>
                <input id="shipState" type="text" autocomplete="address-level1">
              </div>
              <div class="field">
                <label for="shipPostal">Postal code</label>
                <input id="shipPostal" type="text" autocomplete="postal-code">
              </div>
            </div>

            <div class="field">
              <label for="shipCountry">Country</label>
              <select id="shipCountry">
                <option value="">Select country</option>
                <option value="US">United States</option>
                <option value="CA">Canada</option>
                <option value="GB">United Kingdom</option>
                <option value="AU">Australia</option>
              </select>
            </div>

            <button id="saveAddressBtn" class="btn primary" type="submit">
              Save shipping address
            </button>
            <div id="shippingStatus" class="status-text"></div>
          </form>

          <p class="small muted">
            When you have a sale, your Sales page will let you create and download a label
            using this address.
          </p>
        </section>
      </div>
    </aside>

    <!-- Status -->
    <aside class="card">
      <div class="hd">Status</div>
      <div class="bd">
        <div style="display:flex;align-items:center;justify-content:space-between;">
          <div>
            <div style="font-weight:700">Vacation hold</div>
            <div class="muted small">Pause new orders while you’re away.</div>
          </div>
          <span id="vacSwitch" class="switch" role="switch" tabindex="0" aria-label="Vacation hold"></span>
        </div>
      </div>
    </aside>

    <!-- Security -->
    <section class="card">
      <div class="hd">Security</div>
      <div class="bd">
        <a class="btn" href="auth.html#reset">Change password</a>
      </div>
    </section>

    <!-- Privacy -->
    <section class="card">
      <div class="hd">Privacy</div>
      <div class="bd">
        <button class="btn" type="button" onclick="alert('Account deletion flow is not wired yet.')">
          Delete account
        </button>
        <p class="muted small" style="margin-top:10px">
          Learn more in our <a href="privacy.html">Privacy Policy</a>.
        </p>
      </div>
    </section>
  </div>
</main>

<footer class="hm-footer" role="contentinfo">
  <div class="footer-wrap">
    <div class="copy">© 2025 Hemline Market</div>
    <nav class="footer-links" aria-label="Footer">
      <a href="about.html">About</a>
      <a href="faq.html">FAQ</a>
      <a href="contact.html">Contact</a>
      <a href="terms.html">Terms</a>
      <a href="privacy.html">Privacy</a>
    </nav>
  </div>
</footer>

<!-- All account JS is inline here so this single file stays in sync -->
<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

  // ---- CONFIG ----
  const SUPABASE_URL = "https://clkizksbvxjkoatdajgd.supabase.co";
  const SUPABASE_ANON =
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNsa2l6a3Nidnhqa29hdGRhamdkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2ODAyMDUsImV4cCI6MjA3MDI1NjIwNX0.m3wd6UAuqxa7BpcQof9mmzd8zdsmadwGDO0x7-nyBjI";

  const supabase = createClient(SUPABASE_URL, SUPABASE_ANON);

  // ---- HEADER ELEMENTS ----
  const headerAvatar = document.getElementById("headerAvatar");
  const loginHeaderBtn = document.getElementById("loginHeaderBtn");

  // ---- MENU ----
  const openMenuBtn = document.getElementById("openMenu");
  const closeMenuBtn = document.getElementById("closeMenu");
  const menuSheet = document.getElementById("menuSheet");

  if (openMenuBtn && menuSheet) {
    openMenuBtn.addEventListener("click", () => {
      menuSheet.classList.add("open");
      menuSheet.setAttribute("aria-hidden","false");
    });
  }
  if (closeMenuBtn && menuSheet) {
    closeMenuBtn.addEventListener("click", () => {
      menuSheet.classList.remove("open");
      menuSheet.setAttribute("aria-hidden","true");
    });
  }

  // ---- ACCOUNT ELEMENTS ----
  const accountGrid = document.getElementById("accountGrid");
  const notSignedIn = document.getElementById("notSignedIn");

  const profileAvatar = document.getElementById("profileAvatar");
  const profileName = document.getElementById("profileName");
  const profileEmail = document.getElementById("profileEmail");
  const profileLocation = document.getElementById("profileLocation");
  const profileTagline = document.getElementById("profileTagline");
  const editProfileBtn = document.getElementById("editProfileBtn");
  const editPhotoBtn = document.getElementById("editPhotoBtn");
  const photoInput = document.getElementById("photoInput");
  const logoutBtn = document.getElementById("logoutBtn");

  const shipNameInput = document.getElementById("shipName");
  const shipStreetInput = document.getElementById("shipStreet");
  const shipStreet2Input = document.getElementById("shipStreet2");
  const shipCityInput = document.getElementById("shipCity");
  const shipStateInput = document.getElementById("shipState");
  const shipPostalInput = document.getElementById("shipPostal");
  const shipCountrySelect = document.getElementById("shipCountry");
  const shippingForm = document.getElementById("shippingForm");
  const shippingSummary = document.getElementById("shippingSummary");
  const shippingSummaryText = document.getElementById("shippingSummaryText");
  const editAddressBtn = document.getElementById("editAddressBtn");
  const shippingStatus = document.getElementById("shippingStatus");

  const vacSwitch = document.getElementById("vacSwitch");

  // ---- HELPERS ----
  function getInitials(name, email) {
    if (name && name.trim()) {
      const parts = name.trim().split(/\s+/);
      const first = parts[0]?.[0] || "";
      const last = parts[parts.length - 1]?.[0] || "";
      const letters = (first + last).toUpperCase();
      if (letters) return letters;
    }
    if (email) return email[0].toUpperCase();
    return "HM";
  }

  function show(el, displayValue = "") {
    if (el) el.style.display = displayValue;
  }
  function hide(el) {
    if (el) el.style.display = "none";
  }

  function saveLocal(key, value) {
    try {
      localStorage.setItem(key, JSON.stringify(value));
    } catch (e) {
      console.warn("localStorage save failed", e);
    }
  }
  function loadLocal(key, fallback = null) {
    try {
      const raw = localStorage.getItem(key);
      return raw ? JSON.parse(raw) : fallback;
    } catch (e) {
      return fallback;
    }
  }

  // ---- PROFILE LOCAL DATA ----
  function loadProfileExtras() {
    const stored = loadLocal("hm_profile_extras", null);
   
