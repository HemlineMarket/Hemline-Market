<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Account — Hemline Market</title>

  <!-- Shared Styles -->
  <link rel="stylesheet" href="styles/hm-modern.css"/>
  <link rel="stylesheet" href="styles/hm-header.css"/>
  <link rel="stylesheet" href="styles/hm-typography.css"/>
  <link rel="stylesheet" href="styles/hm-footer.css"/>
  <link rel="icon" href="/favicon.ico"/>

  <style>
    :root{
      --hm-accent:#991b1b;
      --hm-border:#e5e7eb;
      --hm-muted:#6b7280;
      --hm-text:#111827;
      --hm-bg:#f4f4f7;
    }
    html,body{
      margin:0;
      background:var(--hm-bg);
      overflow-x:hidden;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      -webkit-font-smoothing:antialiased;
    }
    .is-hidden{display:none!important;}

    main.account-wrap{
      max-width:1200px;
      margin:18px auto 24px;
      padding:0 12px;
    }

    h1.account-title{
      margin:0 0 4px;
      font-size:26px;
      font-weight:800;
      letter-spacing:.03em;
    }
    .account-subtitle{
      margin:0 0 18px;
      color:var(--hm-muted);
      font-size:14px;
    }

    .hm-card{
      background:#fff;
      border-radius:14px;
      border:1px solid var(--hm-border);
      box-shadow:0 6px 18px rgba(15,23,42,.06);
      margin-bottom:16px;
    }
    .hm-card-header{
      padding:10px 16px;
      border-bottom:1px solid var(--hm-border);
      font-size:12px;
      text-transform:uppercase;
      letter-spacing:.18em;
      font-weight:600;
      color:#9ca3af;
    }
    .hm-card-body{
      padding:16px;
    }

    /* PROFILE */
    .profile-name{
      font-size:18px;
      font-weight:700;
      margin-bottom:4px;
    }
    .profile-email{
      font-size:13px;
      color:var(--hm-muted);
      margin-bottom:8px;
    }
    .profile-extra{
      font-size:13px;
      white-space:pre-line;
      line-height:1.4;
      margin-bottom:12px;
    }

    .profile-actions{
      display:flex;
      gap:8px;
    }

    .pill-row{
      margin-top:16px;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
    }
    .pill-link{
      flex:1 1 140px;
      border-radius:999px;
      border:1px solid var(--hm-border);
      padding:10px 14px;
      background:#fff;
      text-decoration:none;
      display:flex;
      flex-direction:column;
      justify-content:center;
      max-width:260px;
      box-shadow:0 4px 12px rgba(15,23,42,.04);
    }
    .pill-link-title{
      font-size:13px;
      font-weight:700;
      color:#111827;
    }
    .pill-link-sub{
      font-size:12px;
      color:#6b7280;
      margin-top:2px;
    }

    .btn{
      padding:8px 12px;
      border-radius:999px;
      border:1px solid var(--hm-border);
      background:#fff;
      font-size:13px;
      font-weight:600;
      cursor:pointer;
    }
    .btn-primary{
      background:var(--hm-accent);
      border-color:var(--hm-accent);
      color:#fff;
    }

    .address-block{
      white-space:pre-line;
      font-size:13px;
      color:#111827;
      margin-bottom:10px;
    }

    .field-row{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-bottom:8px;
    }
    .field{
      flex:1;
      display:flex;
      flex-direction:column;
      font-size:13px;
      gap:3px;
    }
    .field input,
    .field textarea,
    .field select{
      background:#f9fafb;
      border:1px solid var(--hm-border);
      border-radius:10px;
      padding:7px 9px;
    }
    .muted-small{
      font-size:12px;
      color:var(--hm-muted);
    }
  </style>
</head>

<body>

  <div id="hm-shell-header"></div>

  <main class="account-wrap">

    <h1 class="account-title">Account</h1>
    <p class="account-subtitle">
      Manage your profile, payouts, shipping, vacation hold, and security.
    </p>

    <!-- PROFILE CARD -->
    <section class="hm-card">
      <div class="hm-card-header">Profile</div>
      <div class="hm-card-body">

        <div class="profile-name" id="profileName">Loading…</div>
        <div class="profile-email" id="profileEmail"></div>
        <div class="profile-extra" id="profileExtra"></div>

        <div class="profile-actions">
          <button class="btn" id="btnEditProfile">Edit profile</button>
          <button class="btn" id="btnLogout">Log out</button>
        </div>

        <div class="pill-row">
          <a class="pill-link" href="purchases.html">
            <span class="pill-link-title">Purchases</span>
            <span class="pill-link-sub">View your buying history</span>
          </a>
          <a class="pill-link" href="sales.html">
            <span class="pill-link-title">Sales</span>
            <span class="pill-link-sub">Manage your sales orders</span>
          </a>
          <a class="pill-link" href="messages.html">
            <span class="pill-link-title">Messages</span>
            <span class="pill-link-sub">Talk with buyers and sellers</span>
          </a>
          <a class="pill-link" href="favorites.html">
            <span class="pill-link-title">Favorites</span>
            <span class="pill-link-sub">Saved fabrics you like</span>
          </a>
          <a class="pill-link" href="atelier.html">
            <span class="pill-link-title">Your Atelier</span>
            <span class="pill-link-sub">Manage your fabric listings</span>
          </a>
        </div>

        <!-- EDITOR -->
        <section id="profileEditor" class="is-hidden">
          <form id="profileForm">

            <div class="field-row">
              <div class="field">
                <label>First name</label>
                <input id="firstName" autocomplete="given-name">
              </div>
              <div class="field">
                <label>Last name</label>
                <input id="lastName" autocomplete="family-name">
              </div>
            </div>

            <div class="field-row">
              <div class="field">
                <label>Store name</label>
                <input id="storeName">
                <p class="muted-small">Your public shop name.</p>
              </div>
            </div>

            <div class="field-row">
              <div class="field">
                <label>Short bio</label>
                <textarea id="bio"></textarea>
              </div>
            </div>

            <button class="btn btn-primary" type="submit">Save profile</button>
            <button class="btn" type="button" id="cancelProfileEdit">Cancel</button>

          </form>
        </section>

      </div>
    </section>

    <!-- PAYOUTS -->
    <section class="hm-card">
      <div class="hm-card-header">Payouts</div>
      <div class="hm-card-body">
        <p><strong>Payouts &amp; payments</strong></p>
        <p class="muted-small">
          Stripe powers payments and payouts. We never see your card or bank details.
        </p>
        <button class="btn btn-primary" id="btnStripe">Manage Stripe payouts</button>
      </div>
    </section>

    <!-- SHIPPING ADDRESS -->
    <section class="hm-card">
      <div class="hm-card-header">Shipping address</div>
      <div class="hm-card-body">

        <div class="address-block" id="addressDisplay">Add your ship-from address.</div>

        <button class="btn" id="btnEditAddress">Edit address</button>

        <section id="addressEditor" class="is-hidden">
          <form id="addressForm">

            <div class="field-row"><div class="field"><label>Name</label><input id="addrName"></div></div>
            <div class="field-row"><div class="field"><label>Street</label><input id="addrLine1"></div></div>
            <div class="field-row"><div class="field"><label>Apartment</label><input id="addrLine2"></div></div>

            <div class="field-row">
              <div class="field"><label>City</label><input id="addrCity"></div>
              <div class="field"><label>State</label><input id="addrState"></div>
            </div>

            <div class="field-row">
              <div class="field"><label>Postal</label><input id="addrZip"></div>
              <div class="field">
                <label>Country</label>
                <select id="addrCountry">
                  <option>United States</option>
                  <option>Other</option>
                </select>
              </div>
            </div>

            <button class="btn btn-primary">Save address</button>
            <button class="btn" type="button" id="cancelAddressEdit">Cancel</button>

          </form>
        </section>

      </div>
    </section>

    <!-- SECURITY -->
    <section class="hm-card">
      <div class="hm-card-header">Security</div>
      <div class="hm-card-body">
        <p class="muted-small">
          Password changes happen through email reset.
        </p>
        <button class="btn" id="btnChangePassword">Change password</button>
      </div>
    </section>

  </main>

  <div id="hm-shell-footer"></div>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="scripts/hm-shell.js"></script>

  <script>
    const supabaseClient = window.supabase.createClient(
      "https://clkizksbvxjkoatdajgd.supabase.co",
      "<YOUR_ANON_KEY>",
      { auth:{ persistSession:true } }
    );

    async function init(){
      const { data:{ session } } = await supabaseClient.auth.getSession();
      if(!session) return location.href = "auth.html?view=login";

      const user = session.user;
      const email = user.email;
      document.getElementById("profileEmail").textContent = email;

      const PROFILE_KEY = "hm_profile_" + user.id;
      const ADDRESS_KEY = "hm_address_" + user.id;

      let profile = JSON.parse(localStorage.getItem(PROFILE_KEY) || "{}");

      // TOP NAME ALWAYS FIRST+LAST
      const fullName = (profile.firstName || "") + 
                       (profile.lastName ? " " + profile.lastName : "");
      document.getElementById("profileName").textContent =
        fullName.trim() || email.split("@")[0];

      const lines = [];
      if(profile.storeName) lines.push("Store name: " + profile.storeName);
      if(profile.storeSlug) lines.push("Store link: hemline.market/shop/" + profile.storeSlug);
      if(profile.bio) lines.push(profile.bio);
      document.getElementById("profileExtra").textContent = lines.join("\n");

      // EDIT PROFILE
      const form = document.getElementById("profileForm");
      form.firstName.value = profile.firstName || "";
      form.lastName.value = profile.lastName || "";
      form.storeName.value = profile.storeName || "";
      form.bio.value = profile.bio || "";

      document.getElementById("btnEditProfile").onclick = () => {
        document.getElementById("profileEditor").classList.remove("is-hidden");
      };
      document.getElementById("cancelProfileEdit").onclick = () => {
        document.getElementById("profileEditor").classList.add("is-hidden");
      };

      form.onsubmit = e => {
        e.preventDefault();
        const next = {
          firstName: form.firstName.value.trim(),
          lastName: form.lastName.value.trim(),
          storeName: form.storeName.value.trim(),
          storeSlug: form.storeName.value.trim().toLowerCase().replace(/[^a-z0-9]+/g,"-"),
          bio: form.bio.value.trim()
        };
        localStorage.setItem(PROFILE_KEY, JSON.stringify(next));
        location.reload();
      };

      // ADDRESS
      let addr = JSON.parse(localStorage.getItem(ADDRESS_KEY) || "{}");
      const ad = document.getElementById("addressDisplay");
      if(addr.addrLine1){
        ad.textContent = [
          addr.addrName,
          addr.addrLine1 + (addr.addrLine2 ? "\n" + addr.addrLine2 : ""),
          (addr.addrCity||"") + ", " + (addr.addrState||"") + " " + (addr.addrZip||""),
          addr.addrCountry
        ].join("\n");
      }

      const af = document.getElementById("addressForm");
      af.addrName.value = addr.addrName || "";
      af.addrLine1.value = addr.addrLine1 || "";
      af.addrLine2.value = addr.addrLine2 || "";
      af.addrCity.value = addr.addrCity || "";
      af.addrState.value = addr.addrState || "";
      af.addrZip.value = addr.addrZip || "";
      af.addrCountry.value = addr.addrCountry || "United States";

      document.getElementById("btnEditAddress").onclick = () => {
        document.getElementById("addressEditor").classList.remove("is-hidden");
      };
      document.getElementById("cancelAddressEdit").onclick = () => {
        document.getElementById("addressEditor").classList.add("is-hidden");
      };

      af.onsubmit = e => {
        e.preventDefault();
        const next = {
          addrName: af.addrName.value.trim(),
          addrLine1: af.addrLine1.value.trim(),
          addrLine2: af.addrLine2.value.trim(),
          addrCity: af.addrCity.value.trim(),
          addrState: af.addrState.value.trim(),
          addrZip: af.addrZip.value.trim(),
          addrCountry: af.addrCountry.value
        };
        localStorage.setItem(ADDRESS_KEY, JSON.stringify(next));
        location.reload();
      };

      // STRIPE
      document.getElementById("btnStripe").onclick = () =>
        alert("Stripe Express integration will open here.");

      // LOGOUT
      document.getElementById("btnLogout").onclick = async () => {
        await supabaseClient.auth.signOut();
        location.href = "auth.html?view=login";
      };

      // PASSWORD
      document.getElementById("btnChangePassword").onclick = () =>
        alert("Use the email reset link to change your password.");
    }

    init();
  </script>

  <script>
    window.HM && window.HM.renderShell({ currentPage:"account" });
  </script>

</body>
</html>
