<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Account — Hemline Market</title>

<link rel="stylesheet" href="styles/hm-footer.css"/>

<style>
  :root{--ink:#111827;--muted:#6b7280;--border:#e5e7eb;--accent:#991b1b;--bg:#fafafa}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;-webkit-font-smoothing:antialiased}

  /* Header (minimal, matches your style) */
  .hm-header{min-height:56px;background:#fff;border-bottom:1px solid var(--border)}
  .hm-header .wrap{max-width:1200px;margin:0 auto;padding:0 12px;display:flex;align-items:center;justify-content:space-between}
  .hm-header .left{display:flex;align-items:center;gap:10px}
  .hm-brand{font-size:24px;font-weight:800;color:var(--accent);text-decoration:none}
  .hamburger{display:inline-grid;place-items:center;width:36px;height:36px;border:1px solid var(--border);border-radius:10px;background:#fff;color:#374151}
  .hamburger svg{width:22px;height:22px;stroke-width:2}
  .right{display:flex;align-items:center;gap:14px}
  .hm-icon{color:#444;display:inline-grid;place-items:center}
  .hm-icon svg{width:26px;height:26px;stroke-width:2}
  .hm-avatar{width:28px;height:28px;border-radius:50%;border:1px solid var(--border);background:#fff;color:#334155;display:inline-grid;place-items:center;font-weight:700;font-size:12px;text-decoration:none}
  .hm-btn-primary{background:var(--accent);color:#fff;border:1px solid var(--accent);border-radius:999px;padding:10px 18px;font-weight:700;text-decoration:none;box-shadow:0 2px 8px rgba(153,27,27,.25)}

  /* Page */
  .wrap{max-width:900px;margin:18px auto 28px;padding:0 12px}
  h1{margin:0 0 6px;font-size:28px;font-weight:800}
  .subtle{color:var(--muted);font-size:14px;margin:0 0 16px}

  .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  @media (max-width:900px){.grid{grid-template-columns:1fr}}

  .card{background:#fff;border:1px solid var(--border);border-radius:12px;box-shadow:0 6px 16px rgba(0,0,0,.06);padding:16px}
  .card h2{margin:0 0 10px;font-size:18px}

  .field{display:flex;flex-direction:column;gap:6px;margin-bottom:10px}
  .field label{font-size:13px;font-weight:700;color:#374151}
  .field input{border:1px solid var(--border);border-radius:10px;background:#fff;padding:10px;font-size:14px}

  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .btn{padding:10px 14px;border:1px solid var(--border);border-radius:10px;background:#fff;font-weight:700;cursor:pointer;text-decoration:none;color:#111827}
  .btn.btn-primary{background:var(--accent);color:#fff;border-color:var(--accent);box-shadow:0 2px 8px rgba(153,27,27,.25)}
  .note{font-size:12px;color:var(--muted)}
  .link{color:#1f2937;text-decoration:none;border-bottom:1px dotted #cbd5e1}
  .link:hover{color:var(--accent);border-bottom-color:var(--accent)}

  /* Status toast */
  .toast{display:none;margin-top:10px;border-left:4px solid #065f46;background:#ecfdf5;padding:10px;border-radius:10px;font-size:14px}
  .toast.error{border-left-color:#991b1b;background:#fef2f2}
  .toast.show{display:block}

  /* Signed-in panel */
  #signedInCard .welcome{font-weight:800}
</style>
</head>
<body>

<!-- HEADER -->
<header class="hm-header" role="banner">
  <div class="wrap">
    <div class="left">
      <button class="hamburger" id="openMenu" aria-label="Open menu">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
          <line x1="4" y1="6" x2="20" y2="6"></line>
          <line x1="4" y1="12" x2="20" y2="12"></line>
          <line x1="4" y1="18" x2="20" y2="18"></line>
        </svg>
      </button>
      <a class="hm-brand" href="index.html">Hemline Market</a>
    </div>
    <div class="right">
      <a class="hm-icon" href="favorites.html" aria-label="Favorites">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 1 0-7.78 7.78L12 21.23l8.84-8.84a5.5 5.5 0 0 0 0-7.78z"/>
        </svg>
      </a>
      <a class="hm-icon" href="notifications.html" aria-label="Notifications">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M18 8a6 6 0 1 0-12 0c0 7-3 7-3 7h18s-3 0-3-7"/>
          <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
        </svg>
      </a>
      <a class="hm-avatar" id="avatar" href="account.html" title="Your profile">AA</a>
      <a class="hm-btn-primary" href="seller/index.html">Sell</a>
    </div>
  </div>
</header>

<main class="wrap" id="maincontent">
  <h1>Account</h1>
  <p class="subtle">Sign in or create your account. Sellers can list fabrics right after sign-in.</p>

  <!-- Signed-in state (hidden until we detect a session) -->
  <section id="signedInCard" class="card" style="display:none; margin-bottom:16px">
    <h2>Welcome</h2>
    <p class="welcome" id="welcomeEmail"></p>
    <div class="row" style="margin-top:8px">
      <a class="btn btn-primary" href="seller/index.html">Go to Seller Dashboard</a>
      <button id="signOutBtn" class="btn" type="button">Sign out</button>
    </div>
  </section>

  <div id="authGrid" class="grid">
    <!-- Sign in -->
    <section class="card">
      <h2>Sign in</h2>
      <div class="field">
        <label for="si_email">Email</label>
        <input id="si_email" type="email" autocomplete="email" placeholder="you@example.com" required>
      </div>
      <div class="field">
        <label for="si_password">Password</label>
        <input id="si_password" type="password" autocomplete="current-password" placeholder="Your password" required>
      </div>
      <div class="row">
        <button id="signInBtn" class="btn btn-primary" type="button">Sign in</button>
        <a class="link" id="resetLink" href="#">Forgot your password?</a>
      </div>
      <div id="si_toast" class="toast" aria-live="polite"></div>
    </section>

    <!-- Create account -->
    <section class="card">
      <h2>Create an account</h2>
      <div class="field">
        <label for="su_name">Full name</label>
        <input id="su_name" type="text" autocomplete="name" placeholder="First Last">
      </div>
      <div class="field">
        <label for="su_email">Email</label>
        <input id="su_email" type="email" autocomplete="email" placeholder="you@example.com" required>
      </div>
      <div class="field">
        <label for="su_password">Password</label>
        <input id="su_password" type="password" autocomplete="new-password" placeholder="Create a password" required>
      </div>
      <div class="row">
        <button id="signUpBtn" class="btn btn-primary" type="button">Create account</button>
        <span class="note">We’ll send a confirmation link if required.</span>
      </div>
      <div id="su_toast" class="toast" aria-live="polite"></div>
    </section>
  </div>

  <section class="card" style="margin-top:16px">
    <h2>Why create an account?</h2>
    <ul class="note" style="margin:6px 0 0;padding-left:18px">
      <li>Save your shop profile and listings</li>
      <li>Track orders and shipping</li>
      <li>Get paid for sales</li>
    </ul>
    <p class="note" style="margin-top:8px">Questions? <a class="link" href="contact.html">Contact Hemline Market</a>.</p>
  </section>
</main>

<!-- FOOTER -->
<footer class="hm-footer" role="contentinfo">
  <div class="footer-wrap">
    <div class="copy">© 2025 Hemline Market</div>
    <nav class="footer-links" aria-label="Footer">
      <a href="how.html" class="how">How It Works</a>
      <a href="about.html">About</a>
      <a href="contact.html">Contact</a>
      <a href="faq.html">FAQ</a>
      <a href="privacy.html">Privacy</a>
      <a href="terms.html">Terms</a>
    </nav>
  </div>
</footer>

<!-- Supabase client -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<!-- Your env vars -->
<script src="env.js"></script>

<script>
(function(){
  // Avatar from localStorage, if any
  const avatar=document.getElementById("avatar");
  try{ const url=localStorage.getItem("avatarUrl"); if(url){ avatar.textContent=''; avatar.style.backgroundImage="url('"+url+"')"; } }catch(e){}

  // Init Supabase
  const { SUPABASE_URL, SUPABASE_ANON_KEY } = (window.__env || {});
  if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {
    console.error('Missing Supabase env values. Check public/env.js');
  }
  const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  // Elements
  const signedInCard = document.getElementById('signedInCard');
  const welcomeEmail  = document.getElementById('welcomeEmail');
  const signOutBtn    = document.getElementById('signOutBtn');

  const authGrid   = document.getElementById('authGrid');
  const siEmail    = document.getElementById('si_email');
  const siPassword = document.getElementById('si_password');
  const signInBtn  = document.getElementById('signInBtn');
  const siToast    = document.getElementById('si_toast');

  const suName     = document.getElementById('su_name');
  const suEmail    = document.getElementById('su_email');
  const suPassword = document.getElementById('su_password');
  const signUpBtn  = document.getElementById('signUpBtn');
  const suToast    = document.getElementById('su_toast');
  const resetLink  = document.getElementById('resetLink');

  function showToast(el, msg, isError=false){
    el.textContent = msg;
    el.classList.toggle('error', !!isError);
    el.classList.add('show');
    setTimeout(()=> el.classList.remove('show'), 5000);
  }

  async function refreshSessionUI(){
    const { data: { session } } = await sb.auth.getSession();
    if(session && session.user){
      const email = session.user.email || 'Signed in';
      welcomeEmail.textContent = email;
      signedInCard.style.display = '';
      authGrid.style.display = 'none';
    }else{
      signedInCard.style.display = 'none';
      authGrid.style.display = '';
    }
  }

  // Handle URL hash parameters after redirect (email confirms, etc.)
  // Supabase v2 can parse these automatically via getSession(), but we also force-refresh UI.
  sb.auth.onAuthStateChange((_event, _session) => {
    refreshSessionUI();
  });

  // Sign in with email + password
  signInBtn.addEventListener('click', async ()=>{
    siToast.classList.remove('show','error');
    const email = siEmail.value.trim();
    const password = siPassword.value;
    if(!email || !password){
      showToast(siToast, 'Enter email and password.', true); return;
    }
    const { error } = await sb.auth.signInWithPassword({ email, password });
    if(error){
      showToast(siToast, error.message || 'Sign-in failed.', true);
    }else{
      showToast(siToast, 'Signed in! Redirecting…');
      // optional: go straight to seller dashboard
      setTimeout(()=> window.location.href = 'seller/index.html', 600);
    }
  });

  // Sign up (email + password). If "Confirm email" is ON in Supabase, a link will be sent.
  signUpBtn.addEventListener('click', async ()=>{
    suToast.classList.remove('show','error');
    const email = suEmail.value.trim();
    const password = suPassword.value;
    const fullName = suName.value.trim();
    if(!email || !password){
      showToast(suToast, 'Enter email and a password.', true); return;
    }
    const { data, error } = await sb.auth.signUp({
      email, password,
      options: {
        data: { full_name: fullName || null },
        emailRedirectTo: window.location.origin + '/account.html'
      }
    });
    if(error){
      showToast(suToast, error.message || 'Sign-up failed.', true);
      return;
    }
    if(data.user && !data.session){
      // Email confirmation required
      showToast(suToast, 'Check your email to confirm your account. Then come back here.');
    }else{
      // Auto-signed-in (if confirm not required)
      showToast(suToast, 'Account created!');
      setTimeout(()=> window.location.href = 'seller/index.html', 600);
    }
  });

  // Reset password (sends email)
  resetLink.addEventListener('click', async (e)=>{
    e.preventDefault();
    siToast.classList.remove('show','error');
    const email = siEmail.value.trim();
    if(!email){
      showToast(siToast, 'Enter your email above first.', true); return;
    }
    const { error } = await sb.auth.resetPasswordForEmail(email, {
      redirectTo: window.location.origin + '/account.html'
    });
    if(error){
      showToast(siToast, error.message || 'Could not send reset email.', true);
    }else{
      showToast(siToast, 'Password reset email sent.');
    }
  });

  // Sign out
  signOutBtn.addEventListener('click', async ()=>{
    await sb.auth.signOut();
    await refreshSessionUI();
  });

  // Initial UI
  refreshSessionUI();
})();
</script>
</body>
</html>
