<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Thank You — Hemline Market</title>

  <!-- UNIVERSAL HM CSS STACK -->
  <link rel="stylesheet" href="styles/hm-modern.css"/>
  <link rel="stylesheet" href="styles/hm-header.css"/>
  <link rel="stylesheet" href="styles/hm-typography.css"/>
  <link rel="stylesheet" href="styles/hm-footer.css"/>

  <style>
    :root{
      --hm-border:#e5e7eb;--ink:#111827;--muted:#6b7280;--border:#e5e7eb;--accent:#991b1b;--bg:#fafafa}
    *{box-sizing:border-box}
    body{
      margin:0;
      background:var(--bg);
      color:var(--ink);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      -webkit-font-smoothing:antialiased;
    }

    /* Page layout */
    .container{
      max-width:1100px;
      margin:20px auto;
      padding:0 12px;
      display:grid;
      grid-template-columns:1fr 360px;
      gap:18px;
    }
    @media(max-width:900px){
      .container{grid-template-columns:1fr}
    }
    .card{
      background:#fff;
      border:1px solid var(--border);
      border-radius:12px;
      padding:16px;
    }
    h1{margin:0 0 6px}
    .muted{color:var(--muted)}

    .ok{
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .ok .dot{
      width:22px;
      height:22px;
      border-radius:50%;
      background:#16a34a;
      display:inline-grid;
      place-items:center;
      color:#fff;
    }
    .ok .dot svg{
      width:14px;
      height:14px;
      stroke-width:3;
    }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      height:42px;
      padding:0 16px;
      border-radius:999px;
      border:1px solid transparent;
      background:var(--accent);
      color:#fff;
      text-decoration:none;
      font-weight:700;
    }
    .btn-outline{
      background:#fff;
      color:var(--accent);
      border:1px solid var(--border);
    }
    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:12px;
    }

    /* Summary */
    .item{
      display:flex;
      gap:12px;
      align-items:center;
    }
    .thumb{
      width:48px;
      height:48px;
      border:1px solid var(--border);
      border-radius:10px;
      background:#f3f4f6;
    }
    .grow{flex:1}
    .line{
      height:1px;
      background:var(--border);
      margin:12px 0;
    }
    .row{
      display:flex;
      justify-content:space-between;
      margin:6px 0;
    }
    .grand{font-weight:800}
  </style>
  <!-- Vercel Web Analytics -->
  <script>
    window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
  </script>
  <script defer src="/_vercel/insights/script.js"></script>
</head>
<body>

<!-- UNIVERSAL HEADER -->
<div id="hm-shell-header"></div>

<main class="container">
  <!-- LEFT: Confirmation -->
  <section class="card" aria-labelledby="thxTitle">
    <div class="ok" style="margin-bottom:8px">
      <span class="dot" aria-hidden="true">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M20 6L9 17l-5-5"/>
        </svg>
      </span>
      <strong id="thxTitle">Thank you — your order is placed!</strong>
    </div>
    <div class="muted" id="orderLine">
      Order <b id="order-id">#HM-000000</b>
    </div>

    <p class="muted" style="margin-top:10px">
      We emailed your receipt. You’ll get tracking updates when the sellers ship.
    </p>

    <div class="actions">
      <a class="btn" href="orders.html">View orders</a>
      <a class="btn-outline" href="browse.html">Continue shopping</a>
      <a class="btn-outline" href="index.html">Back to home</a>
    </div>
  </section>

  <!-- RIGHT: Order summary -->
  <aside class="card" aria-labelledby="sumTitle">
    <h2 id="sumTitle" style="margin:0 0 8px">Order summary</h2>
    <div id="items"></div>

    <div class="line"></div>
    <div class="row"><span>Items</span><span id="itemsTotal">$0.00</span></div>
    <div class="row"><span>Shipping</span><span id="shippingTotal">$0.00</span></div>
    <div class="line"></div>
    <div class="row grand"><span>Total</span><span id="grandTotal">$0.00</span></div>
  </aside>
</main>

<!-- UNIVERSAL FOOTER -->
<div id="hm-shell-footer"></div>

<!-- UNIVERSAL / AUTH SCRIPTS -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="scripts/hm-shell.js"></script>

<!-- Page-specific JS -->
<script>
(function(){
  const fmt=c=>'$'+(Math.max(0,c)/100).toFixed(2);

  // 1) Order number from query (?o=HM-######)
  const params=new URLSearchParams(location.search);
  const orderId=params.get('o');
  const orderIdEl=document.getElementById('order-id');
  if(orderId && orderIdEl){ orderIdEl.textContent=orderId; }

  // 2) Totals + items snapshot (if present)
  const totals = JSON.parse(localStorage.getItem('hm_last_checkout_totals')||'null');
  const itemsSnap = JSON.parse(localStorage.getItem('hm_last_checkout_items')||'null');

  // Items list (optional snapshot; fine if absent)
  const itemsEl=document.getElementById('items');
  itemsEl.innerHTML='';
  let subtotal = 0;

  if(Array.isArray(itemsSnap) && itemsSnap.length){
    itemsSnap.forEach(it=>{
      const line=(it.amount||0)*(it.qty||1);
      subtotal+=line;
      const row=document.createElement('div'); 
      row.className='item';
      row.innerHTML =
        '<div class="thumb" aria-hidden="true"></div>'+
        '<div class="grow"><div>'+ (it.name||'Item') +'</div>'+
        '<div class="muted">'+ ((it.yards ? (it.yards + " yd") : "") ) +'</div></div>'+
        '<div>'+fmt(line)+'</div>';
      itemsEl.appendChild(row);
    });
  } else if (totals) {
    subtotal = totals.subtotal||0;
  }

  // Totals render
  const ship = totals ? (totals.shipping||0) : 0;
  document.getElementById('itemsTotal').textContent = fmt(subtotal);
  document.getElementById('shippingTotal').textContent = fmt(ship);
  document.getElementById('grandTotal').textContent = fmt(subtotal + ship);

  // Clear ephemeral snapshots so refresh doesn't reuse them
  localStorage.removeItem('hm_last_checkout_totals');
  localStorage.removeItem('hm_last_checkout_items');
})();
</script>

<!-- Render universal header/footer -->
<script>
window.HM && window.HM.renderShell({ currentPage: "checkout-thanks" });
</script>

</body>
</html>
