<!doctype html>
<html lang="en">
<head>
  <!-- MOBILE HOTFIX: keep inside <head> -->
  <style id="hm-mobile-hotfix">
    html, body { max-width:100%; overflow-x:hidden; }
    .rail, .chiprail { overflow-x:auto; -webkit-overflow-scrolling: touch; }
    .grid, .section, .toolbar, .header, .tabbar { max-width:100%; }
    img, video, canvas, svg { max-width:100%; height:auto; }
    [style*="width:1200px"], [style*="max-width:1200px"] { width:auto !important; max-width:100% !important; }
  </style>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Hemline Market — Home</title>

  <!-- keep your shared styles if present -->
  <link rel="stylesheet" href="styles/hm-modern.css"/>
  <link rel="stylesheet" href="styles/hem-header.css"/>
  <link rel="stylesheet" href="styles/hm-typography.css"/>
  <link rel="stylesheet" href="styles/hm-footer.css"/>

  <style>
    :root{
      --bg:#fff; --ink:#111827; --muted:#6b7280; --border:#e5e7eb; --brand:#991b1b;
      --chip:#f3f4f6; --chip-ink:#111827; --chip-on:#0f766e; --chip-on-ink:#fff; --ring:#0ea5b7;

      /* Color swatches (restored set with Gold/Silver + hover tips) */
      --c-white:#ffffff; --c-cream:#f5efe4; --c-beige:#d6c7b4; --c-camel:#b6895a; --c-tan:#c8a27a;
      --c-yellow:#f3c321; --c-orange:#f27a22; --c-rust:#b54d2e; --c-red:#cc4b4b; --c-burgundy:#6b2b3d;
      --c-pink:#f4a4b6; --c-blush:#f2c7c2; --c-lilac:#b699d6; --c-purple:#6b4fa6;
      --c-blue:#2166d1; --c-navy:#1f2a44; --c-teal:#0d9488; --c-green:#2f7d32; --c-olive:#6b8f3d;
      --c-brown:#5b3c25; --c-grey:#9aa0a6; --c-charcoal:#374151; --c-black:#111111;
    }
    body{margin:0;background:#fafafa;color:var(--ink);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;min-height:100vh;display:flex;flex-direction:column;-webkit-font-smoothing:antialiased}

    /* Header */
    .hm-header{min-height:56px;background:#fff;border-bottom:1px solid var(--border)}
    .hm-header .wrap{max-width:1200px;margin:0 auto;padding:0 12px;display:flex;align-items:center;justify-content:space-between}
    .left{display:flex;align-items:center;gap:10px}
    .hm-brand{font-size:24px;font-weight:800;color:var(--brand);text-decoration:none}
    .right{display:flex;align-items:center;gap:14px}
    .iconbtn{display:inline-grid;place-items:center;width:36px;height:36px;border:1px solid var(--border);border-radius:10px;background:#fff;color:#374151}
    .iconbtn.active{background:var(--brand);color:#fff;box-shadow:0 2px 8px rgba(153,27,27,.25)}
    .iconbtn svg{width:22px;height:22px;stroke-width:2}

    /* Search + top filters */
    .wrap{max-width:1200px;margin:14px auto;padding:0 12px}
    .search{display:flex;gap:8px;align-items:center}
    .search input{flex:1;padding:12px;border:1px solid var(--border);border-radius:999px;background:#fff}
    .filter-open{padding:10px 14px;border-radius:999px;border:1px solid var(--border);background:#fff;display:inline-flex;gap:8px;align-items:center}
    .topchips{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0 8px}
    .chip{display:inline-flex;align-items:center;gap:6px;background:#fff;border:1px solid var(--border);border-radius:999px;padding:8px 12px;font-size:14px}
    .chip[data-on="true"]{background:var(--chip-on);color:var(--chip-on-ink);border-color:var(--chip-on)}

    /* Color swatch rail (restored with hover + Gold/Silver) */
    .swrail{display:flex;gap:10px;overflow:auto;padding:10px;border-radius:12px;background:#fff;border:1px solid var(--border)}
    .sw{width:28px;height:28px;border-radius:999px;border:1px solid #d1d5db;box-shadow:inset 0 0 0 1px rgba(0,0,0,.06);cursor:pointer;position:relative;flex:0 0 auto}
    .sw[data-on="true"]{outline:2px solid var(--ring);outline-offset:2px}
    .sw .tip{position:absolute;bottom:130%;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.85);color:#fff;padding:2px 6px;border-radius:4px;font-size:11px;white-space:nowrap;opacity:0;pointer-events:none}
    .sw:hover .tip{opacity:1}
    .sw.gold{background:linear-gradient(135deg,#d4b870 0%,#f0dc97 50%,#ceb86b 100%)}
    .sw.silver{background:linear-gradient(135deg,#bfc6cf 0%,#e6eaef 50%,#a9b0ba 100%)}

    /* Sections */
    h2.section{font-size:16px;color:#374151;margin:14px 0 8px}
    .grid{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:12px}
    @media (max-width:900px){ .grid{grid-template-columns:repeat(2,minmax(0,1fr))} }
    @media (max-width:560px){ .grid{grid-template-columns:1fr} }
    .card{background:#fff;border:1px solid var(--border);border-radius:12px;overflow:hidden}
    .card img{width:100%;height:160px;object-fit:cover;background:#eef2f7}
    .meta{padding:10px 12px;display:flex;justify-content:space-between;align-items:center}
    .meta .t{font-weight:700}
    .heart{display:inline-grid;place-items:center;width:28px;height:28px;border:1px solid var(--border);border-radius:999px;background:#fff;cursor:pointer}
    .heart[data-on="true"] svg{fill:#ef4444;stroke:#ef4444}

    /* Footer */
    footer{margin-top:auto;border-top:1px solid var(--border);background:#fff}
    .footer-wrap{max-width:1200px;margin:0 auto;padding:20px 12px;display:flex;justify-content:space-between;color:#6b7280;flex-wrap:wrap}

    /* Slide-in filter panel (single-open accordion) */
    .scrim{ position:fixed; inset:0; background:rgba(0,0,0,.35); opacity:0; pointer-events:none; transition:.2s; z-index:120}
    .scrim.on{ opacity:1; pointer-events:auto}
    .panel{
      position:fixed; inset:0 auto 0 0; width:min(560px, 90vw); background:#fff;
      transform:translateX(-100%); transition:.25s; z-index:130; border-right:1px solid var(--border);
      display:flex; flex-direction:column;
    }
    .panel.on{ transform:none }
    .panel header{ position:sticky; top:0; background:#fff; border-bottom:1px solid var(--border); z-index:2}
    .panel h3{ margin:0; padding:14px 16px}
    .panel .body{ padding:10px 16px 90px; overflow:auto}
    .panel details{border:1px solid var(--border);border-radius:12px;margin:10px 0;background:#fff}
    .panel summary{list-style:none;cursor:pointer;padding:12px;font-weight:700;display:flex;justify-content:space-between}
    .panel summary::-webkit-details-marker{display:none}
    .panel .inner{padding:12px;border-top:1px solid var(--border)}
    .panel .row{display:flex;flex-wrap:wrap;gap:8px}
    .panel .chip{cursor:pointer}
    .applybar{ position:sticky; bottom:0; background:linear-gradient(180deg, rgba(255,255,255,.6), #fff 40%); border-top:1px solid var(--border); padding:12px 16px; display:flex; gap:10px }
    .apply{ flex:1; padding:12px 14px; border-radius:12px; border:0; background:var(--brand); color:#fff; font-weight:700; cursor:pointer }
    .ghost{ background:transparent; color:var(--brand); border:1px solid var(--brand) }
  </style>
</head>
<body>
<header class="hm-header" role="banner">
  <div class="wrap">
    <div class="left">
      <a class="hm-brand" href="index.html">Hemline Market</a>
    </div>
    <div class="right">
      <a class="iconbtn" id="favBtn" aria-label="Favorites" title="Favorites">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 1 0-7.78 7.78L12 21.23l8.84-8.84a5.5 5.5 0 0 0 0-7.78z"/></svg>
      </a>
      <a class="iconbtn" id="alertBtn" aria-label="Alerts" title="Alerts">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M18 8a6 6 0 1 0-12 0c0 7-3 7-3 7h18s-3 0-3-7"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
      </a>
      <a class="iconbtn" href="browse.html" title="Browse">Browse</a>
      <a class="iconbtn" href="seller/index.html" title="Sell">Sell</a>
    </div>
  </div>
</header>

<main class="wrap" id="main">
  <!-- Search row -->
  <div class="search">
    <input id="q" placeholder="Search content (e.g., cashmere, denim, silk)" />
    <button class="filter-open" id="openFilters" aria-haspopup="dialog" aria-controls="filterPanel">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" width="18" height="18"><path d="M3 6h18M6 12h12M10 18h4"/></svg>
      Filters
    </button>
  </div>

  <!-- Top chips that open the panel -->
  <div class="topchips">
    <button class="chip" data-focus="department">Department</button>
    <button class="chip" data-focus="content">Content</button>
    <button class="chip" data-focus="color">Color</button>
    <button class="chip" data-focus="fabric-type">Fabric Type</button>
    <button class="chip" data-focus="pattern">Pattern</button>
    <button class="chip" data-focus="width">Width</button>
    <button class="chip" data-focus="weight">Weight (GSM)</button>
    <button class="chip" data-focus="country">Country</button>
    <button class="chip" data-focus="designer">Designer</button>
    <button class="chip" data-focus="price">Price</button>
  </div>

  <!-- Shop by Color (restored swatches with hover + Gold/Silver) -->
  <h2 class="section">Shop by Color</h2>
  <div class="swrail" id="colorRail" aria-label="Color filters">
    <!-- colors will be injected by JS to keep parity with Browse -->
  </div>

  <!-- Popular Content chips -->
  <h2 class="section">Popular Content</h2>
  <div class="topchips" id="contentChips">
    <!-- content chips injected by JS -->
  </div>

  <!-- Favorites -->
  <h2 class="section">Favorites</h2>
  <div class="grid" id="favGrid">
    <article class="card"><img src="https://images.unsplash.com/photo-1467043153537-a4f57095882d?q=80&w=1200&auto=format&fit=crop" alt=""><div class="meta"><div><div class="t">Japanese Denim</div><div class="s">Raw Indigo · 145cm</div></div><button class="heart" aria-label="Save"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" width="18" height="18"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 1 0-7.78 7.78L12 21.23l8.84-8.84a5.5 5.5 0 0 0 0-7.78z"/></svg></button></div></article>
    <article class="card"><img src="https://images.unsplash.com/photo-1556306535-abccb408c19f?q=80&w=1200&auto=format&fit=crop" alt=""><div class="meta"><div><div class="t">Silk Charmeuse</div><div class="s">Champagne · 114cm</div></div><button class="heart" aria-label="Save"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" width="18" height="18"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 1 0-7.78 7.78L12 21.23l8.84-8.84a5.5 5.5 0 0 0 0-7.78z"/></svg></button></div></article>
    <article class="card"><img src="https://images.unsplash.com/photo-1567502058429-b22a04e2d2b8?q=80&w=1200&auto=format&fit=crop" alt=""><div class="meta"><div><div class="t">European Linen</div><div class="s">Natural · 140cm</div></div><button class="heart" aria-label="Save"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" width="18" height="18"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 1 0-7.78 7.78L12 21.23l8.84-8.84a5.5 5.5 0 0 0 0-7.78z"/></svg></button></div></article>
    <article class="card"><img src="https://images.unsplash.com/photo-1512436991641-6745cdb1723f?q=80&w=1200&auto=format&fit=crop" alt=""><div class="meta"><div><div class="t">Italian Wool Suiting</div><div class="s">Navy · 150cm</div></div><button class="heart" aria-label="Save"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" width="18" height="18"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 1 0-7.78 7.78L12 21.23l8.84-8.84a5.5 5.5 0 0 0 0-7.78z"/></svg></button></div></article>
  </div>

  <!-- Recent Views -->
  <h2 class="section">Recent Views</h2>
  <div class="grid" id="recentGrid">
    <article class="card"><img src="https://images.unsplash.com/photo-1520975954732-35dd22f7c98a?q=80&w=1200&auto=format&fit=crop" alt=""><div class="meta"><div><div class="t">Tencel Twill</div><div class="s">Navy · 165 GSM</div></div><button class="heart" aria-label="Save"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" width="18" height="18"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 1 0-7.78 7.78L12 21.23l8.84-8.84a5.5 5.5 0 0 0 0-7.78z"/></svg></button></div></article>
    <article class="card"><img src="https://images.unsplash.com/photo-1503341733017-1901578f9b9f?q=80&w=1200&auto=format&fit=crop" alt=""><div class="meta"><div><div class="t">Cupro/Silk Satin</div><div class="s">Champagne · 95 GSM</div></div><button class="heart" aria-label="Save"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" width="18" height="18"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 1 0-7.78 7.78L12 21.23l8.84-8.84a5.5 5.5 0 0 0 0-7.78z"/></svg></button></div></article>
    <article class="card"><img src="https://images.unsplash.com/photo-1531928351158-2f736078e0a1?q=80&w=1200&auto=format&fit=crop" alt=""><div class="meta"><div><div class="t">Linen Canvas</div><div class="s">Natural · 210 GSM</div></div><button class="heart" aria-label="Save"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" width="18" height="18"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 1 0-7.78 7.78L12 21.23l8.84-8.84a5.5 5.5 0 0 0 0-7.78z"/></svg></button></div></article>
    <article class="card"><img src="https://images.unsplash.com/photo-1544441893-675973e31985?q=80&w=1200&auto=format&fit=crop" alt=""><div class="meta"><div><div class="t">Wool Crepe</div><div class="s">Saffron · 180 GSM</div></div><button class="heart" aria-label="Save"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" width="18" height="18"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 1 0-7.78 7.78L12 21.23l8.84-8.84a5.5 5.5 0 0 0 0-7.78z"/></svg></button></div></article>
  </div>
</main>

<footer role="contentinfo">
  <div class="footer-wrap">
    <div>© <span id="yr"></span> Hemline Market</div>
    <nav class="footer-links" aria-label="Footer">
      <a href="terms.html">Terms</a>
      <a href="privacy.html">Privacy</a>
      <a href="shipping.html">Shipping & Returns</a>
      <a href="contact.html">Contact</a>
    </nav>
  </div>
</footer>

<!-- Scrim + Panel -->
<div class="scrim" id="scrim" aria-hidden="true"></div>
<aside class="panel" id="filterPanel" role="dialog" aria-modal="true" aria-labelledby="filterTitle">
  <header><h3 id="filterTitle">Filters</h3></header>
  <div class="body">
    <details class="sect" open>
      <summary>Department</summary>
      <div class="inner row" id="p-dept"></div>
    </details>
    <details class="sect">
      <summary>Content</summary>
      <div class="inner row" id="p-content"></div>
    </details>
    <details class="sect">
      <summary>Color</summary>
      <div class="inner row" id="p-color"></div>
    </details>
    <details class="sect">
      <summary>Fabric Type</summary>
      <div class="inner row" id="p-fabric"></div>
    </details>
    <details class="sect">
      <summary>Pattern</summary>
      <div class="inner row" id="p-pattern"></div>
    </details>
    <details class="sect">
      <summary>Width (min/max)</summary>
      <div class="inner row" style="gap:8px">
        <input id="p-width-min" type="number" inputmode="numeric" placeholder="Min">
        <input id="p-width-max" type="number" inputmode="numeric" placeholder="Max">
      </div>
    </details>
    <details class="sect">
      <summary>Weight (GSM)</summary>
      <div class="inner row" style="gap:8px">
        <input id="p-gsm-min" type="number" inputmode="numeric" placeholder="Min">
        <input id="p-gsm-max" type="number" inputmode="numeric" placeholder="Max">
      </div>
    </details>
    <details class="sect">
      <summary>Country</summary>
      <div class="inner row" id="p-country"></div>
    </details>
    <details class="sect">
      <summary>Designer</summary>
      <div class="inner row" style="gap:8px">
        <input id="p-designer" placeholder="Free text">
      </div>
    </details>
    <details class="sect">
      <summary>Price ($/yd)</summary>
      <div class="inner row" style="gap:8px">
        <input id="p-price-min" type="number" inputmode="numeric" placeholder="Min">
        <input id="p-price-max" type="number" inputmode="numeric" placeholder="Max">
      </div>
    </details>
  </div>
  <div class="applybar">
    <button class="apply ghost" id="clear">Clear</button>
    <button class="apply" id="apply">Apply & Browse</button>
  </div>
</aside>

<script>
(function(){
  const $ = (q,el=document)=>el.querySelector(q);
  const $$ = (q,el=document)=>Array.from(el.querySelectorAll(q));
  const params = new URLSearchParams(location.search);

  // Favorites/alerts active state
  function syncActive(a,key){
    const on = localStorage.getItem(key)==='1';
    a.classList.toggle('active', on);
    a.addEventListener('click', e=>{
      e.preventDefault();
      const next = !(localStorage.getItem(key)==='1');
      localStorage.setItem(key, next?'1':'0');
      a.classList.toggle('active', next);
    });
  }
  syncActive($('#favBtn'), 'hm_favorites_on');
  syncActive($('#alertBtn'), 'hm_alerts_on');

  // Color list (restored set + Gold/Silver)
  const COLOR_LIST = [
    ['white','White'], ['cream','Cream'], ['beige','Beige'], ['camel','Camel'], ['tan','Tan'],
    ['yellow','Yellow'], ['orange','Orange'], ['rust','Rust'], ['red','Red'], ['burgundy','Burgundy'],
    ['pink','Pink'], ['blush','Blush'], ['lilac','Lilac'], ['purple','Purple'],
    ['blue','Blue'], ['navy','Navy'], ['teal','Teal'], ['green','Green'], ['olive','Olive'],
    ['brown','Brown'], ['grey','Grey'], ['charcoal','Charcoal'], ['black','Black'],
    ['gold','Gold'], ['silver','Silver']
  ];

  // Content options (parity with Browse)
  const CONTENT = ["Cashmere","Wool","Silk","Cotton","Linen","Bamboo","Alpaca","Rayon/Viscose","Polyester","Nylon"];

  // Other facets (for labels only—Home just builds links)
  const DEPTS = ["Atelier","Everyday","Kids","Sale"];
  const FABRIC_TYPES = ["Canvas","Chiffon","Corduroy","Crepe","Denim","Flannel","Georgette","Jersey","Lace","Lawn","Organza","Poplin","Sateen","Satin","Tulle","Twill","Velvet","Voile"];
  const PATTERNS = ["Solid","Printed"];
  const COUNTRIES = ["Italy","France","Japan","UK","USA","India","China","Korea"];

  // Build color swatches (with hover tips + gold/silver appearances)
  const colorRail = $('#colorRail');
  COLOR_LIST.forEach(([key,label])=>{
    const sw = document.createElement('button');
    sw.className = 'sw' + (key==='gold'?' gold': key==='silver'?' silver':'');
    if(!sw.classList.contains('gold') && !sw.classList.contains('silver')){
      const varName='--c-'+key;
      sw.style.background = getComputedStyle(document.documentElement).getPropertyValue(varName) || '#eee';
    }
    const tip = document.createElement('span'); tip.className='tip'; tip.textContent=label; sw.appendChild(tip);
    sw.addEventListener('click', ()=>{
      setParamMulti('color', key);
      goBrowse();
    });
    colorRail.appendChild(sw);
  });

  // Popular content chips
  const contentHost = $('#contentChips');
  CONTENT.forEach(v=>{
    const btn=document.createElement('button');
    btn.className='chip';
    btn.textContent=v;
    btn.addEventListener('click',()=>{ setParamMulti('content', normalize(v)); goBrowse(); });
    contentHost.appendChild(btn);
  });

  // Filter panel open/close
  const scrim = $('#scrim'), panel = $('#filterPanel');
  function openPanel(){ scrim.classList.add('on'); panel.classList.add('on'); scrim.setAttribute('aria-hidden','false'); document.addEventListener('keydown',trapTab); }
  function closePanel(){ scrim.classList.remove('on'); panel.classList.remove('on'); scrim.setAttribute('aria-hidden','true'); document.removeEventListener('keydown',trapTab); }
  $('#openFilters').addEventListener('click', openPanel);
  scrim.addEventListener('click', closePanel);
  document.addEventListener('keydown', e=>{ if(e.key==='Escape' && panel.classList.contains('on')) closePanel(); });

  // Only one <details> open at a time
  $$('.panel details summary').forEach(s=>{
    s.addEventListener('click', ()=>{
      const d=s.parentElement;
      if(!d.open){ $$('.panel details').forEach(o=>{ if(o!==d) o.open=false; }); }
    });
  });

  // Focus trap inside panel
  function trapTab(e){
    if(e.key!=='Tab') return;
    const f = panel.querySelectorAll('button,[href],input,summary,select,textarea,[tabindex]:not([tabindex="-1"])');
    const a = Array.from(f).filter(el=>!el.disabled && el.offsetParent!==null);
    const first=a[0], last=a[a.length-1];
    if(e.shiftKey && document.activeElement===first){ last.focus(); e.preventDefault(); }
    else if(!e.shiftKey && document.activeElement===last){ first.focus(); e.preventDefault(); }
  }

  // Build panel lists from arrays (kept DRY with Browse)
  function buildChips(arr, hostId, key){
    const host = document.getElementById(hostId);
    arr.forEach(v=>{
      const b=document.createElement('button');
      b.className='chip'; b.type='button';
      b.dataset.value = normalize(v);
      b.textContent=v;
      b.addEventListener('click', ()=>{ toggleMulti(key, b.dataset.value, b); });
      host.appendChild(b);
    });
  }
  buildChips(DEPTS, 'p-dept', 'department');
  buildChips(CONTENT, 'p-content', 'content');
  buildChips(FABRIC_TYPES, 'p-fabric', 'fabric_type');
  buildChips(PATTERNS, 'p-pattern', 'pattern');
  buildChips(COUNTRIES, 'p-country', 'country');

  // panel color buttons
  (function buildPanelColors(){
    const host = $('#p-color');
    COLOR_LIST.forEach(([key,label])=>{
      const b=document.createElement('button');
      b.className='chip'; b.dataset.value=key; b.textContent=label;
      b.addEventListener('click', ()=> toggleMulti('color', key, b));
      host.appendChild(b);
    });
  })();

  // helpers
  function normalize(v){ return v.toLowerCase().replace(/\s+/g,'_').replace(/\/.*/,'rayon'); }
  function getSet(k){ return new Set((params.get(k)||'').split(',').filter(Boolean)); }
  function writeSet(k,set){ if(set.size) params.set(k, Array.from(set).join(',')); else params.delete(k); }
  function toggleMulti(k,val,btn){ const set=getSet(k); if(set.has(val)) set.delete(val); else set.add(val); writeSet(k,set); btn?.setAttribute('data-on', set.has(val)?'true':'false'); }
  function setParamMulti(k,val){ const set=getSet(k); if(set.has(val)) set.delete(val); else set.add(val); writeSet(k,set); history.replaceState(null,'','?'+params.toString()); }
  function goBrowse(){
    const out = new URLSearchParams(params);
    const q = $('#q').value.trim(); if(q) out.set('q', q);
    location.href = 'browse.html' + (out.toString()?('?'+out.toString()):'');
  }

  // Hook Apply/Clear in panel
  $('#apply').addEventListener('click', goBrowse);
  $('#clear').addEventListener('click', ()=>{ location.href='browse.html'; });

  // Top chips open the panel at a specific section
  $$('.topchips .chip').forEach(ch=>{
    ch.addEventListener('click', ()=>{
      openPanel();
      const secId = 'p-'+ch.dataset.focus.replace('-','');
      const detailsMap = {
        'department':'p-dept','content':'p-content','color':'p-color','fabric-type':'p-fabric',
        'pattern':'p-pattern','width':'p-width-min','weight':'p-gsm-min','country':'p-country',
        'designer':'p-designer','price':'p-price-min'
      };
      // open only the selected details
      const labels = {'p-dept':0,'p-content':1,'p-color':2,'p-fabric':3,'p-pattern':4};
      $$('.panel details').forEach((d,i)=>{
        const wants = (detailsMap[ch.dataset.focus] || '').includes(d.querySelector('.inner')?.id) || i===labels[detailsMap[ch.dataset.focus]]; // best-effort
        d.open = wants;
      });
    });
  });

  // Search box → include in params upon Enter
  $('#q').addEventListener('keydown', e=>{ if(e.key==='Enter'){ setParamMulti('q',$('#q').value.trim()); goBrowse(); } });

  // Year
  $('#yr').textContent = new Date().getFullYear();
})();
</script>
</body>
</html>
