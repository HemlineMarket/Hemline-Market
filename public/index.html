<script>
// --- Search routing + pass filters to browse.html ---
(function () {
  function buildFilterQuery() {
    const p = new URLSearchParams();

    // Free-text query (keep as-is if you use it)
    const qEl = document.getElementById('searchQ');
    if (qEl && qEl.value.trim()) p.set('q', qEl.value.trim());

    // Content (checkboxes under the Content panel)
    const content = [...document.querySelectorAll('#panel-content input[type="checkbox"]:checked')]
      .map(el => (el.value || el.getAttribute('data-value') || '').trim())
      .filter(Boolean);
    if (content.length) p.set('content', content.join(','));

    // Color (selected swatches; works with title/data-name)
    const colors = [...document.querySelectorAll('#panel-color .sw[data-selected], #panel-color .sw[aria-pressed="true"]')]
      .map(n => (n.dataset.name || n.title || '').trim())
      .filter(Boolean);
    if (colors.length) p.set('colors', colors.join(','));

    // $/yard
    const minPrice = document.getElementById('minPrice')?.value;
    const maxPrice = document.getElementById('maxPrice')?.value;
    if (minPrice) p.set('minPrice', minPrice);
    if (maxPrice) p.set('maxPrice', maxPrice);

    // Yards
    const minYards = document.getElementById('minYards')?.value;
    if (minYards) p.set('minYards', minYards);

    // More (width/gsm)
    ['minWidth','maxWidth','minGsm','maxGsm'].forEach(id => {
      const v = document.getElementById(id)?.value;
      if (v) p.set(id, v);
    });

    // Selects
    [['dept','dept'],['fabricType','fabricType'],['fiberType','fiberType'],['origin','origin'],['pattern','pattern']]
      .forEach(([id,key]) => {
        const el = document.getElementById(id);
        if (el && el.value) p.set(key, el.value);
      });

    // Designer
    const designer = document.getElementById('designer')?.value?.trim();
    if (designer) p.set('designer', designer);

    return p.toString();
  }

  document.getElementById('homeSearch').addEventListener('submit', function (e) {
    e.preventDefault();
    const type = document.getElementById('searchType').value;
    const qs = buildFilterQuery();
    const base = (type === 'users') ? 'favorites.html' : 'browse.html';
    window.location.href = base + (qs ? ('?' + qs) : '');
  });
})();
</script>
