<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Shippo Rates Test</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;margin:24px}
    label{display:block;margin:8px 0 4px}
    input,select,button{height:38px;padding:0 10px;border:1px solid #d1d5db;border-radius:8px}
    input,select{width:280px}
    button{cursor:pointer;background:#991b1b;color:#fff;border:1px solid #991b1b;border-radius:999px;padding:0 16px}
    .row{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:8px}
    .rates{margin-top:16px;padding:12px;border:1px solid #e5e7eb;border-radius:12px}
    .rate{padding:8px 10px;border:1px solid #e5e7eb;border-radius:10px;margin:8px 0}
    .muted{color:#6b7280}
  </style>
</head>
<body>
  <h1>Shippo Rates Test</h1>
  <p class="muted">Enter a US address and click “Get rates”. Parcel defaults to <strong>12×9×2 in</strong>, <strong>1.0 lb</strong>.</p>

  <div class="row">
    <div>
      <label>Street 1</label>
      <input id="street1" value="1600 Pennsylvania Ave NW"/>
    </div>
    <div>
      <label>City</label>
      <input id="city" value="Washington"/>
    </div>
    <div>
      <label>State</label>
      <input id="state" value="DC"/>
    </div>
    <div>
      <label>ZIP</label>
      <input id="zip" value="20500"/>
    </div>
    <div>
      <label>Country</label>
      <select id="country"><option value="US" selected>US</option></select>
    </div>
  </div>

  <div class="row">
    <div>
      <label>Length (in)</label>
      <input id="len" type="number" step="0.1" value="12"/>
    </div>
    <div>
      <label>Width (in)</label>
      <input id="wid" type="number" step="0.1" value="9"/>
    </div>
    <div>
      <label>Height (in)</label>
      <input id="ht" type="number" step="0.1" value="2"/>
    </div>
    <div>
      <label>Weight (lb)</label>
      <input id="wt" type="number" step="0.1" value="1.0"/>
    </div>
  </div>

  <button id="go">Get rates</button>

  <div id="out" class="rates" hidden>
    <div id="list"></div>
  </div>

  <script>
    async function getRates() {
      const to = {
        name: "Customer",
        street1: document.getElementById('street1').value.trim(),
        city: document.getElementById('city').value.trim(),
        state: document.getElementById('state').value.trim(),
        zip: document.getElementById('zip').value.trim(),
        country: document.getElementById('country').value
      };
      const parcel = {
        length: parseFloat(document.getElementById('len').value),
        width: parseFloat(document.getElementById('wid').value),
        height: parseFloat(document.getElementById('ht').value),
        distance_unit: "in",
        weight: parseFloat(document.getElementById('wt').value),
        mass_unit: "lb"
      };

      const res = await fetch("/api/shippo-rates", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ to, parcel })
      });

      const out = document.getElementById('out');
      const list = document.getElementById('list');
      list.innerHTML = "";
      out.hidden = false;

      if (!res.ok) {
        const err = await res.json().catch(()=>({}));
        list.innerHTML = `<div class="rate">Error: ${err.error || res.status}</div>`;
        return;
        }

      const data = await res.json();
      if (!data.rates || !data.rates.length) {
        list.innerHTML = `<div class="rate">No rates returned.</div>`;
        return;
      }

      data.rates.forEach(r => {
        const div = document.createElement('div');
        div.className = 'rate';
        div.textContent = `${r.carrier} • ${r.service} — $${r.amount.toFixed(2)}${r.estimated_days ? ` • ${r.estimated_days}d` : ''}`;
        list.appendChild(div);
      });
    }

    document.getElementById('go').addEventListener('click', getRates);
  </script>
</body>
</html>
