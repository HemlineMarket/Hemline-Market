<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Fabric Listings</title>
  <style>
    :root { --ink:#0f172a; --line:#e5e7eb; --bg:#fafafa; --card:#ffffff; }
    body { font-family: system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif; margin:24px; background:var(--bg); color:var(--ink); }
    h1 { font-size:1.6rem; font-weight:800; margin:0 0 16px; }
    #listings { display:grid; grid-template-columns:1fr; gap:16px; max-width:820px; }
    .listing-card { background:var(--card); border:1px solid var(--line); border-radius:12px; overflow:hidden; box-shadow:0 2px 6px rgba(0,0,0,.06); }
    .imgwrap { background:#f3f4f6; }
    .imgwrap img { width:100%; height:200px; object-fit:cover; display:block; }
    .info { padding:12px; }
    .title { font-weight:700; margin:0 0 6px; }
    .price { font-weight:800; }
    .error { color:#d00; margin-top:12px; }
  </style>
</head>
<body>
  <h1>Fabric Listings</h1>
  <div id="listings"></div>
  <div id="empty" style="display:none;">No fabrics found.</div>
  <div id="error" class="error" style="display:none;">Error loading listings.</div>

  <!-- Supabase client -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    // Project credentials (working)
    const SUPABASE_URL = "https://clkizksbvxjkoatdajgd.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNsa2l6a3Nidnhqa29hdGRhamdkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2ODAyMDUsImV4cCI6MjA3MDI1NjIwNX0.m3wd6UAuqxa7BpcQof9mmzd8zdsmadwGDO0x7-nyBjI";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // Zero-DNS inline SVG placeholder (no external domain)
    const FALLBACK_IMG = 'data:image/svg+xml;utf8,' + encodeURIComponent(
      `<svg xmlns="http://www.w3.org/2000/svg" width="600" height="360">
        <rect width="100%" height="100%" fill="#eef2f7"/>
        <rect x="60" y="40" width="480" height="280" rx="12" fill="#e5e7eb"/>
        <text x="50%" y="52%" text-anchor="middle" fill="#94a3b8" font-family="system-ui,Segoe UI,Roboto,Arial" font-size="20">
          Hemline image placeholder
        </text>
      </svg>`
    );

    async function loadListings() {
      const { data, error } = await supabase
        .from("listings")
        .select("*")
        .order("created_at", { ascending: false });

      console.log("Supabase fetch result:", { data, error });

      const container = document.getElementById("listings");
      const emptyEl = document.getElementById("empty");
      const errEl = document.getElementById("error");

      if (error) { errEl.style.display = "block"; return; }
      if (!data || data.length === 0) { emptyEl.style.display = "block"; return; }

      container.innerHTML = "";
      data.forEach(item => {
        const card = document.createElement("div");
        card.className = "listing-card";

        const imgwrap = document.createElement("div");
        imgwrap.className = "imgwrap";
        const img = document.createElement("img");
        img.src = item.image_url || FALLBACK_IMG;
        img.alt = item.title || "Fabric";
        imgwrap.appendChild(img);

        const info = document.createElement("div");
        info.className = "info";
        const price = (Number(item.price_cents || 0) / 100).toFixed(2);
        info.innerHTML = `
          <div class="title">${item.title || "Untitled"}</div>
          <div class="price">$${price}</div>
        `;

        card.appendChild(imgwrap);
        card.appendChild(info);
        container.appendChild(card);
      });
    }

    loadListings();
  </script>
</body>
</html>
