<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Hemline â€” Listings</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 24px; background:#fafafa; color:#111; }
    h1 { font-size: 1.8em; margin-bottom: 12px; }
    #listings { display: grid; grid-template-columns: repeat(auto-fill,minmax(240px,1fr)); gap:16px; }
    .listing-card { border:1px solid #ddd; border-radius:8px; overflow:hidden; background:#fff; box-shadow:0 2px 5px rgba(0,0,0,0.08); }
    .listing-card img { width:100%; height:180px; object-fit:cover; display:block; }
    .info { padding:12px; }
    .title { font-size:1em; margin:0 0 6px; }
    .price { font-weight:bold; color:#333; }
    .error { color:#d00; margin-top:20px; }
  </style>
</head>
<body>
  <h1>Fabric Listings</h1>
  <div id="listings"></div>
  <div id="empty" style="display:none;">No fabrics found.</div>
  <div id="error" class="error" style="display:none;">Error loading listings.</div>

  <!-- Load Supabase client -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <script>
    // Correct project credentials for clkizksbvxjkoatdajgd.supabase.co
    const SUPABASE_URL = "https://clkizksbvxjkoatdajgd.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNsa2l6a3Nidnhqa29hdGRhamdkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2ODAyMDUsImV4cCI6MjA3MDI1NjIwNX0.m3wd6UAuqxa7BpcQof9mmzd8zdsmadwGDO0x7-nyBjI";

    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    async function loadListings() {
      const { data, error } = await supabase
        .from("listings")
        .select("*")
        .order("created_at", { ascending: false });

      console.log("Supabase fetch result:", { data, error });

      const container = document.getElementById("listings");
      const emptyEl = document.getElementById("empty");
      const errorEl = document.getElementById("error");

      if (error) {
        errorEl.style.display = "block";
        errorEl.textContent = "Error loading listings.";
        return;
      }
      if (!data || data.length === 0) {
        emptyEl.style.display = "block";
        return;
      }

      data.forEach(item => {
        const card = document.createElement("div");
        card.className = "listing-card";
        card.innerHTML = `
          <img src="${item.image_url || "https://via.placeholder.com/300x180?text=No+Image"}" alt="${item.title || "Fabric"}"/>
          <div class="info">
            <h3 class="title">${item.title || "Untitled"}</h3>
            <div class="price">$${(Number(item.price_cents || 0)/100).toFixed(2)}</div>
          </div>
        `;
        container.appendChild(card);
      });
    }

    loadListings();
  </script>
</body>
</html>
