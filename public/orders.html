<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Hemline — Orders</title>
  <style>
    :root { --ink:#0f172a; --bg:#fafafa; --card:#ffffff; --line:#e5e7eb; }
    body { font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif; margin:24px; background:var(--bg); color:var(--ink); }
    .wrap { max-width:800px; margin:auto; }
    .order { background:var(--card); border:1px solid var(--line); border-radius:12px; padding:16px; margin-bottom:16px; }
    .order h3 { margin-top:0; }
    .item { margin-left:16px; }
  </style>
</head>
<body>
  <div class="wrap">
    <a href="listings.html" style="display:inline-block;margin-bottom:20px;color:#0ea5e9;text-decoration:none;">
      ← Back to Listings
    </a>
    <h1>Your Orders</h1>
    <div id="orders"></div>
  </div>

  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

    const supabaseUrl = "https://clkizksbvxjkoatdajgd.supabase.co";
    const supabaseKey = "YOUR_SUPABASE_ANON_KEY";
    const supabase = createClient(supabaseUrl, supabaseKey);

    async function loadOrders() {
      const { data, error } = await supabase
        .from("orders")
        .select("*")
        .order("created_at", { ascending: false });

      const ordersDiv = document.getElementById("orders");
      ordersDiv.innerHTML = "";

      if (error) {
        ordersDiv.innerHTML = `<p style="color:red;">Error loading orders: ${error.message}</p>`;
        return;
      }

      if (!data || data.length === 0) {
        ordersDiv.innerHTML = "<p>No orders found.</p>";
        return;
      }

      data.forEach((order, idx) => {
        const div = document.createElement("div");
        div.className = "order";
        const date = order.created_at ? new Date(order.created_at).toLocaleString() : "Unknown date";
        div.innerHTML = `<h3>Order #${idx + 1} — ${date}</h3>`;

        try {
          const items = order.items || [];
          items.forEach(it => {
            div.innerHTML += `<div class="item">- ${it.title} — $${it.price}</div>`;
          });
        } catch {
          div.innerHTML += `<div class="item">(No items found)</div>`;
        }

        ordersDiv.appendChild(div);
      });
    }

    loadOrders();
  </script>
</body>
</html>
