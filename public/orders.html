<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Hemline — Orders</title>
  <style>
    :root { --ink:#0f172a; --bg:#fafafa; --card:#ffffff; --line:#e5e7eb; }
    body { font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif; margin:24px; background:var(--bg); color:var(--ink); }
    .wrap { max-width:800px; margin:auto; }
    .order { background:var(--card); border:1px solid var(--line); border-radius:12px; margin-bottom:16px; overflow:hidden; }
    .order h3 { margin:0; padding:16px; cursor:pointer; background:#f3f4f6; }
    .details { display:none; padding:16px; }
    .item { margin-left:16px; }
  </style>
</head>
<body>
  <div class="wrap">
    <a href="listings.html" style="display:inline-block;margin-bottom:20px;color:#0ea5e9;text-decoration:none;">
      ← Back to Listings
    </a>
    <h1>Your Orders</h1>
    <div id="orders"></div>
  </div>

  <script>
    const SUPABASE_URL = "https://clkizksbvxjkoatdajgd.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNsa2l6a3Nidnhqa29hdGRhamdkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjM4MDE1ODIsImV4cCI6MjAzOTM3NzU4Mn0.MEu0Ex0bTtVnNuB-tAek95UbwsKdbWipzJrN84aKhlg";

    async function loadOrders() {
      const res = await fetch(`${SUPABASE_URL}/rest/v1/orders?select=*`, {
        headers: {
          apikey: SUPABASE_KEY,
          Authorization: `Bearer ${SUPABASE_KEY}`
        }
      });

      const data = await res.json();
      const ordersDiv = document.getElementById("orders");
      ordersDiv.innerHTML = "";

      if (data.length === 0) {
        ordersDiv.innerHTML = "<p>No orders found.</p>";
        return;
      }

      data.forEach((order, idx) => {
        const container = document.createElement("div");
        container.className = "order";

        const date = order.created_at ? new Date(order.created_at).toLocaleString() : "Unknown date";
        const header = document.createElement("h3");
        header.textContent = `Order #${idx + 1} — ${date}`;

        const details = document.createElement("div");
        details.className = "details";

        try {
          const items = order.items || [];
          items.forEach(it => {
            details.innerHTML += `<div class="item">- ${it.title} — $${it.price}</div>`;
          });
        } catch {
          details.innerHTML = `<div class="item">(No items found)</div>`;
        }

        header.addEventListener("click", () => {
          details.style.display = details.style.display === "block" ? "none" : "block";
        });

        container.appendChild(header);
        container.appendChild(details);
        ordersDiv.appendChild(container);
      });
    }

    loadOrders();
  </script>
</body>
</html>
