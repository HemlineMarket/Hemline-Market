<!doctype html><html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Hemline — Orders</title>
<style>:root{--ink:#0f172a;--bg:#fafafa;--card:#fff;--line:#e5e7eb;--accent:#0ea5e9}body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;margin:24px;background:var(--bg);color:var(--ink)}.wrap{max-width:820px;margin:auto}.box{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:18px;margin-bottom:20px;box-shadow:0 2px 6px rgba(0,0,0,.05)}.hdr{font-size:1.2rem;margin-bottom:6px}.meta{color:#475569;font-size:.9rem}.item{display:flex;align-items:center;gap:10px;margin:6px 0}.thumb{width:44px;height:44px;object-fit:cover;border-radius:6px;border:1px solid var(--line)}.amt{margin-left:auto}.link{color:var(--accent);text-decoration:none}</style></head>
<body><div class="wrap"><h1>Your Orders</h1><div id="list"></div><p><a class="link" href="listings.html">← Back to Listings</a></p></div>
<script>
const SUPABASE_URL="https://clkizksbvxjkoatdajgd.supabase.co";
const SUPABASE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNsa2l6a3Nidnhqa29hdGRhamdkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjM4MDE1ODIsImV4cCI6MjAzOTM3NzU4Mn0.MEu0Ex0bTtVnNuB-tAek95UbwsKdbWipzJrN84aKhlg";
const PH="https://via.placeholder.com/80?text=Fabric";
const $=id=>document.getElementById(id);

(async function(){
  let orders=[];
  try{
    const res=await fetch(`${SUPABASE_URL}/rest/v1/orders?select=*`,{headers:{apikey:SUPABASE_KEY,Authorization:`Bearer ${SUPABASE_KEY}`}});
    if(res.ok){const rows=await res.json();rows.forEach(r=>orders.push({id:r.id,when:r.created_at,items:r.items,subtotal:r.subtotal}));}
  }catch(e){console.warn("Supabase load failed",e);}
  const local=JSON.parse(localStorage.getItem("hem_orders")||"[]"); orders=[...local,...orders];
  const seen=new Set; orders=orders.filter(o=>{if(seen.has(o.id))return false;seen.add(o.id);return true});
  $("list").innerHTML="";
  if(!orders.length){$("list").innerHTML="<p>No orders yet.</p>";return}
  orders.forEach(o=>{const box=document.createElement("div");box.className="box";
    const when=new Date(o.when||Date.now()).toLocaleString();
    box.innerHTML=`<div class="hdr">Order #${o.id}</div><div class="meta">${when}</div>`;
    (o.items||[]).forEach(it=>{const q=+it.qty||1,p=+it.price||0; const row=document.createElement("div");row.className="item";
      row.innerHTML=`<img class="thumb" src="${it.img||PH}" onerror="this.src='${PH}'"><div>${it.title||"Fabric"} <span class="meta">x${q}</span></div><div class="amt">$${(q*p).toFixed(2)}</div>`;box.appendChild(row);});
    const sum=o.subtotal||((o.items||[]).reduce((a,b)=>a+(+b.price||0)*(+b.qty||1),0));
    const tot=document.createElement("div");tot.className="amt";tot.style.fontWeight="700";tot.textContent="Subtotal: $"+sum.toFixed(2);box.appendChild(tot);
    $("list").appendChild(box);});
})();
</script></body></html>
