<!doctype html><html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Hemline — Cart</title>
<style>
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;margin:24px;background:#fafafa;color:#0f172a}
.wrap{max-width:900px;margin:auto}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px}
.card{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:14px;box-shadow:0 2px 6px rgba(0,0,0,.05)}
.thumb{width:100%;height:170px;object-fit:cover;border-radius:8px;margin:0 0 10px;background:#f1f5f9}
.row{display:flex;justify-content:space-between;align-items:center;gap:8px}.title{font-weight:600}
.btn{border:1px solid #e5e7eb;background:#fff;border-radius:10px;padding:6px 10px;cursor:pointer}
.cta{background:#0ea5e9;color:#fff;border:none;border-radius:12px;padding:10px 16px;font-weight:600;cursor:pointer}
.cta:disabled{opacity:.5;cursor:not-allowed}
.empty{border:2px dashed #e5e7eb;border-radius:12px;padding:24px;text-align:center;color:#475569}
.sum{margin:16px 0;padding:12px;background:#fff;border:1px solid #e5e7eb;border-radius:12px;display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap}
.link{color:#0ea5e9;text-decoration:none}
</style></head>
<body>
<div class="wrap">
  <a class="link" href="listings.html">← Back to Listings</a>
  <h1>Your Cart</h1>
  <div id="cartGrid" class="grid"></div>
  <div id="emptyMsg" class="empty" hidden>Cart is empty. <a class="link" href="listings.html">Continue shopping →</a></div>

  <div class="sum" id="summary" hidden>
    <strong>Subtotal: <span id="subtotal">$0.00</span></strong>
    <div style="display:flex;gap:10px">
      <button id="placeBtn" class="cta" disabled>Place Order</button>
      <button id="clearBtn" class="btn">Remove all</button>
      <a class="btn" href="orders.html">View Orders</a>
    </div>
  </div>
</div>

<script>
/* Config (keys included) */
const SUPABASE_URL="https://clkizksbvxjkoatdajgd.supabase.co";
const SUPABASE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNsa2l6a3Nidnhqa29hdGRhamdkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjM4MDE1ODIsImV4cCI6MjAzOTM3NzU4Mn0.MEu0Ex0bTtVnNuB-tAek95UbwsKdbWipzJrN84aKhlg";
const KEY="hem_cart",PH="https://via.placeholder.com/600x400?text=Fabric";
const $=id=>document.getElementById(id),fmt=n=>`$${n.toFixed(2)}`;
const read=()=>{try{return JSON.parse(localStorage.getItem(KEY)||"[]")}catch(e){return[]}}, save=a=>localStorage.setItem(KEY,JSON.stringify(a||[]));

/* Render cart with qty/remove */
function render(){
  const cart=read(),grid=$("cartGrid"),empty=$("emptyMsg"),sumBox=$("summary"),subEl=$("subtotal"),place=$("placeBtn");
  grid.innerHTML=""; let subtotal=0;
  if(!cart.length){empty.hidden=false;sumBox.hidden=true;return}
  empty.hidden=true;sumBox.hidden=false;
  cart.forEach((it,i)=>{const line=(+it.price||0)*(+it.qty||1); subtotal+=line;
    const c=document.createElement("div"); c.className="card";
    c.innerHTML=`<img class="thumb" src="${it.img||PH}" alt="">
      <div class="title">${it.title||"Fabric"}</div>
      <div class="row"><span>Price/yd</span><strong>${fmt(+it.price||0)}</strong></div>
      <div class="row"><span>Yards</span>
        <div><button class="btn" data-a="dec" data-i="${i}">−</button>
        <strong style="margin:0 8px">${it.qty||1}</strong>
        <button class="btn" data-a="inc" data-i="${i}">+</button></div></div>
      <div class="row"><span>Line total</span><strong>${fmt(line)}</strong></div>
      <div class="row"><span></span><button class="btn" data-a="rm" data-i="${i}">Remove</button></div>`;
    grid.appendChild(c);
  });
  subEl.textContent=fmt(subtotal); place.disabled=!(subtotal>0);
  grid.onclick=e=>{const b=e.target.closest("button"); if(!b)return; let c=read(),i=+b.dataset.i,a=b.dataset.a;
    if(a==="inc")c[i].qty=(+c[i].qty||1)+1; else if(a==="dec")c[i].qty=Math.max(1,(+c[i].qty||1)-1); else if(a==="rm")c.splice(i,1);
    save(c); render();
  };
  $("clearBtn").onclick=()=>{save([]);render()};
}
render();

/* Place Order → save to Supabase.orders then redirect to orders.html */
$("placeBtn").onclick=async()=>{
  const items=read(); if(!items.length) return;
  const payload={items:items, created_at:new Date().toISOString()};
  const res=await fetch(`${SUPABASE_URL}/rest/v1/orders`,{
    method:"POST",
    headers:{apikey:SUPABASE_KEY,Authorization:`Bearer ${SUPABASE_KEY}`,"Content-Type":"application/json",Prefer:"return=representation"},
    body:JSON.stringify(payload)
  });
  if(res.ok){localStorage.removeItem(KEY); window.location.href="orders.html";}
  else{alert("Error placing order.");}
};
</script>
</body></html>
