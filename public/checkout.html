<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Checkout — Hemline Market</title>

  <link rel="stylesheet" href="styles/hm-modern.css"/>
  <link rel="stylesheet" href="styles/hem-header.css"/>
  <link rel="stylesheet" href="styles/hm-footer.css"/>

  <style>
    :root{ --ink:#111827; --muted:#6b7280; --border:#e5e7eb; --accent:#991b1b; }
    body{ margin:0; background:#fafafa; color:var(--ink); font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif }
    .hm-header{min-height:56px;background:#fff;border-bottom:1px solid var(--border)}
    .hm-header .wrap{max-width:1200px;margin:0 auto;padding:0 12px;display:flex;align-items:center;justify-content:space-between}
    .hm-brand{font-size:24px;font-weight:800;color:var(--accent);text-decoration:none}

    .container{max-width:1100px;margin:20px auto;padding:0 12px;display:grid;grid-template-columns:1fr 360px;gap:18px}
    @media(max-width:900px){.container{grid-template-columns:1fr}}
    .card{background:#fff;border:1px solid var(--border);border-radius:12px;padding:14px}
    h1{margin:0 0 12px}
    h2{margin:0 0 10px;font-size:18px}
    label{display:block;margin:6px 0 6px;color:#374151;font-weight:600;font-size:13px}
    input{height:40px;border:1px solid var(--border);border-radius:10px;padding:0 12px;width:100%;background:#fff}
    .row{display:flex;gap:10px}
    .row>*{flex:1}
    .help{color:var(--muted);font-size:12px;margin-top:6px}

    .item{display:flex;gap:12px;align-items:center;justify-content:space-between;margin:8px 0}
    .muted{color:var(--muted)}
    .line{height:1px;background:var(--border);margin:12px 0}
    .total{display:flex;justify-content:space-between;margin-top:4px}
    .grand{font-weight:800;font-size:18px}
    .btn{display:inline-flex;align-items:center;justify-content:center;height:42px;padding:0 16px;border-radius:999px;border:1px solid transparent;background:var(--accent);color:#fff;text-decoration:none;font-weight:700;cursor:pointer}
    .btn[disabled]{opacity:.6;cursor:not-allowed}
    .btn-outline{background:#fff;color:var(--accent);border:1px solid var(--border)}
    .banner{background:#ecfdf5;border:1px solid #bbf7d0;color:#065f46;border-radius:10px;padding:10px;margin:0 0 12px}
    .banner.empty{background:#fff7ed;border-color:#fed7aa;color:#9a3412}
  </style>
</head>
<body>

<header class="hm-header" role="banner">
  <div class="wrap">
    <a class="hm-brand" href="index.html">Hemline Market</a>
  </div>
</header>

<main class="container">
  <!-- LEFT: Contact & Shipping form (non-blocking; saved locally for convenience) -->
  <section class="card">
    <h1>Checkout</h1>

    <div id="banner" class="banner" role="status" aria-live="polite" style="display:none"></div>

    <h2>Contact & Shipping</h2>
    <div class="row">
      <div>
        <label for="email">Email</label>
        <input id="email" type="email" placeholder="you@example.com" autocomplete="email" inputmode="email">
      </div>
      <div>
        <label for="phone">Phone (optional)</label>
        <input id="phone" type="tel" placeholder="(555) 555-5555" autocomplete="tel">
      </div>
    </div>

    <div class="row" style="margin-top:10px">
      <div>
        <label for="addr1">Address line 1</label>
        <input id="addr1" placeholder="Street address" autocomplete="address-line1">
      </div>
    </div>

    <div class="row" style="margin-top:10px">
      <div>
        <label for="addr2">Address line 2 (optional)</label>
        <input id="addr2" placeholder="Apt, suite, etc." autocomplete="address-line2">
      </div>
    </div>

    <div class="row" style="margin-top:10px">
      <div>
        <label for="city">City</label>
        <input id="city" placeholder="City" autocomplete="address-level2">
      </div>
      <div>
        <label for="state">State</label>
        <input id="state" placeholder="State" autocomplete="address-level1">
      </div>
      <div>
        <label for="zip">ZIP</label>
        <input id="zip" placeholder="ZIP" autocomplete="postal-code" inputmode="numeric">
      </div>
    </div>

    <p class="help">Shipping label is generated after payment. You’ll confirm card details on the next step.</p>

    <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:8px">
      <a class="btn-outline" href="cart.html">Back to cart</a>
      <button id="next" class="btn">Continue to payment</button>
    </div>
  </section>

  <!-- RIGHT: Order summary (live from cart) -->
  <aside class="card">
    <h2>Order summary</h2>
    <div id="order-items"></div>
    <div class="line"></div>
    <div class="total"><span>Subtotal</span><span id="sub">$0.00</span></div>
    <div class="total"><span>Shipping</span><span id="ship">$0.00</span></div>
    <div class="total"><span>Tax</span><span class="muted">Calculated at payment</span></div>
    <div class="line"></div>
    <div class="total grand"><span>Total</span><span id="tot">$0.00</span></div>
  </aside>
</main>

<footer class="hm-footer" role="contentinfo" style="margin-top:18px">
  <div class="footer-wrap">
    <div class="copy">© 2025 Hemline Market</div>
    <nav class="footer-links" aria-label="Footer">
      <a href="about.html">About</a>
      <a href="faq.html">FAQ</a>
      <a href="contact.html">Contact</a>
      <a href="terms.html">Terms</a>
      <a href="privacy.html">Privacy</a>
    </nav>
  </div>
</footer>

<script>
(function(){
  const fmt = c => "$" + (Math.max(0,c)/100).toFixed(2);

  // Same shipping tiers used everywhere
  function tierCents(yards){ if(yards < 3) return 500; if(yards <= 10) return 800; return 1500; }
  function yardsForItem(it){
    const qty = Number(it.qty || 1);
    if (it.yards !== undefined && it.yards !== null && it.yards !== "") {
      return (Number(it.yards)||0) * qty;
    }
    return qty; // fallback: qty == yards
  }
  function calcTotals(cart){
    let subtotal = 0;
    const groups = {};
    for(const it of cart){
      subtotal += (Number(it.amount||0) * Number(it.qty||1));
      const sellerId = it.sellerId || "default_seller";
      const name = it.sellerName || "Seller";
      const yards = yardsForItem(it);
      if(!groups[sellerId]) groups[sellerId] = { name, yards:0 };
      groups[sellerId].yards += yards;
    }
    const shipping = Object.values(groups).reduce((s,g)=>s + tierCents(g.yards), 0);
    return { subtotal, shipping, total: subtotal + shipping, groups };
  }

  const itemsEl = document.getElementById("order-items");
  const subEl = document.getElementById("sub");
  const shipEl = document.getElementById("ship");
  const totEl = document.getElementById("tot");
  const nextBtn = document.getElementById("next");
  const banner = document.getElementById("banner");

  // Load cart + render
  function render(){
    const cart = JSON.parse(localStorage.getItem("hm_cart") || "[]");
    itemsEl.innerHTML = "";
    if(cart.length === 0){
      subEl.textContent = fmt(0);
      shipEl.textContent = fmt(0);
      totEl.textContent = fmt(0);
      nextBtn.disabled = true;
      banner.textContent = "Your cart is empty — add fabric to continue.";
      banner.className = "banner empty";
      banner.style.display = "block";
      return;
    }

    // has items
    nextBtn.disabled = false;
    banner.textContent = "Cart has items — ready to check out.";
    banner.className = "banner";
    banner.style.display = "block";

    for(const it of cart){
      const line = (Number(it.amount||0) * Number(it.qty||1));
      const yardsPart = (it.yards!==undefined && it.yards!==null && it.yards!=='') ? ` · ${it.yards} yd` : "";
      const row = document.createElement("div");
      row.className = "item";
      row.innerHTML = `<span>${(it.name||"Item")}${yardsPart}</span><span>${fmt(line)}</span>`;
      itemsEl.appendChild(row);
    }

    const t = calcTotals(cart);
    subEl.textContent = fmt(t.subtotal);
    shipEl.textContent = fmt(t.shipping);
    totEl.textContent = fmt(t.total);

    // Save a light summary for payment page convenience (optional)
    localStorage.setItem("hm_checkout_preview", JSON.stringify({ subtotal:t.subtotal, shipping:t.shipping, total:t.total }));
  }

  // Persist form values locally (optional UX nicety)
  function bindPersist(id, key){
    const el = document.getElementById(id);
    try{ const v = localStorage.getItem(key); if(v) el.value = v; }catch(_){}
    el.addEventListener("input", ()=>{ try{ localStorage.setItem(key, el.value); }catch(_){ } });
  }
  ["email","phone","addr1","addr2","city","state","zip"].forEach(id=>bindPersist(id, "hm_chk_"+id));

  nextBtn.addEventListener("click", ()=>{
    // just go to payment; email is passed to PI there
    window.location.href = "payment.html";
  });

  render();
})();
</script>
</body>
</html>
