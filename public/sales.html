<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Your Sales — Hemline Market</title>

  <link rel="icon" href="/favicon.ico" type="image/x-icon"/>

  <!-- Shared styles -->
  <link rel="stylesheet" href="styles/hm-modern.css"/>
  <link rel="stylesheet" href="styles/hm-header.css"/>
  <link rel="stylesheet" href="styles/hm-typography.css"/>
  <link rel="stylesheet" href="styles/hm-footer.css"/>

  <style>
    :root{
      --hm-accent:#991b1b;
      --hm-border:#e5e7eb;
      --hm-muted:#6b7280;
      --hm-text:#111827;
      --hm-bg:#f4f4f7;
    }

    html,body{
      margin:0;
      background:var(--hm-bg);
      color:var(--hm-text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
    }

    main{
      max-width:1100px;
      margin:24px auto 40px;
      padding:0 14px;
    }

    h1{
      font-size:24px;
      margin:0 0 4px;
    }

    .sub{
      color:var(--hm-muted);
      margin-bottom:18px;
    }

    .sale-card{
      background:#fff;
      border:1px solid var(--hm-border);
      border-radius:14px;
      padding:14px;
      display:grid;
      grid-template-columns:96px 1fr auto;
      gap:14px;
      align-items:center;
    }

    .sale-thumb-link{
      display:block;
      text-decoration:none;
    }

    .sale-thumb{
      width:96px;
      height:96px;
      border-radius:10px;
      overflow:hidden;
      background:#f3f4f6;
      border:1px solid var(--hm-border);
      display:grid;
      place-items:center;
    }

    .sale-thumb img{
      width:100%;
      height:100%;
      object-fit:cover;
    }

    .sale-thumb-placeholder{
      width:100%;
      height:100%;
      background:linear-gradient(180deg,#f9fafb,#e5e7eb);
    }

    .sale-main{
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width:0;
    }

    .sale-title{
      font-weight:700;
      font-size:15px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .sale-meta{
      font-size:13px;
      color:var(--hm-muted);
      display:flex;
      flex-wrap:wrap;
      gap:10px;
    }

    .pill{
      font-size:11px;
      font-weight:700;
      padding:2px 8px;
      border-radius:999px;
      background:#f3f4f6;
      color:#374151;
    }

    .sale-actions{
      display:flex;
      flex-direction:column;
      gap:8px;
      align-items:flex-end;
    }

    .price{
      font-weight:700;
      text-align:right;
      font-size:14px;
    }

    .muted{
      font-size:12px;
      color:var(--hm-muted);
      text-align:right;
    }

    select{
      padding:7px 10px;
      border-radius:10px;
      border:1px solid var(--hm-border);
      background:#fff;
      font-size:13px;
    }

    .danger-btn{
      padding:8px 12px;
      border-radius:10px;
      border:1px solid var(--hm-accent);
      background:var(--hm-accent);
      color:#fff;
      font-weight:700;
      cursor:pointer;
      font-size:13px;
    }

    @media(max-width:720px){
      .sale-card{
        grid-template-columns:72px 1fr;
        gap:12px;
      }
      .sale-actions{
        grid-column:1 / -1;
        flex-direction:row;
        justify-content:space-between;
        align-items:center;
      }
      .price,.muted{text-align:left;}
    }
  </style>
</head>
<body>

  <!-- Universal header -->
  <div id="hm-shell-header"></div>

  <main>
    <h1>Your Sales</h1>
    <div class="sub">Fabric buyers purchased from your listings.</div>

    <div id="salesList"></div>
  </main>

  <!-- Universal footer -->
  <div id="hm-shell-footer"></div>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="scripts/hm-shell.js"></script>

  <script>
    window.HM && window.HM.renderShell({ currentPage: "sales" });
  </script>

  <script>
    const supabase = window.supabase.createClient(
      "https://clkizksbvxjkoatdajgd.supabase.co",
      "YOUR_PUBLIC_ANON_KEY"
    );

    function money(cents){
      return (cents/100).toLocaleString("en-US",{style:"currency",currency:"USD"});
    }

    async function loadSales(){
      const wrap = document.getElementById("salesList");
      wrap.innerHTML = "";

      const { data, error } = await supabase
        .from("orders")
        .select(`
          id,
          created_at,
          buyer_email,
          total_cents,
          shipping_cents,
          listing_id,
          listing_snapshot
        `)
        .order("created_at",{ascending:false});

      if(error){
        wrap.textContent = "Error loading sales.";
        return;
      }

      if(!data.length){
        wrap.textContent = "No sales yet.";
        return;
      }

      data.forEach(o=>{
        const snap = o.listing_snapshot || {};
        const img  = snap.image_url_1 || "";
        const title = snap.title || "Listing";
        const yards = snap.qty || "";
        const href = "listing.html?id=" + o.listing_id;

        const card = document.createElement("div");
        card.className = "sale-card";

        card.innerHTML = `
          <a class="sale-thumb-link" href="${href}">
            <div class="sale-thumb">
              ${img ? `<img src="${img}" alt="${title}">` : `<div class="sale-thumb-placeholder"></div>`}
            </div>
          </a>

          <div class="sale-main">
            <div class="sale-title">${title}</div>
            <div class="sale-meta">
              <span class="pill">PAID</span>
              ${yards ? `<span>${yards} yards</span>` : ""}
              <span>Sold · ${new Date(o.created_at).toLocaleDateString()}</span>
              <span>Buyer: ${o.buyer_email}</span>
            </div>
          </div>

          <div class="sale-actions">
            <div class="price">${money(o.total_cents)} for ${yards} yards</div>
            <div class="muted">${money(o.shipping_cents)} shipping · ${money(o.total_cents)} total</div>
            <select>
              <option>Cancel reason…</option>
              <option>Buyer request</option>
              <option>Out of stock</option>
              <option>Damage discovered</option>
            </select>
            <button class="danger-btn">Cancel order</button>
          </div>
        `;

        wrap.appendChild(card);
      });
    }

    document.addEventListener("DOMContentLoaded", loadSales);
  </script>

</body>
</html>
