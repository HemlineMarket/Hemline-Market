<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Sales — Hemline Market</title>

  <link rel="stylesheet" href="styles/hm-modern.css"/>
  <link rel="stylesheet" href="styles/hm-header.css"/>
  <link rel="stylesheet" href="styles/hm-typography.css"/>
  <link rel="stylesheet" href="styles/hm-footer.css"/>
  <link rel="icon" href="/favicon.ico" type="image/x-icon"/>

  <style>
    :root{
      --hm-accent:#991b1b;
      --hm-border:#e5e7eb;
      --hm-muted:#6b7280;
      --hm-text:#111827;
      --hm-bg:#f4f4f7;
    }

    body{
      margin:0;
      background:var(--hm-bg);
      color:var(--hm-text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      -webkit-font-smoothing:antialiased;
    }

    main{
      max-width:1100px;
      margin:18px auto 40px;
      padding:0 12px;
    }

    h1{
      font-size:26px;
      font-weight:800;
      margin:0 0 6px;
    }

    .subtitle{
      font-size:14px;
      color:var(--hm-muted);
      margin-bottom:20px;
    }

    .order-list{
      display:flex;
      flex-direction:column;
      gap:14px;
    }

    .order-card{
      background:#fff;
      border:1px solid var(--hm-border);
      border-radius:14px;
      padding:16px;
      box-shadow:0 6px 18px rgba(15,23,42,.06);
    }

    .order-header{
      font-size:14px;
      font-weight:700;
      margin-bottom:6px;
    }

    .order-meta{
      font-size:13px;
      color:var(--hm-muted);
      margin-bottom:10px;
    }

    .order-actions{
      display:flex;
      gap:8px;
    }

    .btn{
      padding:8px 12px;
      border-radius:999px;
      border:1px solid var(--hm-border);
      background:#fff;
      font-size:13px;
      font-weight:600;
      cursor:pointer;
      text-decoration:none;
      display:inline-block;
    }

    .empty{
      text-align:center;
      color:var(--hm-muted);
      margin-top:40px;
      font-size:14px;
    }
  </style>
</head>
<body>

  <div id="hm-shell-header"></div>

  <main>
    <h1>Sales</h1>
    <p class="subtitle">Manage orders for fabric you've sold.</p>

    <div id="salesList" class="order-list"></div>
    <p id="emptyState" class="empty" style="display:none;">No sales yet.</p>
  </main>

  <div id="hm-shell-footer"></div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="scripts/hm-shell.js"></script>

  <script>
    const supabase = window.HM.supabase;

    async function loadSales(){
      const sessionRes = await supabase.auth.getSession();
      const user = sessionRes?.data?.session?.user;
      if(!user){
        document.getElementById("emptyState").innerText = "Sign in to view your sales.";
        document.getElementById("emptyState").style.display = "block";
        return;
      }

      let { data, error } = await supabase
        .from("orders")
        .select(`
          id,
          listing_id,
          buyer_id,
          status,
          created_at,
          listings (
            title,
            price,
            cover_url
          )
        `)
        .eq("seller_id", user.id)
        .order("created_at", { ascending:false });

      const list = document.getElementById("salesList");
      const empty = document.getElementById("emptyState");

      if(error || !data || data.length === 0){
        empty.style.display = "block";
        return;
      }

      empty.style.display = "none";

      list.innerHTML = "";

      data.forEach(order => {
        const li = document.createElement("div");
        li.className = "order-card";

        const listing = order.listings || {};
        const title = listing.title || "Untitled";
        const price = listing.price ? `$${listing.price}` : "";
        const date = new Date(order.created_at).toLocaleDateString();

        li.innerHTML = `
          <div class="order-header">${title}</div>
          <div class="order-meta">
            ${price} · ${date}<br>
            Status: ${order.status || "Processing"}
          </div>

          <div class="order-actions">
            <a class="btn" href="listing.html?id=${order.listing_id}">View listing</a>
            <a class="btn" href="order.html?id=${order.id}">Order details</a>
          </div>
        `;

        list.appendChild(li);
      });
    }

    loadSales();
  </script>

  <script>
    window.HM && window.HM.renderShell({ currentPage:"sales" });
  </script>
</body>
</html>
