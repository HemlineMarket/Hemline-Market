<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>

  <title>Browse Fabrics — Hemline Market</title>
  <meta name="description" content="Explore curated fabrics and handmade sewing items from independent sellers on Hemline Market."/>
  <link rel="canonical" href="https://www.hemlinemarket.com/browse.html"/>

  <!-- Open Graph -->
  <meta property="og:type" content="website"/>
  <meta property="og:url" content="https://www.hemlinemarket.com/browse.html"/>
  <meta property="og:title" content="Browse Fabrics — Hemline Market"/>
  <meta property="og:description" content="Explore curated fabrics and handmade sewing items from independent sellers."/>
  <meta property="og:image" content="https://www.hemlinemarket.com/comingsoon.jpg"/>

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:title" content="Browse Fabrics — Hemline Market"/>
  <meta name="twitter:description" content="Explore curated fabrics and handmade sewing items from independent sellers."/>
  <meta name="twitter:image" content="https://www.hemlinemarket.com/comingsoon.jpg"/>

  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="/css/tokens.css">
  <link rel="stylesheet" href="/css/main.css">
  <style>
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px}
    .card img{width:100%;height:160px;object-fit:cover;border-radius:10px;border:1px solid #e5e7eb}
    .badge{display:inline-block;font-size:11px;padding:2px 8px;border:1px solid #e2e8f0;border-radius:999px;background:#f1f5f9}
    .warn{border:1px solid #f59e0b;background:#fffbeb;color:#92400e;padding:12px 14px;border-radius:10px}
  </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar" aria-label="Primary">
  <div>
    <a href="/index.html"><strong>Hemline</strong></a>
  </div>
  <div>
    <a href="/browse.html" aria-current="page">Browse</a>
    <a href="/seller.html">Seller</a>
    <a href="/orders.html">Orders</a>
    <a href="/checkout.html">Checkout</a>
  </div>
</nav>

<main class="container-md" id="main">
  <h1>Browse Fabrics</h1>
  <p class="muted">Explore curated fabrics and handmade sewing items. (Filters arrive in Phase 2.)</p>

  <div id="envWarn" class="warn" style="display:none;margin-bottom:12px"></div>

  <div id="list" class="grid" aria-live="polite"></div>
</main>

<!-- Footer -->
<footer class="container-md mt-7">
  <div class="card cluster items-center justify-between gap-4">
    <p class="muted m-0">© <span id="y"></span> Hemline Market</p>
    <div class="cluster">
      <a class="btn" href="/about.html">About</a>
      <a class="btn" href="/contact.html">Contact</a>
      <a class="btn" href="/faq.html">FAQ</a>
      <a class="btn" href="/privacy.html">Privacy</a>
      <a class="btn" href="/terms.html">Terms</a>
      <a class="btn" href="/shipping.html">Shipping</a>
      <a class="btn" href="/returns.html">Returns</a>
    </div>
  </div>
  <script>document.getElementById("y").textContent = new Date().getFullYear();</script>
</footer>

<!-- Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<!-- Your env should define window.HEMLINE_ENV = { SUPABASE_URL:"...", SUPABASE_ANON_KEY:"..." } -->
<script src="/js/env.js"></script>
<script>
(function(){
  const list = document.getElementById('list');
  const warn = document.getElementById('envWarn');

  const env = (window.HEMLINE_ENV||{});
  const url = env.SUPABASE_URL;
  const key = env.SUPABASE_ANON_KEY;

  if(!url || !key){
    warn.style.display='block';
    warn.textContent = 'Note: Supabase keys are not configured yet, so demo items are shown. (Set window.HEMLINE_ENV in /js/env.js)';
    // Render demo placeholders so the page visibly changes
    renderCards([
      { title:'Cotton Sateen', description:'100% cotton, 2 yards', price_cents:2400, image_urls:['https://via.placeholder.com/800x600?text=Cotton+Sateen'], category:'Fabric', color:'Navy' },
      { title:'Wool Dobby', description:'Luxury suiting, 1.5 yards', price_cents:4200, image_urls:['https://via.placeholder.com/800x600?text=Wool+Dobby'], category:'Fabric', color:'Charcoal' },
      { title:'Silk Crepe', description:'Ivory, 3 yards', price_cents:6900, image_urls:['https://via.placeholder.com/800x600?text=Silk+Crepe'], category:'Fabric', color:'Ivory' },
    ]);
    return;
  }

  const supabase = window.supabase.createClient(url, key);

  function esc(s){return String(s||"").replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]))}
  function fmt(row){
    if (row.price!=null && Number.isFinite(Number(row.price))) return "$"+Number(row.price).toFixed(2);
    if (row.price_cents!=null && Number.isFinite(Number(row.price_cents))) return "$"+(Number(row.price_cents)/100).toFixed(2);
    return "—";
  }

  async function load(){
    list.innerHTML = `<div class="card"><p class="muted">Loading listings…</p></div>`;
    const { data, error } = await supabase
      .from('listings')
      .select('id,title,description,price,price_cents,category,color,image_urls')
      .order('id', { ascending: false })
      .limit(24);

    if(error){
      list.innerHTML = `<div class="warn">Error loading listings: ${esc(error.message)}</div>`;
      return;
    }
    if(!data || data.length===0){
      list.innerHTML = `<div class="card"><p class="muted">No listings yet. Check back soon!</p></div>`;
      return;
    }
    renderCards(data);
  }

  function renderCards(rows){
    list.innerHTML = rows.map(r=>{
      const img = (Array.isArray(r.image_urls) && r.image_urls[0]) ? r.image_urls[0] : 'https://via.placeholder.com/800x600?text=Fabric';
      return `
      <div class="card stack">
        <img src="${esc(img)}" alt="">
        <h3 style="margin:6px 0">${esc(r.title||'Untitled')}</h3>
        <p class="muted" style="margin:0 0 8px">${esc(r.description||'')}</p>
        <div class="cluster">
          ${r.category?`<span class="badge">${esc(r.category)}</span>`:''}
          ${r.color?`<span class="badge">${esc(r.color)}</span>`:''}
        </div>
        <p><strong>${fmt(r)}</strong></p>
        <a class="btn btn-primary" href="/checkout.html">Add to Cart</a>
      </div>`;
    }).join('');
  }

  // Kick off
  if(url && key){ load(); }
})();
</script>
</body>
</html>
