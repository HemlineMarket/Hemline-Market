}
body{margin:0;background:#fafafa;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;-webkit-font-smoothing:antialiased;color:#111827}

  /* Header (shared look) */
  /* Header (shared) */
.hm-header{min-height:56px;background:#fff;border-bottom:1px solid var(--hm-border)}
.hm-header .wrap{max-width:1200px;margin:0 auto;padding:0 12px;display:flex;align-items:center;justify-content:space-between}
.hm-header .left{display:flex;align-items:center;gap:10px}
@@ -41,7 +41,7 @@
.sheet nav a + a{margin-top:8px}
.sheet .close{display:inline-grid;place-items:center;width:30px;height:30px;border:1px solid var(--hm-border);border-radius:8px;background:#fff;color:#444}

  /* Layout */
  /* Page layout */
.wrap{max-width:1200px;margin:12px auto;padding:0 12px}
.topbar{display:flex;align-items:center;gap:10px;margin-bottom:10px}
.topbar input[type="search"]{flex:1;padding:10px;border:1px solid var(--hm-border);border-radius:10px;background:#fff}
@@ -50,12 +50,12 @@
.layout{display:grid;grid-template-columns:280px 1fr;gap:14px}
@media (max-width:900px){ .layout{grid-template-columns:1fr} }

  /* Sidebar filters */
  .filters{background:#fff;border:1px solid var(--hm-border);border-radius:12px;padding:10px;position:relative}
  /* Sidebar filters (structure preserved from your working version) */
  .filters{background:#fff;border:1px solid var(--hm-border);border-radius:12px;padding:10px}
.filters h3{margin:0 0 6px;font-size:14px;color:#374151}
.section{border-top:1px solid var(--hm-border);padding-top:8px;margin-top:8px}
.section:first-of-type{border-top:0;padding-top:0;margin-top:0}
  .section .title{display:flex;align-items:center;justify-content:space-between;font-weight:700;font-size:13px;color:#374151;margin:0 0 6px}
  .section .title{font-weight:700;font-size:13px;color:#374151;margin:0 0 6px}
.listbox{height:230px;overflow:auto;border:1px solid var(--hm-border);border-radius:10px;padding:6px}
.row{display:flex;align-items:center;gap:8px;padding:6px 4px;border-bottom:1px dashed #f3f4f6}
.row:last-child{border-bottom:0}
@@ -82,20 +82,22 @@
.btn{padding:6px 10px;border-radius:10px;border:1px solid var(--hm-border);background:#fff;color:#374151;font-size:13px;cursor:pointer}
.btn-primary{border-color:var(--hm-accent);background:var(--hm-accent);color:#fff}

  /* Selected chips row */
  /* Selected chips */
.chips{display:flex;flex-wrap:wrap;gap:6px;margin:6px 0 12px}
.chip{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--hm-border);border-radius:999px;background:#fff;padding:6px 10px;font-size:12px}
.chip button{border:0;background:transparent;cursor:pointer;color:#6b7280;font-weight:900}

  /* Results grid */
  /* Results */
.results{background:#fff;border:1px solid var(--hm-border);border-radius:12px;padding:12px;min-height:300px}
  .results-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.browse-grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px}
@media (max-width:900px){ .browse-grid{grid-template-columns:repeat(2,minmax(0,1fr))} }
@media (max-width:560px){ .browse-grid{grid-template-columns:1fr} }
  .card{background:linear-gradient(180deg,#f8fafc,#eef2f7);border:1px solid var(--hm-border);border-radius:12px;overflow:hidden}
  .ph{aspect-ratio:4/3;display:grid;place-items:center;color:#6b7280}
  .card{background:#fff;border:1px solid var(--hm-border);border-radius:12px;overflow:hidden}
  .ph{aspect-ratio:4/3;display:grid;place-items:center;color:#6b7280;background:linear-gradient(180deg,#f8fafc,#eef2f7)}
.meta{padding:8px 10px}
  .meta strong{display:block}
  .meta .title{font-weight:700}
  .meta .sub{display:flex;justify-content:space-between;color:#6b7280;margin-top:6px}
</style>
</head>
<body>
@@ -138,7 +140,7 @@
<button class="close" id="closeMenu" aria-label="Close menu">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
<line x1="18" y1="6" x2="6" y="18"></line>
        <line x1="6" y1="6" x2="18" y="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
</svg>
</button>
</header>
@@ -155,31 +157,28 @@

<div class="wrap">

  <!-- Search + Selected chips -->
  <!-- Search + Chips -->
<div class="topbar">
<input id="q" type="search" placeholder="Search fabrics…">
<button id="doSearch">Search</button>
</div>
<div id="selectedChips" class="chips" aria-live="polite"></div>

<div class="layout">
    <!-- Sidebar -->
    <!-- Filters (your existing structure preserved) -->
<aside class="filters" id="filters">
<h3>Filters</h3>

      <!-- Content -->
<section class="section">
<div class="title">Content</div>
<div class="listbox" id="contentBox"></div>
</section>

      <!-- Color Family -->
<section class="section">
<div class="title">Color Family</div>
<div class="sw-grid" id="colorBox"></div>
</section>

      <!-- $/yard -->
<section class="section">
<div class="title">$/yard</div>
<div class="mini">
@@ -188,15 +187,13 @@ <h3>Filters</h3>
</div>
</section>

      <!-- Yards -->
<section class="section">
<div class="title">Yards</div>
<div class="mini">
<div class="field" style="grid-column:1 / -1"><label>Min yards</label><input id="minYards" type="number" min="0" step="1"></div>
</div>
</section>

      <!-- Width -->
<section class="section">
<div class="title">Width (in)</div>
<div class="mini">
@@ -205,7 +202,6 @@ <h3>Filters</h3>
</div>
</section>

      <!-- Weight -->
<section class="section">
<div class="title">Weight (GSM)</div>
<div class="mini">
@@ -214,7 +210,6 @@ <h3>Filters</h3>
</div>
</section>

      <!-- Selects -->
<section class="section">
<div class="title">Department</div>
<div class="selects">
@@ -286,29 +281,12 @@ <h3>Filters</h3>

<!-- Results -->
<section class="results">
      <div class="browse-grid">
        <article class="card">
          <div class="ph">photo</div>
          <div class="meta">
            <strong>Sample Wool Crepe</strong>
            <div>$45/yd</div>
          </div>
        </article>
        <article class="card">
          <div class="ph">photo</div>
          <div class="meta">
            <strong>Italian Silk Twill</strong>
            <div>$68/yd</div>
          </div>
        </article>
        <article class="card">
          <div class="ph">photo</div>
          <div class="meta">
            <strong>Cotton Sateen</strong>
            <div>$22/yd</div>
          </div>
        </article>
      <div class="results-head">
        <h2 id="resultTitle" style="margin:0;font-size:18px">Browse</h2>
        <div id="resultCount" style="color:#6b7280;font-size:13px">0 results</div>
</div>
      <div id="grid" class="browse-grid"></div>
      <div id="empty" style="display:none;color:#6b7280">No results. Try relaxing a filter.</div>
</section>
</div>
</div>
@@ -344,7 +322,7 @@ <h3>Filters</h3>
const avatar=document.getElementById("avatar");
try{ const url=localStorage.getItem("avatarUrl"); if(url){ avatar.textContent=''; avatar.style.backgroundImage="url('"+url+"')"; } }catch(e){}

  /* Data */
  /* Data (same options as home) */
const CONTENT = [
"Any","Acetate","Acrylic","Alpaca","Angora","Bamboo","Cashmere","Cotton","Cupro",
"Hemp","Leather","Linen","Lurex","Modal","Mohair","Nylon","Polyester",
@@ -367,7 +345,7 @@ <h3>Filters</h3>
{name:"Silver",hex:"#d5d8de"}
];

  /* Build Content list */
  /* Build Content UI */
const contentBox=document.getElementById('contentBox');
CONTENT.forEach(v=>{
const id='cb_'+v.replace(/[^a-z0-9]/gi,'_');
@@ -378,7 +356,7 @@ <h3>Filters</h3>
contentBox.appendChild(row);
});

  /* Build colors */
  /* Build Colors */
const colorBox=document.getElementById('colorBox');
COLORS.forEach(c=>{
const sw=document.createElement('div'); sw.className='sw'; sw.dataset.name=c.name; sw.title=c.name;
@@ -388,14 +366,14 @@ <h3>Filters</h3>
colorBox.appendChild(sw);
});

  /* Helpers */
const $ = (id)=>document.getElementById(id);
const params = new URLSearchParams(location.search);

  function setVal(id){
    const el=$(id); if(!el) return;
    const v=params.get(id)||''; if(v!=='' ) el.value=v;
  }
  /* Prepopulate from URL */
  $('q').value = params.get('q')||'';
  ['minPrice','maxPrice','minYards','minWidth','maxWidth','minGsm','maxGsm','dept','fabricType','fiberType','designer','origin','pattern']
    .forEach(k=>{ const v=params.get(k); if(v!==null){ $(k).value=v; }});

function setCheckboxesFromCSV(container, csv){
if(!csv) return;
const set=new Set(csv.split(',').map(s=>s.trim()).filter(Boolean));
@@ -410,131 +388,179 @@ <h3>Filters</h3>
if(set.has(sw.dataset.name)) sw.dataset.selected="true";
});
}

  /* Prepopulate from URL */
  $('q').value = params.get('q')||'';
  setVal('minPrice'); setVal('maxPrice'); setVal('minYards');
  setVal('minWidth'); setVal('maxWidth'); setVal('minGsm'); setVal('maxGsm');
  setVal('dept'); setVal('fabricType'); setVal('fiberType'); setVal('designer'); setVal('origin'); setVal('pattern');
setCheckboxesFromCSV(contentBox, params.get('content')||'');
setSwatchesFromCSV(colorBox, params.get('colors')||'');

  /* Build selected chips */
  /* Chips */
const chipsEl=$('selectedChips');
function chip(label, key, value){
const d=document.createElement('span');
d.className='chip';
d.textContent=label+': '+value+' ';
const x=document.createElement('button'); x.type='button'; x.setAttribute('aria-label','Remove '+label); x.textContent='×';
x.addEventListener('click',()=>{
      // clear UI and param then reapply state to URL
if(key==='content'){
        const set=new Set((params.get('content')||'').split(',').filter(Boolean));
        set.delete(value); params.set('content',[...set].join(','));
        contentBox.querySelectorAll('input[type="checkbox"]').forEach(cb=>{
          if(cb.value===value) cb.checked=false;
        });
        const set=new Set((params.get('content')||'').split(',').filter(Boolean)); set.delete(value);
        if(set.size) params.set('content',[...set].join(',')); else params.delete('content');
        contentBox.querySelectorAll('input[type="checkbox"]').forEach(cb=>{ if(cb.value===value) cb.checked=false; });
}else if(key==='colors'){
        const set=new Set((params.get('colors')||'').split(',').filter(Boolean));
        set.delete(value); params.set('colors',[...set].join(','));
        colorBox.querySelectorAll('.sw').forEach(sw=>{
          if(sw.dataset.name===value) sw.removeAttribute('data-selected');
        });
        const set=new Set((params.get('colors')||'').split(',').filter(Boolean)); set.delete(value);
        if(set.size) params.set('colors',[...set].join(',')); else params.delete('colors');
        colorBox.querySelectorAll('.sw').forEach(sw=>{ if(sw.dataset.name===value) sw.removeAttribute('data-selected'); });
}else{
params.delete(key);
const el=$(key); if(el){ if(el.tagName==='SELECT'||el.tagName==='INPUT') el.value=''; }
}
history.replaceState(null,'','?'+params.toString());
      syncChips();
      syncChips(); render();
});
d.appendChild(x);
return d;
}

function syncChips(){
chipsEl.innerHTML='';
const q=params.get('q'); if(q) chipsEl.appendChild(chip('Search','q',q));

    const contentCSV=params.get('content')||'';
    contentCSV.split(',').filter(Boolean).forEach(v=>chipsEl.appendChild(chip('Content','content',v)));

    const colorCSV=params.get('colors')||'';
    colorCSV.split(',').filter(Boolean).forEach(v=>chipsEl.appendChild(chip('Color','colors',v)));

    (params.get('content')||'').split(',').filter(Boolean).forEach(v=>chipsEl.appendChild(chip('Content','content',v)));
    (params.get('colors')||'').split(',').filter(Boolean).forEach(v=>chipsEl.appendChild(chip('Color','colors',v)));
[
['minPrice','Min $/yd'],['maxPrice','Max $/yd'],
['minYards','Min yards'],
['minWidth','Min width'],['maxWidth','Max width'],
['minGsm','Min GSM'],['maxGsm','Max GSM'],
['dept','Department'],['fabricType','Fabric'],['fiberType','Fiber'],
['designer','Designer'],['origin','Origin'],['pattern','Pattern']
    ].forEach(([k,label])=>{
      const v=params.get(k); if(v) chipsEl.appendChild(chip(label,k,v));
    });
    ].forEach(([k,label])=>{ const v=params.get(k); if(v) chipsEl.appendChild(chip(label,k,v)); });
}
syncChips();

  /* Clear/Apply */
  $('clear').addEventListener('click',()=>{
    // clear UI
    contentBox.querySelectorAll('input[type="checkbox"]').forEach(cb=>cb.checked=false);
    colorBox.querySelectorAll('.sw').forEach(sw=>sw.removeAttribute('data-selected'));
    ['minPrice','maxPrice','minYards','minWidth','maxWidth','minGsm','maxGsm','designer','q'].forEach(id=>{ const el=$(id); if(el) el.value=''; });
    ['dept','fabricType','fiberType','origin','pattern'].forEach(id=>{ const el=$(id); if(el) el.selectedIndex=0; });
    // clear URL
    history.replaceState(null,'',location.pathname);
    params.clear();
    syncChips();
  });

  function gather(){
    const out=new URLSearchParams();
    const push=(k,v)=>{ if(v && String(v).trim()!=='') out.set(k,String(v).trim()); };

    push('q',$('q').value);

    const content=[...contentBox.querySelectorAll('input[type="checkbox"]:checked')].map(cb=>cb.value).filter(v=>v!=='Any');
    if(content.length) push('content',content.join(','));

    const colors=[...colorBox.querySelectorAll('.sw[data-selected="true"]')].map(sw=>sw.dataset.name);
    if(colors.length) push('colors',colors.join(','));

    ['minPrice','maxPrice','minYards','minWidth','maxWidth','minGsm','maxGsm','dept','fabricType','fiberType','designer','origin','pattern'].forEach(id=>{
      push(id, $(id).value);
    });
    return out;
  }

  $('apply').addEventListener('click',()=>{
    const out=gather();
    location.href=location.pathname+'?'+out.toString();
  });

  /* Search keeps filters */
  $('doSearch').addEventListener('click',()=>{
    const out=gather();
    location.href=location.pathname+'?'+out.toString();
  });

  /* Keep params in sync if user tweaks fields (so chips update immediately) */
  function live(k, getter){
  /* Keep URL in sync as user types (so chips update) */
  function live(k){
const el=$(k); if(!el) return;
    el.addEventListener('input',()=>{ const v=getter?getter():el.value; if(v) params.set(k,v); else params.delete(k); history.replaceState(null,'','?'+params.toString()); syncChips(); });
    el.addEventListener('input',()=>{
      const val=el.value.trim();
      if(val) params.set(k,val); else params.delete(k);
      history.replaceState(null,'','?'+params.toString());
      syncChips(); render();
    });
}
  ['minPrice','maxPrice','minYards','minWidth','maxWidth','minGsm','maxGsm','dept','fabricType','fiberType','designer','origin','pattern','q']
    .forEach(k=>live(k));
  ['q','minPrice','maxPrice','minYards','minWidth','maxWidth','minGsm','maxGsm','dept','fabricType','fiberType','designer','origin','pattern']
    .forEach(live);

contentBox.addEventListener('change',()=>{
const picked=[...contentBox.querySelectorAll('input[type="checkbox"]:checked')].map(cb=>cb.value).filter(v=>v!=='Any');
if(picked.length) params.set('content',picked.join(',')); else params.delete('content');
    history.replaceState(null,'','?'+params.toString()); syncChips();
    history.replaceState(null,'','?'+params.toString()); syncChips(); render();
});
colorBox.addEventListener('click',e=>{
if(!e.target.closest('.sw')) return;
const picked=[...colorBox.querySelectorAll('.sw[data-selected="true"]')].map(sw=>sw.dataset.name);
if(picked.length) params.set('colors',picked.join(',')); else params.delete('colors');
    history.replaceState(null,'','?'+params.toString()); syncChips();
    history.replaceState(null,'','?'+params.toString()); syncChips(); render();
});

  /* Gather filters to a predicate */
  function toFilters(){
    const getCSV=(k)=> (params.get(k)||'').split(',').map(s=>s.trim()).filter(Boolean);
    const term=(params.get('q')||'').toLowerCase();
    const contents=new Set(getCSV('content'));
    const colors=new Set(getCSV('colors'));
    const num=(k)=>{ const v=params.get(k); return v==null||v===''?null:Number(v); };
    const minPrice=num('minPrice'), maxPrice=num('maxPrice');
    const minYards=num('minYards');
    const minWidth=num('minWidth'), maxWidth=num('maxWidth');
    const minGsm=num('minGsm'), maxGsm=num('maxGsm');
    const dept=(params.get('dept')||'').toLowerCase();
    const fabricType=(params.get('fabricType')||'').toLowerCase();
    const fiberType=(params.get('fiberType')||'').toLowerCase();
    const designer=(params.get('designer')||'').toLowerCase();
    const origin=(params.get('origin')||'').toLowerCase();
    const pattern=(params.get('pattern')||'').toLowerCase();

    return (item)=>{
      // q
      if(term){
        const hay=(item.title+' '+(item.designer||'')).toLowerCase();
        if(!hay.includes(term)) return false;
      }
      // content (any match)
      if(contents.size){
        const lc = item.content.map(s=>s.toLowerCase());
        const has = [...contents].some(c=> lc.includes(c.toLowerCase()));
        if(!has) return false;
      }
      // colors
      if(colors.size && !colors.has(item.color)) return false;
      // numeric ranges
      if(minPrice!=null && item.price < minPrice) return false;
      if(maxPrice!=null && item.price > maxPrice) return false;
      if(minYards!=null && item.yards < minYards) return false;
      if(minWidth!=null && item.width < minWidth) return false;
      if(maxWidth!=null && item.width > maxWidth) return false;
      if(minGsm!=null && item.gsm < minGsm) return false;
      if(maxGsm!=null && item.gsm > maxGsm) return false;
      // selects / text
      if(dept && item.dept.toLowerCase()!==dept) return false;
      if(fabricType && item.fabricType.toLowerCase()!==fabricType) return false;
      if(fiberType && item.fiberType.toLowerCase()!==fiberType) return false;
      if(designer && !(item.designer||'').toLowerCase().includes(designer)) return false;
      if(origin && (item.origin||'').toLowerCase()!==origin) return false;
      if(pattern && (item.pattern||'').toLowerCase()!==pattern) return false;

      return true;
    };
  }

  /* Render results */
  const grid=document.getElementById('grid');
  const empty=document.getElementById('empty');
  const resultCount=document.getElementById('resultCount');

  let ALL=[];
  async function load(){
    try{
      const res=await fetch('data/listings.json');
      ALL=await res.json();
    }catch(e){
      console.error('Failed to load data/listings.json', e);
      ALL=[];
    }
    render();
  }

  function render(){
    const match=ALL.filter(toFilters());
    resultCount.textContent = match.length + (match.length===1 ? ' result' : ' results');
    grid.innerHTML='';
    if(match.length===0){ empty.style.display='block'; return; }
    empty.style.display='none';
    match.forEach(it=>{
      const a=document.createElement('article'); a.className='card';
      a.innerHTML=`
        <div class="ph">${it.photo ? '' : 'photo'}</div>
        <div class="meta">
          <div class="title">${it.title}</div>
          <div class="sub"><span>$${it.price}/yd</span><span>${it.width}″ • ${it.gsm} GSM</span></div>
        </div>`;
      grid.appendChild(a);
    });
  }

  /* Buttons */
  document.getElementById('apply').addEventListener('click',()=>{
    // Rebuild URL from current UI (already live-synced, but keep consistent)
    location.href = location.pathname + '?' + params.toString();
  });
  document.getElementById('clear').addEventListener('click',()=>{
    history.replaceState(null,'',location.pathname);
    location.reload();
  });
  document.getElementById('doSearch').addEventListener('click',()=>{
    params.set('q', document.getElementById('q').value.trim());
    history.replaceState(null,'','?'+params.toString());
    render();
  });

  load();
})();
</script>
</body>
