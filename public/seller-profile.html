<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Seller Profile — Hemline Market</title>

<!-- Shared styles -->
<link rel="stylesheet" href="styles/hm-modern.css"/>
<link rel="stylesheet" href="styles/hm-header.css"/>
<link rel="stylesheet" href="styles/hm-typography.css"/>
<link rel="stylesheet" href="styles/hm-footer.css"/>

<style>
  :root{--ink:#111827;--muted:#6b7280;--border:#e5e7eb;--accent:#991b1b;--bg:#fafafa}
  *{box-sizing:border-box}
  body{
    margin:0;
    background:var(--bg);
    color:var(--ink);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
    -webkit-font-smoothing:antialiased;
  }

  /* Local layout overrides */
  main.wrap{
    max-width:1100px;
    margin:18px auto 28px;
    padding:0 12px;
  }
  h1{
    margin:0 0 8px;
    font-size:26px;
    font-weight:800;
  }
  .subtle{
    color:var(--muted);
    margin:0 0 14px;
    font-size:14px;
  }

  /* Grid */
  .grid{
    display:grid;
    grid-template-columns:1fr 320px;
    gap:14px;
  }
  @media (max-width:980px){
    .grid{grid-template-columns:1fr;}
  }

  /* Cards + fields */
  .card{
    background:#fff;
    border:1px solid var(--border);
    border-radius:12px;
    box-shadow:0 6px 16px rgba(0,0,0,.06);
  }
  .card .hd{
    padding:10px 12px;
    border-bottom:1px solid var(--border);
    font-weight:800;
    font-size:14px;
  }
  .card .bd{
    padding:12px;
  }

  .field{
    display:flex;
    flex-direction:column;
    gap:6px;
    margin-bottom:10px;
  }
  .field label{
    font-size:12px;
    color:#374151;
    font-weight:700;
  }
  .field input[type="text"],
  .field input[type="url"],
  .field textarea{
    padding:10px;
    border:1px solid var(--border);
    border-radius:10px;
    background:#fff;
    font-size:14px;
  }
  .field textarea{
    min-height:110px;
    resize:vertical;
  }

  .actions{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
  }
  .btn{
    padding:10px 14px;
    border:1px solid var(--border);
    border-radius:10px;
    background:#fff;
    font-weight:700;
    cursor:pointer;
    font-size:14px;
  }
  .btn.primary{
    background:var(--accent);
    border-color:var(--accent);
    color:#fff;
    box-shadow:0 2px 8px rgba(153,27,27,.25);
  }

  /* Avatar card */
  .avatar{
    width:84px;
    height:84px;
    border-radius:999px;
    border:1px solid var(--border);
    display:grid;
    place-items:center;
    font-weight:800;
    color:#334155;
    background:#fff;
    background-size:cover;
    background-position:center;
  }

  /* Rating */
  .rating-wrap{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:10px;
  }
  .meter{
    height:8px;
    background:#f3f4f6;
    border-radius:999px;
    overflow:hidden;
  }
  .meter > span{
    display:block;
    height:100%;
    background:var(--accent);
    width:0;
  }
  .stat{
    border:1px solid var(--border);
    border-radius:10px;
    padding:10px;
    background:#fff;
  }
  .stat .big{
    font-weight:800;
    font-size:18px;
  }
  .stat .label{
    color:var(--muted);
    font-size:12px;
  }

  /* Copy link row */
  .copyrow{
    display:grid;
    grid-template-columns:1fr auto;
    gap:8px;
  }
  .pill{
    border:1px solid var(--border);
    border-radius:999px;
    padding:6px 10px;
    font-weight:700;
    display:inline-block;
    font-size:12px;
  }

  /* Footer overrides */
  .hm-footer{
    background:#fff;
    border-top:1px solid var(--border);
  }
  .footer-wrap{
    max-width:1200px;
    margin:0 auto;
    padding:10px 12px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    flex-wrap:wrap;
  }
  .footer-links{
    display:flex;
    gap:14px;
    flex-wrap:wrap;
  }

  /* Logged-out notice */
  .seller-logged-out{
    margin-bottom:14px;
    padding:14px 12px;
  }
  .seller-logged-out p{
    margin:4px 0 10px;
    font-size:14px;
    color:var(--muted);
  }
</style>
</head>
<body>

<!-- HEADER (shared pattern: avatar + Log in button IDs) -->
<header class="hm-header" role="banner">
  <div class="wrap">
    <div class="left">
      <button class="hamburger" id="openMenu" type="button" aria-label="Open menu" aria-controls="menuSheet" aria-expanded="false">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
          <line x1="4" y1="6"  x2="20" y2="6"></line>
          <line x1="4" y1="12" x2="20" y2="12"></line>
          <line x1="4" y1="18" x2="20" y2="18"></line>
        </svg>
      </button>
      <a class="hm-brand" href="index.html">Hemline Market</a>
    </div>
    <div class="right">
      <a class="hm-icon" href="browse.html" aria-label="Browse &amp; search">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="M21 21l-4.3-4.3"></path>
        </svg>
      </a>
      <a class="hm-icon" href="favorites.html" aria-label="Favorites">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 1 0-7.78 7.78L12 21.23l8.84-8.84a5.5 5.5 0 0 0 0-7.78z"></path>
        </svg>
      </a>
      <a class="hm-icon" href="notifications.html" aria-label="Notifications">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M18 8a6 6 0 1 0-12 0c0 7-3 7-3 7h18s-3 0-3-7"></path>
          <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
        </svg>
      </a>
      <a class="hm-icon" href="cart.html" aria-label="Cart">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <circle cx="9" cy="21" r="1"></circle>
          <circle cx="18" cy="21" r="1"></circle>
          <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h7.72a2 2 0 0 0 2-1.61L23 6H6"></path>
        </svg>
      </a>

      <!-- Avatar used by header session script -->
      <a class="hm-avatar" id="headerAvatar" href="account.html" title="Your account" style="display:none;">AA</a>

      <!-- Log in button shown when logged OUT -->
      <button class="cta-header" id="loginHeaderBtn" type="button" aria-label="Log in to Hemline Market">
        Log in
      </button>

      <a class="hm-btn-primary" href="sell.html">Sell</a>
    </div>
  </div>
</header>

<!-- LEFT MENU -->
<aside class="sheet" id="menuSheet" aria-hidden="true" role="dialog" aria-modal="true" aria-label="Site menu">
  <header>
    <strong>Menu</strong>
    <button class="close" id="closeMenu" aria-label="Close menu">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </header>
  <nav>
    <a href="browse.html">Browse</a>
    <a href="atelier.html">My Atelier</a>
    <a href="orders.html">Orders</a>
    <a href="favorites.html">Favorites</a>
    <a href="account.html">Account</a>
    <a href="help.html">Help</a>
  </nav>
</aside>

<main class="wrap" id="maincontent">
  <h1>Seller Profile</h1>
  <p class="subtle">This is what buyers see on your shop and listings.</p>

  <!-- Logged-out state -->
  <section id="sellerProfileLoggedOut" class="card seller-logged-out" style="display:none;">
    <div class="bd">
      <strong>You’re not signed in</strong>
      <p>Log in to edit your seller profile, avatar, and shop link.</p>
      <button type="button" class="btn primary" id="sellerLoginBtn">Log in</button>
    </div>
  </section>

  <div class="grid" id="sellerProfileGrid">
    <!-- LEFT COLUMN -->
    <section>
      <article class="card">
        <div class="hd">Shop Info</div>
        <div class="bd">
          <div class="field">
            <label>Shop name</label>
            <input id="shopName" type="text" placeholder="@e.g., LoomLab">
          </div>
          <div class="field">
            <label>Tagline</label>
            <input id="shopTagline" type="text" placeholder="Designer deadstock &amp; luxury fabrics">
          </div>
          <div class="field">
            <label>About</label>
            <textarea id="shopAbout" placeholder="Tell buyers about your sourcing, favorite textiles, or specialties…"></textarea>
          </div>
          <p class="subtle" style="margin:0">Shows on your profile and listing pages.</p>
        </div>
      </article>

      <article class="card" style="margin-top:12px">
        <div class="hd">Links</div>
        <div class="bd">
          <div class="field">
            <label>Website</label>
            <input id="shopWebsite" type="url" placeholder="https://example.com">
          </div>
          <div class="field">
            <label>Instagram</label>
            <input id="shopInstagram" type="text" placeholder="@yourhandle">
          </div>
          <div class="field">
            <label>TikTok</label>
            <input id="shopTiktok" type="text" placeholder="@yourhandle">
          </div>
          <div class="actions" style="margin-top:6px">
            <button class="btn primary" type="button" id="saveSellerProfileBtn">Save Profile</button>
            <button class="btn" type="button" id="resetSellerProfileBtn">Reset</button>
            <a class="btn" href="atelier.html">View My Atelier</a>
          </div>
        </div>
      </article>
    </section>

    <!-- RIGHT COLUMN -->
    <aside>
      <article class="card">
        <div class="hd">Avatar</div>
        <div class="bd">
          <div class="avatar" id="sellerAvatarCircle">AA</div>
          <div class="actions" style="margin-top:10px">
            <button class="btn" type="button" id="uploadAvatarBtn">Upload image</button>
            <button class="btn" type="button" id="removeAvatarBtn">Remove</button>
          </div>
          <p class="subtle" style="margin-top:8px">
            Square images display best. We’ll crop to a circle.
          </p>
        </div>
      </article>

      <article class="card" style="margin-top:12px">
        <div class="hd">Shop Rating</div>
        <div class="bd">
          <div class="rating-wrap" style="margin-bottom:10px">
            <div class="stat">
              <div class="big" id="completedCount">0</div>
              <div class="label">Completed listings</div>
            </div>
            <div class="stat">
              <div class="big"><span id="onTimePct">0</span>%</div>
              <div class="label">On-time shipments</div>
              <div class="meter" style="margin-top:8px">
                <span id="meterFill" style="width:0%"></span>
              </div>
            </div>
          </div>
          <button class="btn" type="button" aria-disabled="true" style="opacity:.7;cursor:default">
            Not yet rated
          </button>
          <p class="subtle" style="margin-top:8px">
            Ratings appear after you’ve sold at least 5 listings. We show your on-time shipping percentage—no public comments.
          </p>
        </div>
      </article>

      <article class="card" style="margin-top:12px">
        <div class="hd">Share your shop</div>
        <div class="bd">
          <div class="field" style="margin-bottom:8px">
            <label>Public link</label>
            <div class="copyrow">
              <input id="shopLink" type="text" readonly value="">
              <button id="copyBtn" class="btn" type="button">Copy</button>
            </div>
            <div id="copyMsg" class="subtle" style="margin-top:6px;display:none">Link copied!</div>
          </div>
          <span class="pill">Tip: your link updates as you edit your shop name.</span>
        </div>
      </article>

      <article class="card" style="margin-top:12px">
        <div class="hd">✨ Thank You</div>
        <div class="bd">
          <p style="margin:0">
            From your atelier to the world — thank you for sharing them here.
          </p>
        </div>
      </article>
    </aside>
  </div>
</main>

<footer class="hm-footer" role="contentinfo">
  <div class="footer-wrap">
    <div class="copy">© 2025 Hemline Market</div>
    <nav class="footer-links" aria-label="Footer">
      <a href="about.html">About</a>
      <a href="faq.html">FAQ</a>
      <a href="contact.html">Contact</a>
      <a href="terms.html">Terms</a>
      <a href="privacy.html">Privacy</a>
    </nav>
  </div>
</footer>

<!-- Scripts -->
<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

  const SUPABASE_URL = "https://clkizksbvxjkoatdajgd.supabase.co";
  const SUPABASE_ANON =
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNsa2l6a3Nidnhqa29hdGRhamdkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2ODAyMDUsImV4cCI6MjA3MDI1NjIwNX0.m3wd6UAuqxa7BpcQof9mmzd8zdsmadwGDO0x7-nyBjI";

  const supabase = createClient(SUPABASE_URL, SUPABASE_ANON);

  // Header + seller profile gating
  const headerAvatar = document.getElementById("headerAvatar");
  const loginHeaderBtn = document.getElementById("loginHeaderBtn");
  const sellerLoginBtn = document.getElementById("sellerLoginBtn");
  const sellerGrid = document.getElementById("sellerProfileGrid");
  const sellerLoggedOut = document.getElementById("sellerProfileLoggedOut");
  const sellerAvatarCircle = document.getElementById("sellerAvatarCircle");

  function getInitials(user) {
    const meta = user?.user_metadata || {};
    const display = (meta.display_name || "").trim();
    if (display) {
      const parts = display.split(/\s+/);
      if (parts.length === 1) return parts[0].slice(0, 2).toUpperCase();
      return (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();
    }
    const email = user?.email || "";
    if (email) return (email.split("@")[0] || "HM").slice(0, 2).toUpperCase();
    return "HM";
  }

  function show(el, display = "") {
    if (el) el.style.display = display;
  }
  function hide(el) {
    if (el) el.style.display = "none";
  }

  function goToAuth() {
    window.location.href = "auth.html";
  }

  if (loginHeaderBtn) {
    loginHeaderBtn.addEventListener("click", goToAuth);
  }
  if (sellerLoginBtn) {
    sellerLoginBtn.addEventListener("click", goToAuth);
  }

  (async () => {
    const { data, error } = await supabase.auth.getUser();
    const user = data?.user || null;

    if (!user) {
      // Logged OUT: hide avatar + grid, show login pieces
      hide(headerAvatar);
      show(loginHeaderBtn, "inline-block");
      hide(sellerGrid);
      show(sellerLoggedOut, "block");
      return;
    }

    // Logged IN: show avatar initials, hide log-in button, show profile editor
    const initials = getInitials(user);

    if (headerAvatar) {
      headerAvatar.textContent = initials;
      headerAvatar.style.backgroundImage = "";
      show(headerAvatar, "inline-grid");
    }
    hide(loginHeaderBtn);

    if (sellerAvatarCircle && !sellerAvatarCircle.style.backgroundImage) {
      sellerAvatarCircle.textContent = initials;
    }

    hide(sellerLoggedOut);
    show(sellerGrid, "grid");
  })();

  // Menu sheet (simple)
  (function(){
    const sheet   = document.getElementById("menuSheet");
    const openBtn = document.getElementById("openMenu");
    const closeBtn= document.getElementById("closeMenu");

    function openSheet(){
      if (!sheet) return;
      sheet.classList.add("open");
      sheet.setAttribute("aria-hidden","false");
    }
    function closeSheet(){
      if (!sheet) return;
      sheet.classList.remove("open");
      sheet.setAttribute("aria-hidden","true");
    }

    if (openBtn && closeBtn && sheet){
      openBtn.addEventListener("click", e => { e.preventDefault(); openSheet(); });
      closeBtn.addEventListener("click", e => { e.preventDefault(); closeSheet(); });
      document.addEventListener("keydown", e => {
        if (e.key === "Escape") closeSheet();
      });
    }
  })();

  // Share link that follows shop name (local only for now)
  const shopName = document.getElementById("shopName");
  const shopLink = document.getElementById("shopLink");
  const copyBtn  = document.getElementById("copyBtn");
  const copyMsg  = document.getElementById("copyMsg");

  function slugify(str){
    return (str||"").toLowerCase().trim()
      .replace(/&/g," and ")
      .replace(/[^a-z0-9]+/g,"-")
      .replace(/^-+|-+$/g,"")
      .substring(0,60);
  }
  function updateLink(){
    const slug = slugify(shopName.value || "my-shop");
    const base = window.location.origin || (location.protocol + "//" + location.host);
    shopLink.value = base + "/atelier.html?shop=" + encodeURIComponent(slug);
  }
  if (shopName && shopLink){
    updateLink();
    shopName.addEventListener("input", updateLink);
  }

  if (copyBtn && shopLink && copyMsg){
    copyBtn.addEventListener("click", async () => {
      try{
        await navigator.clipboard.writeText(shopLink.value);
      }catch(e){
        shopLink.select();
        document.execCommand("copy");
      }
      copyMsg.style.display = "block";
      setTimeout(() => { copyMsg.style.display = "none"; }, 1200);
    });
  }

  // Rating demo (local only for now)
  try{
    const completed = Number(localStorage.getItem("hm.seller.completed") || 0);
    const ontime = Number(localStorage.getItem("hm.seller.ontime") || 0);
    document.getElementById("completedCount").textContent = completed;
    document.getElementById("onTimePct").textContent =
      Math.max(0, Math.min(100, ontime));
    document.getElementById("meterFill").style.width =
      Math.max(0, Math.min(100, ontime)) + "%";
  }catch(e){}
</script>
</body>
</html>
