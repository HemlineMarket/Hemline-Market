<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Catalog Deploy Probe</title>
  <style>
    :root{--line:#e9e9e9;--ink:#111;--muted:#666}
    *{box-sizing:border-box}
    body{margin:0;font:16px/1.45 system-ui,-apple-system,Segoe UI,Inter,Roboto,sans-serif;background:#fafafa;color:var(--ink)}
    .wrap{max-width:780px;margin:40px auto;padding:0 20px}
    .card{background:#fff;border:1px solid var(--line);border-radius:12px;padding:22px;box-shadow:0 2px 10px rgba(0,0,0,.03)}
    h1{font-size:20px;margin:0 0 10px}
    code{background:#f5f5f5;border:1px solid #eee;padding:2px 6px;border-radius:6px}
    .row{margin:10px 0}
    .ok{color:#0a7a28;font-weight:600}
    .warn{color:#b04800;font-weight:600}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>CATALOG DEPLOY PROBE</h1>
      <div class="row">URL host: <code id="host"></code></div>
      <div class="row">Timestamp (UTC): <code id="ts"></code></div>
      <div class="row">catalog.html fingerprint: <span id="fp" class="warn">…checking…</span></div>
      <div class="row">Tip: if fingerprint says <em>LEGACY/UNKNOWN</em>, the domain is not serving the clean catalog build (or cache is pinned elsewhere).</div>
      <div class="row"><a href="/catalog.html?nocache=probe" target="_blank">Open catalog.html</a> · <a href="/catalog-clean.html?nocache=probe" target="_blank">Open catalog-clean.html</a></div>
    </div>
  </div>

  <script>
    // Basic info
    document.getElementById('host').textContent = location.host;
    document.getElementById('ts').textContent = new Date().toISOString().replace('T',' ').replace('Z',' UTC');

    // Heuristic fingerprint:
    // CLEAN build contains label "Fabric content" and no "Stretch" control.
    // LEGACY often includes "Stretch" and lacks "Fabric content".
    (async function(){
      const el = document.getElementById('fp');
      try{
        const r = await fetch('/catalog.html?probe=1',{cache:'no-store'});
        const t = (await r.text()).toLowerCase();
        const hasFabricContent = t.includes('fabric content</label>') || t.includes('fabric content');
        const hasStretch = t.includes('stretch</label>') || t.includes('>stretch<');
        if (hasFabricContent && !hasStretch){
          el.textContent = 'CLEAN';
          el.className = 'ok';
        } else if (hasStretch){
          el.textContent = 'LEGACY/UNKNOWN (Stretch present)';
          el.className = 'warn';
        } else {
          el.textContent = 'LEGACY/UNKNOWN';
          el.className = 'warn';
        }
      }catch(e){
        el.textContent = 'ERROR fetching catalog.html';
        el.className = 'warn';
      }
    })();
  </script>
</body>
</html>
